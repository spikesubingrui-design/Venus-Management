"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[88],{3129:function(e,s,a){var t=a(2180),n=a(1413),c=a(3433),l=a(9439),r=a(7294),i=a(1515),o=a(2954),d=a.n(o),m=a(4751),x=a(4818),u=a(5893),h=["\u624b\u8db3\u53e3\u75c5","\u75b1\u75b9\u6027\u54bd\u5ce1\u708e","\u6d41\u611f","\u6c34\u75d8","\u816e\u817a\u708e","\u7329\u7ea2\u70ed","\u8bfa\u5982\u75c5\u6bd2","\u8f6e\u72b6\u75c5\u6bd2","\u5176\u4ed6"],j=["\u53d1\u70ed","\u54b3\u55fd","\u6d41\u6d95","\u5455\u5410","\u8179\u6cfb","\u76ae\u75b9","\u54bd\u75db","\u4e4f\u529b","\u98df\u6b32\u4e0d\u632f","\u5176\u4ed6"];function N(){(0,m.Z)({title:"\u91d1\u661f\u5e7c\u513f\u56ed - \u75be\u75c5\u7ba1\u7406",path:"/pages/students/disease"});var e=(0,r.useState)([]),s=(0,l.Z)(e,2),a=s[0],t=s[1],o=(0,r.useState)([]),N=(0,l.Z)(o,2),v=N[0],f=N[1],p=(0,r.useState)("active"),G=(0,l.Z)(p,2),g=G[0],S=G[1],b=(0,r.useState)(!1),k=(0,l.Z)(b,2),y=k[0],C=k[1],w=(0,r.useState)(null),Z=(0,l.Z)(w,2),T=Z[0],D=Z[1],I=(0,r.useState)(""),_=(0,l.Z)(I,2),A=_[0],O=_[1],M=(0,r.useState)((new Date).toISOString().split("T")[0]),Y=(0,l.Z)(M,2),J=Y[0],P=Y[1],B=(0,r.useState)([]),E=(0,l.Z)(B,2),W=E[0],q=E[1],z=(0,r.useState)("treating"),F=(0,l.Z)(z,2),H=F[0],K=F[1],L=(0,r.useState)(""),Q=(0,l.Z)(L,2),R=Q[0],U=Q[1],V=(0,r.useState)(!1),X=(0,l.Z)(V,2),$=X[0],ee=X[1];(0,r.useEffect)(function(){se(),ae()},[]);var se=function(){var e=d().getStorageSync("kt_students")||[];t(Array.isArray(e)?e:[])},ae=function(){var e=d().getStorageSync("kt_disease_records")||[];f(Array.isArray(e)?e:[])},te=function(){if(T&&A){var e={id:"disease_".concat(Date.now()),studentId:T.id,studentName:T.name,className:T.class||"\u672a\u5206\u73ed",diseaseType:A,diagnosisDate:J,symptoms:W,treatmentStatus:H,notes:R,recordedAt:(new Date).toISOString()},s=[].concat((0,c.Z)(v),[e]);f(s),d().setStorageSync("kt_disease_records",s),ce(),d().showToast({title:"\u8bb0\u5f55\u5df2\u4fdd\u5b58",icon:"success"})}else d().showToast({title:"\u8bf7\u9009\u62e9\u5b66\u751f\u548c\u75be\u75c5\u7c7b\u578b",icon:"none"})},ne=function(e,s,a){var t=v.map(function(t){return t.id===e?(0,n.Z)((0,n.Z)({},t),{},{treatmentStatus:s,returnDate:a}):t});f(t),d().setStorageSync("kt_disease_records",t),d().showToast({title:"\u72b6\u6001\u5df2\u66f4\u65b0",icon:"success"})},ce=function(){C(!1),D(null),O(""),P((new Date).toISOString().split("T")[0]),q([]),K("treating"),U("")},le=function(e){q(function(s){return s.includes(e)?s.filter(function(s){return s!==e}):[].concat((0,c.Z)(s),[e])})},re=v.filter(function(e){return"recovered"!==e.treatmentStatus}),ie=v.filter(function(e){return"recovered"===e.treatmentStatus}),oe={treating:v.filter(function(e){return"treating"===e.treatmentStatus}).length,isolated:v.filter(function(e){return"isolated"===e.treatmentStatus}).length,recovered:ie.length},de="active"===g?re:ie;return(0,u.jsxs)(i.G7,{className:"disease-page",children:[(0,u.jsx)(x.Z,{title:"\u4f20\u67d3\u75c5\u7ba1\u7406",backgroundColor:"#dc2626"}),(0,u.jsx)(x.p,{}),(0,u.jsxs)(i.G7,{className:"header",children:[(0,u.jsx)(i.xv,{className:"title",children:"\u4f20\u67d3\u75c5\u7ba1\u7406"}),(0,u.jsx)(i.G7,{className:"add-btn",onClick:function(){return C(!0)},children:(0,u.jsx)(i.xv,{children:"+ \u767b\u8bb0"})})]}),(0,u.jsxs)(i.G7,{className:"stats-bar",children:[(0,u.jsxs)(i.G7,{className:"stat-item",children:[(0,u.jsx)(i.xv,{className:"number orange",children:oe.treating}),(0,u.jsx)(i.xv,{className:"label",children:"\u6cbb\u7597\u4e2d"})]}),(0,u.jsxs)(i.G7,{className:"stat-item",children:[(0,u.jsx)(i.xv,{className:"number red",children:oe.isolated}),(0,u.jsx)(i.xv,{className:"label",children:"\u9694\u79bb\u4e2d"})]}),(0,u.jsxs)(i.G7,{className:"stat-item",children:[(0,u.jsx)(i.xv,{className:"number green",children:oe.recovered}),(0,u.jsx)(i.xv,{className:"label",children:"\u5df2\u5eb7\u590d"})]})]}),(0,u.jsxs)(i.G7,{className:"tabs",children:[(0,u.jsx)(i.G7,{className:"tab ".concat("active"===g?"active":""),onClick:function(){return S("active")},children:(0,u.jsxs)(i.xv,{children:["\u5f53\u524d\u60a3\u75c5 (",re.length,")"]})}),(0,u.jsx)(i.G7,{className:"tab ".concat("recovered"===g?"active":""),onClick:function(){return S("recovered")},children:(0,u.jsxs)(i.xv,{children:["\u5df2\u5eb7\u590d (",ie.length,")"]})})]}),(0,u.jsxs)(i.pf,{className:"record-list",scrollY:!0,children:[de.map(function(e){return(0,u.jsxs)(i.G7,{className:"record-card",children:[(0,u.jsxs)(i.G7,{className:"card-header",children:[(0,u.jsxs)(i.G7,{className:"student-info",children:[(0,u.jsx)(i.xv,{className:"name",children:e.studentName}),(0,u.jsx)(i.xv,{className:"class",children:e.className})]}),(0,u.jsx)(i.G7,{className:"status-tag ".concat(e.treatmentStatus),children:(0,u.jsx)(i.xv,{children:"treating"===e.treatmentStatus?"\u6cbb\u7597\u4e2d":"isolated"===e.treatmentStatus?"\u9694\u79bb\u4e2d":"\u5df2\u5eb7\u590d"})})]}),(0,u.jsxs)(i.G7,{className:"card-body",children:[(0,u.jsxs)(i.G7,{className:"info-row",children:[(0,u.jsx)(i.xv,{className:"label",children:"\u75be\u75c5\u7c7b\u578b"}),(0,u.jsx)(i.xv,{className:"value disease-type",children:e.diseaseType})]}),(0,u.jsxs)(i.G7,{className:"info-row",children:[(0,u.jsx)(i.xv,{className:"label",children:"\u786e\u8bca\u65e5\u671f"}),(0,u.jsx)(i.xv,{className:"value",children:e.diagnosisDate})]}),e.symptoms.length>0&&(0,u.jsxs)(i.G7,{className:"info-row",children:[(0,u.jsx)(i.xv,{className:"label",children:"\u75c7\u72b6"}),(0,u.jsx)(i.G7,{className:"symptoms",children:e.symptoms.map(function(e,s){return(0,u.jsx)(i.xv,{className:"symptom-tag",children:e},s)})})]}),e.returnDate&&(0,u.jsxs)(i.G7,{className:"info-row",children:[(0,u.jsx)(i.xv,{className:"label",children:"\u8fd4\u56ed\u65e5\u671f"}),(0,u.jsx)(i.xv,{className:"value green",children:e.returnDate})]}),e.notes&&(0,u.jsxs)(i.G7,{className:"info-row",children:[(0,u.jsx)(i.xv,{className:"label",children:"\u5907\u6ce8"}),(0,u.jsx)(i.xv,{className:"value",children:e.notes})]})]}),"recovered"!==e.treatmentStatus&&(0,u.jsxs)(i.G7,{className:"card-actions",children:["treating"===e.treatmentStatus&&(0,u.jsx)(i.G7,{className:"action-btn isolate",onClick:function(){return ne(e.id,"isolated")},children:(0,u.jsx)(i.xv,{children:"\u6807\u8bb0\u9694\u79bb"})}),(0,u.jsx)(i.G7,{className:"action-btn recover",onClick:function(){d().showModal({title:"\u786e\u8ba4\u5eb7\u590d",content:"\u786e\u8ba4\u8be5\u5b66\u751f\u5df2\u5eb7\u590d\u5e76\u53ef\u8fd4\u56ed\uff1f",success:function(s){if(s.confirm){var a=(new Date).toISOString().split("T")[0];ne(e.id,"recovered",a)}}})},children:(0,u.jsx)(i.xv,{children:"\u6807\u8bb0\u5eb7\u590d"})})]})]},e.id)}),0===de.length&&(0,u.jsxs)(i.G7,{className:"empty-state",children:[(0,u.jsx)(i.xv,{className:"icon",children:"\ud83c\udfe5"}),(0,u.jsx)(i.xv,{className:"text",children:"active"===g?"\u6682\u65e0\u60a3\u75c5\u8bb0\u5f55":"\u6682\u65e0\u5eb7\u590d\u8bb0\u5f55"})]})]}),y&&(0,u.jsxs)(i.G7,{className:"record-modal",children:[(0,u.jsx)(i.G7,{className:"modal-overlay",onClick:ce}),(0,u.jsxs)(i.G7,{className:"modal-content",children:[(0,u.jsx)(i.G7,{className:"modal-header",children:(0,u.jsx)(i.xv,{className:"modal-title",children:"\u767b\u8bb0\u4f20\u67d3\u75c5"})}),(0,u.jsxs)(i.pf,{className:"modal-body",scrollY:!0,children:[(0,u.jsxs)(i.G7,{className:"form-item",children:[(0,u.jsx)(i.xv,{className:"label",children:"\u9009\u62e9\u5b66\u751f *"}),(0,u.jsx)(i.G7,{className:"student-picker",onClick:function(){return ee(!0)},children:(0,u.jsx)(i.xv,{className:T?"":"placeholder",children:T?"".concat(T.name," - ").concat(T.class):"\u70b9\u51fb\u9009\u62e9\u5b66\u751f"})})]}),(0,u.jsxs)(i.G7,{className:"form-item",children:[(0,u.jsx)(i.xv,{className:"label",children:"\u75be\u75c5\u7c7b\u578b *"}),(0,u.jsx)(i.G7,{className:"disease-options",children:h.map(function(e){return(0,u.jsx)(i.G7,{className:"option ".concat(A===e?"active":""),onClick:function(){return O(e)},children:(0,u.jsx)(i.xv,{children:e})},e)})})]}),(0,u.jsxs)(i.G7,{className:"form-item",children:[(0,u.jsx)(i.xv,{className:"label",children:"\u786e\u8bca\u65e5\u671f"}),(0,u.jsx)(i.cW,{mode:"date",value:J,onChange:function(e){return P(e.detail.value)},children:(0,u.jsx)(i.G7,{className:"date-picker",children:(0,u.jsx)(i.xv,{children:J})})})]}),(0,u.jsxs)(i.G7,{className:"form-item",children:[(0,u.jsx)(i.xv,{className:"label",children:"\u75c7\u72b6\uff08\u53ef\u591a\u9009\uff09"}),(0,u.jsx)(i.G7,{className:"symptom-options",children:j.map(function(e){return(0,u.jsx)(i.G7,{className:"option ".concat(W.includes(e)?"active":""),onClick:function(){return le(e)},children:(0,u.jsx)(i.xv,{children:e})},e)})})]}),(0,u.jsxs)(i.G7,{className:"form-item",children:[(0,u.jsx)(i.xv,{className:"label",children:"\u5f53\u524d\u72b6\u6001"}),(0,u.jsxs)(i.G7,{className:"status-options",children:[(0,u.jsx)(i.G7,{className:"option ".concat("treating"===H?"active":""),onClick:function(){return K("treating")},children:(0,u.jsx)(i.xv,{children:"\u6cbb\u7597\u4e2d"})}),(0,u.jsx)(i.G7,{className:"option ".concat("isolated"===H?"active":""),onClick:function(){return K("isolated")},children:(0,u.jsx)(i.xv,{children:"\u9694\u79bb\u4e2d"})})]})]}),(0,u.jsxs)(i.G7,{className:"form-item",children:[(0,u.jsx)(i.xv,{className:"label",children:"\u5907\u6ce8"}),(0,u.jsx)(i.II,{className:"input",placeholder:"\u5176\u4ed6\u8bf4\u660e\uff08\u9009\u586b\uff09",value:R,onInput:function(e){return U(e.detail.value)}})]})]}),(0,u.jsxs)(i.G7,{className:"modal-footer",children:[(0,u.jsx)(i.G7,{className:"btn cancel",onClick:ce,children:(0,u.jsx)(i.xv,{children:"\u53d6\u6d88"})}),(0,u.jsx)(i.G7,{className:"btn confirm",onClick:te,children:(0,u.jsx)(i.xv,{children:"\u4fdd\u5b58\u8bb0\u5f55"})})]})]})]}),$&&(0,u.jsxs)(i.G7,{className:"student-picker-modal",children:[(0,u.jsx)(i.G7,{className:"modal-overlay",onClick:function(){return ee(!1)}}),(0,u.jsxs)(i.G7,{className:"picker-content",children:[(0,u.jsxs)(i.G7,{className:"picker-header",children:[(0,u.jsx)(i.xv,{className:"picker-title",children:"\u9009\u62e9\u5b66\u751f"}),(0,u.jsx)(i.xv,{className:"close-btn",onClick:function(){return ee(!1)},children:"\u2715"})]}),(0,u.jsx)(i.pf,{className:"student-list",scrollY:!0,children:a.map(function(e){return(0,u.jsxs)(i.G7,{className:"student-item ".concat((null===T||void 0===T?void 0:T.id)===e.id?"selected":""),onClick:function(){D(e),ee(!1)},children:[(0,u.jsx)(i.xv,{className:"name",children:e.name}),(0,u.jsx)(i.xv,{className:"class",children:e.class||"\u672a\u5206\u73ed"})]},e.id)})})]})]})]})}var v={navigationBarTitleText:"\u4f20\u67d3\u75c5\u7ba1\u7406",navigationStyle:"custom",enableShareAppMessage:!0,enableShareTimeline:!0};N.enableShareTimeline=!0,N.enableShareAppMessage=!0;Page((0,t.createPageConfig)(N,"pages/students/disease",{root:{cn:[]}},v||{}))}},function(e){var s=function(s){return e(e.s=s)};e.O(0,[107,216,592],function(){return s(3129)});e.O()}]);