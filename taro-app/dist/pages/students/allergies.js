"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[801],{4303:function(e,s,a){var n=a(2180),l=a(3433),r=a(9439),c=a(7294),t=a(1515),i=a(2954),u=a.n(i),o=a(4751),x=a(4818),m=a(5893);function d(){(0,o.Z)({title:"\u91d1\u661f\u5e7c\u513f\u56ed - \u8fc7\u654f\u7ba1\u7406",path:"/pages/students/allergies"});var e=(0,c.useState)([]),s=(0,r.Z)(e,2),a=s[0],n=s[1],i=(0,c.useState)(""),d=(0,r.Z)(i,2),h=d[0],j=d[1],N=(0,c.useState)("\u5168\u90e8"),f=(0,r.Z)(N,2),g=f[0],v=f[1];(0,c.useEffect)(function(){p()},[]);var p=function(){var e=u().getStorageSync("kt_students")||[];n(Array.isArray(e)?e:[])},G=(0,c.useMemo)(function(){var e=new Set(a.map(function(e){return e.class||"\u672a\u5206\u73ed"}));return["\u5168\u90e8"].concat((0,l.Z)(Array.from(e).sort(function(e,s){return e.localeCompare(s,"zh-CN")})))},[a]),y=(0,c.useMemo)(function(){return a.filter(function(e){var s=e.allergies&&e.allergies.length>0,a=e.dietaryRestrictions&&e.dietaryRestrictions.trim();return s||a})},[a]),b=(0,c.useMemo)(function(){return y.filter(function(e){var s="\u5168\u90e8"===g||e.class===g,a=!h||e.name.includes(h)||(e.allergies||[]).some(function(e){return e.includes(h)});return s&&a})},[y,g,h]),Z=(0,c.useMemo)(function(){var e={};return y.forEach(function(s){(s.allergies||[]).forEach(function(s){e[s]=(e[s]||0)+1})}),Object.entries(e).sort(function(e,s){return s[1]-e[1]}).slice(0,10)},[y]),k=(0,c.useMemo)(function(){var e={};return b.forEach(function(s){var a=s.class||"\u672a\u5206\u73ed";e[a]||(e[a]=[]),e[a].push(s)}),e},[b]);return(0,m.jsxs)(t.G7,{className:"allergies-page",children:[(0,m.jsx)(x.Z,{title:"\u8fc7\u654f\u4fe1\u606f"}),(0,m.jsx)(x.p,{}),(0,m.jsxs)(t.G7,{className:"stats-header",children:[(0,m.jsxs)(t.G7,{className:"stat-card total",children:[(0,m.jsx)(t.xv,{className:"stat-number",children:a.length}),(0,m.jsx)(t.xv,{className:"stat-label",children:"\u603b\u5b66\u751f\u6570"})]}),(0,m.jsxs)(t.G7,{className:"stat-card allergic",children:[(0,m.jsx)(t.xv,{className:"stat-number",children:y.length}),(0,m.jsx)(t.xv,{className:"stat-label",children:"\u6709\u8fc7\u654f\u53f2"})]}),(0,m.jsxs)(t.G7,{className:"stat-card rate",children:[(0,m.jsxs)(t.xv,{className:"stat-number",children:[a.length>0?Math.round(y.length/a.length*100):0,"%"]}),(0,m.jsx)(t.xv,{className:"stat-label",children:"\u8fc7\u654f\u6bd4\u4f8b"})]})]}),Z.length>0&&(0,m.jsxs)(t.G7,{className:"allergen-section",children:[(0,m.jsx)(t.xv,{className:"section-title",children:"\u26a0\ufe0f \u5e38\u89c1\u8fc7\u654f\u539f\u7edf\u8ba1"}),(0,m.jsx)(t.G7,{className:"allergen-tags",children:Z.map(function(e){var s=(0,r.Z)(e,2),a=s[0],n=s[1];return(0,m.jsxs)(t.G7,{className:"allergen-tag",onClick:function(){return j(a)},children:[(0,m.jsx)(t.xv,{className:"allergen-name",children:a}),(0,m.jsxs)(t.xv,{className:"allergen-count",children:[n,"\u4eba"]})]},a)})})]}),(0,m.jsxs)(t.G7,{className:"filter-bar",children:[(0,m.jsxs)(t.G7,{className:"search-box",children:[(0,m.jsx)(t.xv,{className:"search-icon",children:"\ud83d\udd0d"}),(0,m.jsx)(t.II,{className:"search-input",placeholder:"\u641c\u7d22\u5b66\u751f\u59d3\u540d\u6216\u8fc7\u654f\u539f",value:h,onInput:function(e){return j(e.detail.value)}}),h&&(0,m.jsx)(t.xv,{className:"clear-btn",onClick:function(){return j("")},children:"\u2715"})]}),(0,m.jsx)(t.pf,{className:"class-tabs",scrollX:!0,children:G.map(function(e){return(0,m.jsx)(t.G7,{className:"class-tab ".concat(g===e?"active":""),onClick:function(){return v(e)},children:(0,m.jsx)(t.xv,{children:e})},e)})})]}),(0,m.jsx)(t.pf,{className:"student-list",scrollY:!0,children:0===b.length?(0,m.jsxs)(t.G7,{className:"empty-state",children:[(0,m.jsx)(t.xv,{className:"empty-icon",children:"\u2705"}),(0,m.jsx)(t.xv,{className:"empty-text",children:h||"\u5168\u90e8"!==g?"\u6ca1\u6709\u5339\u914d\u7684\u8bb0\u5f55":"\u6682\u65e0\u8fc7\u654f\u4fe1\u606f\u8bb0\u5f55"})]}):Object.entries(k).map(function(e){var s=(0,r.Z)(e,2),a=s[0],n=s[1];return(0,m.jsxs)(t.G7,{className:"class-group",children:[(0,m.jsxs)(t.G7,{className:"class-header",children:[(0,m.jsx)(t.xv,{className:"class-name",children:a}),(0,m.jsxs)(t.xv,{className:"class-count",children:[n.length,"\u4eba"]})]}),n.map(function(e){return(0,m.jsxs)(t.G7,{className:"student-card",children:[(0,m.jsx)(t.G7,{className:"student-info",children:(0,m.jsx)(t.xv,{className:"student-name",children:e.name})}),(0,m.jsxs)(t.G7,{className:"allergy-info",children:[e.allergies&&e.allergies.length>0&&(0,m.jsxs)(t.G7,{className:"allergy-row",children:[(0,m.jsx)(t.xv,{className:"allergy-label",children:"\ud83d\udea8 \u8fc7\u654f\u539f:"}),(0,m.jsx)(t.G7,{className:"allergy-items",children:e.allergies.map(function(e,s){return(0,m.jsx)(t.xv,{className:"allergy-item",children:e},s)})})]}),e.dietaryRestrictions&&(0,m.jsxs)(t.G7,{className:"dietary-row",children:[(0,m.jsx)(t.xv,{className:"dietary-label",children:"\ud83c\udf7d\ufe0f \u996e\u98df\u7981\u5fcc:"}),(0,m.jsx)(t.xv,{className:"dietary-text",children:e.dietaryRestrictions})]})]})]},e.id)})]},a)})}),(0,m.jsxs)(t.G7,{className:"kitchen-reminder",children:[(0,m.jsx)(t.xv,{className:"reminder-icon",children:"\ud83d\udc68\u200d\ud83c\udf73"}),(0,m.jsx)(t.xv,{className:"reminder-text",children:"\u5236\u4f5c\u98df\u7269\u65f6\u8bf7\u7279\u522b\u6ce8\u610f\u4ee5\u4e0a\u8fc7\u654f\u4fe1\u606f\uff0c\u786e\u4fdd\u98df\u54c1\u5b89\u5168"})]})]})}var h={};Page((0,n.createPageConfig)(d,"pages/students/allergies",{root:{cn:[]}},h||{}))}},function(e){var s=function(s){return e(e.s=s)};e.O(0,[107,216,592],function(){return s(4303)});e.O()}]);