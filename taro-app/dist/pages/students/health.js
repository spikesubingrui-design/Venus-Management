"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[473],{1343:function(e,n,a){var t=a(2180),l=a(3433),s=a(4942),c=a(2688),r=a(1413),i=a(5861),o=a(9439),u=a(7294),d=a(1515),h=a(2954),m=a.n(h),v=a(4751),x=a(5686),f=a(7724),p=a(4818),g=a(5893),j=[{value:"",label:"\u672a\u8bb0\u5f55"},{value:"all",label:"\u5168\u5403"},{value:"half",label:"\u4e00\u534a"},{value:"little",label:"\u5c11\u91cf"}],b=[{value:"",label:"\u672a\u8bb0\u5f55"},{value:"good",label:"\u597d"},{value:"normal",label:"\u4e00\u822c"},{value:"poor",label:"\u5dee"}],N=[{value:"",label:"\u672a\u8bb0\u5f55"},{value:"happy",label:"\u5f00\u5fc3"},{value:"normal",label:"\u4e00\u822c"},{value:"upset",label:"\u4e0d\u5f00\u5fc3"}];function S(){(0,v.Z)({title:"\u91d1\u661f\u5e7c\u513f\u56ed - \u5065\u5eb7\u7ba1\u7406",path:"/pages/students/health"});var e=(0,u.useState)((new Date).toISOString().split("T")[0]),n=(0,o.Z)(e,2),a=n[0],t=n[1],h=(0,u.useState)([]),S=(0,o.Z)(h,2),T=S[0],y=S[1],G=(0,u.useState)({}),Z=(0,o.Z)(G,2),I=Z[0],k=Z[1],w=(0,u.useState)("\u5168\u90e8"),C=(0,o.Z)(w,2),O=C[0],_=C[1],P=(0,u.useState)(!0),A=(0,o.Z)(P,2),K=A[0],W=A[1];(0,u.useEffect)(function(){var e,n=(0,f.ts)(),a="KITCHEN"===(null===n||void 0===n||null===(e=n.role)||void 0===e?void 0:e.toUpperCase());W(!a),E(),D()},[a]);var E=function(){var e=m().getStorageSync("kt_students")||[],n=(0,f.vX)(Array.isArray(e)?e:[]);y(n)},D=function(){var e=(0,i.Z)((0,c.Z)().m(function e(){var n,t,l,s,i,o;return(0,c.Z)().w(function(e){while(1)switch(e.p=e.n){case 0:return n=m().getStorageSync("kt_health_".concat(a))||{},k(n),e.p=1,e.n=2,(0,x.li)();case 2:t=e.v,t.success&&t.data&&(l=t.data.filter(function(e){return e.date===a}),l.length>0&&(s={},l.forEach(function(e){s[e.studentId]=e}),i=(0,r.Z)((0,r.Z)({},n),s),k(i),m().setStorageSync("kt_health_".concat(a),i),console.log("[\u5065\u5eb7\u8bb0\u5f55] \u4e91\u7aef\u6570\u636e\u5df2\u540c\u6b65:",l.length,"\u6761"))),e.n=4;break;case 3:e.p=3,o=e.v,console.log("[\u5065\u5eb7\u8bb0\u5f55] \u4e91\u7aef\u540c\u6b65\u8df3\u8fc7:",o);case 4:return e.a(2)}},e,null,[[1,3]])}));return function(){return e.apply(this,arguments)}}(),F=function(e,n){var t=I[e]||{studentId:e,date:a},l=(0,r.Z)((0,r.Z)((0,r.Z)({},t),n),{},{recordedAt:(new Date).toISOString()}),c=(0,r.Z)((0,r.Z)({},I),{},(0,s.Z)({},e,l));k(c),m().setStorageSync("kt_health_".concat(a),c),(0,x.rT)(a,e,l).then(function(n){n.success?console.log("[\u5065\u5eb7\u8bb0\u5f55] \u5df2\u540c\u6b65\u5230\u4e91\u7aef:",e):console.error("[\u5065\u5eb7\u8bb0\u5f55] \u540c\u6b65\u5931\u8d25:",n.error)})},J=["\u5168\u90e8"].concat((0,l.Z)(new Set(T.map(function(e){return e.class||"\u672a\u5206\u73ed"})))),M="\u5168\u90e8"===O?T:T.filter(function(e){return(e.class||"\u672a\u5206\u73ed")===O}),X=M.reduce(function(e,n){var a=n.class||"\u672a\u5206\u73ed";return e[a]||(e[a]=[]),e[a].push(n),e},{}),B=function(e){return e&&e>=37.3},H={total:M.length,recorded:Object.keys(I).filter(function(e){return M.some(function(n){return n.id===e})}).length,highTemp:Object.values(I).filter(function(e){return B(e.morningTemp)||B(e.noonTemp)}).length},U=function(e){var n=I[e],a=T.find(function(n){return n.id===e});if(n&&a){Y(a,n);F(e,{syncedToParent:!0}),m().showToast({title:"\u5df2\u53d1\u9001\u7ed9\u5bb6\u957f",icon:"success"})}},Y=function(e,n){var t=function(e){var n={all:"\u5168\u90e8\u5403\u5b8c",half:"\u5403\u4e86\u4e00\u534a",little:"\u5403\u5f97\u8f83\u5c11"};return n[e||""]||"\u672a\u8bb0\u5f55"},l=function(e){var n={good:"\u7761\u5f97\u5f88\u597d",normal:"\u7761\u7720\u4e00\u822c",poor:"\u7761\u7720\u8f83\u5dee"};return n[e||""]||"\u672a\u8bb0\u5f55"},s=function(e){var n={happy:"\u5fc3\u60c5\u6109\u5feb",normal:"\u5fc3\u60c5\u5e73\u7a33",upset:"\u60c5\u7eea\u4f4e\u843d"};return n[e||""]||"\u672a\u8bb0\u5f55"};return"\u3010".concat(e.name,"\u4eca\u65e5\u5728\u56ed\u60c5\u51b5\u3011\n\u65e5\u671f\uff1a").concat(a,"\n\u6668\u68c0\u4f53\u6e29\uff1a").concat(n.morningTemp||"-","\u2103\n\u5348\u68c0\u4f53\u6e29\uff1a").concat(n.noonTemp||"-","\u2103\n\u65e9\u9910\uff1a").concat(t(n.breakfastStatus),"\n\u5348\u9910\uff1a").concat(t(n.lunchStatus),"\n\u5348\u7761\uff1a").concat(l(n.napStatus),"\n\u60c5\u7eea\uff1a").concat(s(n.moodStatus),"\n").concat(n.notes?"\u5907\u6ce8\uff1a".concat(n.notes):"")};return(0,g.jsxs)(d.G7,{className:"health-page",children:[(0,g.jsx)(p.Z,{title:"\u5065\u5eb7\u6253\u5361",backgroundColor:"#ef4444"}),(0,g.jsx)(p.p,{}),(0,g.jsxs)(d.G7,{className:"header",children:[(0,g.jsx)(d.cW,{mode:"date",value:a,onChange:function(e){return t(e.detail.value)},children:(0,g.jsxs)(d.G7,{className:"date-display",children:[(0,g.jsx)(d.xv,{className:"date",children:a}),(0,g.jsx)(d.xv,{className:"arrow",children:"\u25bc"})]})}),(0,g.jsxs)(d.G7,{className:"stats-info",children:[(0,g.jsxs)(d.xv,{className:"recorded",children:[H.recorded,"/",H.total," \u5df2\u8bb0\u5f55"]}),H.highTemp>0&&(0,g.jsxs)(d.xv,{className:"alert",children:["\u26a0\ufe0f ",H.highTemp,"\u4eba\u4f53\u6e29\u5f02\u5e38"]})]})]}),(0,g.jsx)(d.pf,{className:"class-tabs",scrollX:!0,children:J.map(function(e){return(0,g.jsx)(d.G7,{className:"class-tab ".concat(O===e?"active":""),onClick:function(){return _(e)},children:(0,g.jsx)(d.xv,{children:e})},e)})}),(0,g.jsxs)(d.pf,{className:"student-list",scrollY:!0,children:[Object.entries(X).map(function(e){var n=(0,o.Z)(e,2),a=n[0],t=n[1];return(0,g.jsxs)(d.G7,{className:"class-group",children:[(0,g.jsxs)(d.G7,{className:"class-header",children:[(0,g.jsx)(d.xv,{className:"class-name",children:a}),(0,g.jsxs)(d.xv,{className:"count",children:[t.length,"\u4eba"]})]}),t.map(function(e){var n,a,t,l,s,c,r=I[e.id]||{},i=B(r.morningTemp)||B(r.noonTemp);return(0,g.jsxs)(d.G7,{className:"student-card ".concat(i?"alert":""),children:[(0,g.jsxs)(d.G7,{className:"student-header",children:[(0,g.jsxs)(d.G7,{className:"student-info",children:[(0,g.jsx)(d.xv,{className:"name",children:e.name}),e.allergies&&e.allergies.length>0&&(0,g.jsx)(d.xv,{className:"allergy-tag",children:"\u8fc7\u654f"})]}),K&&(0,g.jsx)(d.G7,{className:"sync-btn ".concat(r.syncedToParent?"synced":""),onClick:function(){return!r.syncedToParent&&U(e.id)},children:(0,g.jsx)(d.xv,{children:r.syncedToParent?"\u2713 \u5df2\u540c\u6b65":"\u53d1\u9001\u5bb6\u957f"})})]}),(0,g.jsxs)(d.G7,{className:"record-grid",children:[(0,g.jsxs)(d.G7,{className:"record-item",children:[(0,g.jsx)(d.xv,{className:"item-label",children:"\u6668\u68c0"}),(0,g.jsx)(d.II,{type:"digit",className:"temp-input ".concat(B(r.morningTemp)?"high":""),placeholder:"36.5",value:(null===(n=r.morningTemp)||void 0===n?void 0:n.toString())||"",onInput:function(n){return K&&F(e.id,{morningTemp:parseFloat(n.detail.value)||void 0})},disabled:!K}),(0,g.jsx)(d.xv,{className:"unit",children:"\u2103"})]}),(0,g.jsxs)(d.G7,{className:"record-item",children:[(0,g.jsx)(d.xv,{className:"item-label",children:"\u5348\u68c0"}),(0,g.jsx)(d.II,{type:"digit",className:"temp-input ".concat(B(r.noonTemp)?"high":""),placeholder:"36.5",value:(null===(a=r.noonTemp)||void 0===a?void 0:a.toString())||"",onInput:function(n){return K&&F(e.id,{noonTemp:parseFloat(n.detail.value)||void 0})},disabled:!K}),(0,g.jsx)(d.xv,{className:"unit",children:"\u2103"})]}),(0,g.jsxs)(d.G7,{className:"record-item",children:[(0,g.jsx)(d.xv,{className:"item-label",children:"\u65e9\u9910"}),(0,g.jsx)(d.cW,{mode:"selector",range:j,rangeKey:"label",value:j.findIndex(function(e){return e.value===r.breakfastStatus}),onChange:function(n){return K&&F(e.id,{breakfastStatus:j[+n.detail.value].value})},disabled:!K,children:(0,g.jsx)(d.G7,{className:"select-box ".concat(K?"":"disabled"),children:(0,g.jsx)(d.xv,{children:(null===(t=j.find(function(e){return e.value===r.breakfastStatus}))||void 0===t?void 0:t.label)||"\u9009\u62e9"})})})]}),(0,g.jsxs)(d.G7,{className:"record-item",children:[(0,g.jsx)(d.xv,{className:"item-label",children:"\u5348\u9910"}),(0,g.jsx)(d.cW,{mode:"selector",range:j,rangeKey:"label",value:j.findIndex(function(e){return e.value===r.lunchStatus}),onChange:function(n){return K&&F(e.id,{lunchStatus:j[+n.detail.value].value})},disabled:!K,children:(0,g.jsx)(d.G7,{className:"select-box ".concat(K?"":"disabled"),children:(0,g.jsx)(d.xv,{children:(null===(l=j.find(function(e){return e.value===r.lunchStatus}))||void 0===l?void 0:l.label)||"\u9009\u62e9"})})})]}),(0,g.jsxs)(d.G7,{className:"record-item",children:[(0,g.jsx)(d.xv,{className:"item-label",children:"\u5348\u7761"}),(0,g.jsx)(d.cW,{mode:"selector",range:b,rangeKey:"label",value:b.findIndex(function(e){return e.value===r.napStatus}),onChange:function(n){return K&&F(e.id,{napStatus:b[+n.detail.value].value})},disabled:!K,children:(0,g.jsx)(d.G7,{className:"select-box ".concat(K?"":"disabled"),children:(0,g.jsx)(d.xv,{children:(null===(s=b.find(function(e){return e.value===r.napStatus}))||void 0===s?void 0:s.label)||"\u9009\u62e9"})})})]}),(0,g.jsxs)(d.G7,{className:"record-item",children:[(0,g.jsx)(d.xv,{className:"item-label",children:"\u60c5\u7eea"}),(0,g.jsx)(d.cW,{mode:"selector",range:N,rangeKey:"label",value:N.findIndex(function(e){return e.value===r.moodStatus}),onChange:function(n){return K&&F(e.id,{moodStatus:N[+n.detail.value].value})},disabled:!K,children:(0,g.jsx)(d.G7,{className:"select-box ".concat(K?"":"disabled"),children:(0,g.jsx)(d.xv,{children:(null===(c=N.find(function(e){return e.value===r.moodStatus}))||void 0===c?void 0:c.label)||"\u9009\u62e9"})})})]})]}),(0,g.jsx)(d.G7,{className:"notes-section",children:(0,g.jsx)(d.II,{className:"notes-input",placeholder:"\u5907\u6ce8\uff08\u53ef\u9009\uff09",value:r.notes||"",onInput:function(n){return K&&F(e.id,{notes:n.detail.value})},disabled:!K})})]},e.id)})]},a)}),0===M.length&&(0,g.jsxs)(d.G7,{className:"empty-state",children:[(0,g.jsx)(d.xv,{className:"icon",children:"\ud83d\udccb"}),(0,g.jsx)(d.xv,{className:"text",children:"\u6682\u65e0\u5b66\u751f\u6570\u636e"})]})]})]})}var T={navigationBarTitleText:"\u5065\u5eb7\u6253\u5361",navigationStyle:"custom",enableShareAppMessage:!0,enableShareTimeline:!0};S.enableShareTimeline=!0,S.enableShareAppMessage=!0;Page((0,t.createPageConfig)(S,"pages/students/health",{root:{cn:[]}},T||{}))}},function(e){var n=function(n){return e(e.s=n)};e.O(0,[107,216,592],function(){return n(1343)});e.O()}]);