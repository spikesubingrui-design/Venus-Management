"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[20],{2522:function(e,s,n){var a=n(2180),c=n(3433),t=n(9439),l=n(7294),r=n(1515),i=n(2954),o=n.n(i),d=n(4751),u=n(4818),m=n(5893);function x(){(0,d.Z)({title:"\u91d1\u661f\u5e7c\u513f\u56ed - \u63a5\u9001\u7ba1\u7406",path:"/pages/students/pickup"});var e=(new Date).toISOString().split("T")[0],s=(0,l.useState)([]),n=(0,t.Z)(s,2),a=n[0],i=n[1],x=(0,l.useState)([]),h=(0,t.Z)(x,2),p=h[0],f=h[1],j=(0,l.useState)("\u5168\u90e8"),N=(0,t.Z)(j,2),v=N[0],G=N[1],b=(0,l.useState)(!1),k=(0,t.Z)(b,2),g=k[0],S=k[1],y=(0,l.useState)(null),I=(0,t.Z)(y,2),w=I[0],Z=I[1],C=(0,l.useState)("dropoff"),T=(0,t.Z)(C,2),A=T[0],O=T[1],_=(0,l.useState)(""),D=(0,t.Z)(_,2),J=D[0],M=D[1],P=(0,l.useState)(""),R=(0,t.Z)(P,2),q=R[0],B=R[1],E=(0,l.useState)(""),F=(0,t.Z)(E,2),X=F[0],Y=F[1],z=(0,l.useState)(""),H=(0,t.Z)(z,2),K=H[0],L=H[1];(0,l.useEffect)(function(){Q(),U()},[]);var Q=function(){var e=o().getStorageSync("kt_students")||[];i(Array.isArray(e)?e:[])},U=function(){var e=o().getStorageSync("kt_pickup_records")||[];f(Array.isArray(e)?e:[])},V=function(){if(w&&J&&q){var s={id:"pickup_".concat(Date.now()),studentId:w.id,date:e,type:A,time:(new Date).toTimeString().slice(0,5),pickerName:J,pickerRelation:q,pickerPhone:X,notes:K,recordedAt:(new Date).toISOString()},n=[].concat((0,c.Z)(p),[s]);f(n),o().setStorageSync("kt_pickup_records",n),W(),o().showToast({title:"\u8bb0\u5f55\u5df2\u4fdd\u5b58",icon:"success"})}else o().showToast({title:"\u8bf7\u586b\u5199\u5b8c\u6574\u4fe1\u606f",icon:"none"})},W=function(){S(!1),Z(null),M(""),B(""),Y(""),L("")},$=function(e,s){Z(e),O(s),S(!0)},ee=function(){o().scanCode({onlyFromCamera:!0,success:function(e){try{var s=JSON.parse(e.result);if(s.studentId&&s.type){var n=a.find(function(e){return e.id===s.studentId});n&&$(n,s.type)}}catch(e){o().showToast({title:"\u4e8c\u7ef4\u7801\u683c\u5f0f\u9519\u8bef",icon:"none"})}},fail:function(){o().showToast({title:"\u626b\u7801\u53d6\u6d88",icon:"none"})}})},se=function(e){JSON.stringify({studentId:e.id,studentName:e.name,type:"pickup"});o().showModal({title:"".concat(e.name,"\u7684\u63a5\u9001\u4e8c\u7ef4\u7801"),content:"\u8bf7\u5bb6\u957f\u4fdd\u5b58\u6b64\u4e8c\u7ef4\u7801\u7528\u4e8e\u63a5\u9001\u7b7e\u5230",showCancel:!1})},ne=["\u5168\u90e8"].concat((0,c.Z)(new Set(a.map(function(e){return e.class||"\u672a\u5206\u73ed"})))),ae="\u5168\u90e8"===v?a:a.filter(function(e){return(e.class||"\u672a\u5206\u73ed")===v}),ce=ae.reduce(function(e,s){var n=s.class||"\u672a\u5206\u73ed";return e[n]||(e[n]=[]),e[n].push(s),e},{}),te=function(s){return p.filter(function(n){return n.studentId===s&&n.date===e})},le=p.filter(function(s){return s.date===e}),re={dropoff:le.filter(function(e){return"dropoff"===e.type}).length,pickup:le.filter(function(e){return"pickup"===e.type}).length};return(0,m.jsxs)(r.G7,{className:"pickup-page",children:[(0,m.jsx)(u.Z,{title:"\u63a5\u9001\u7ba1\u7406",backgroundColor:"#3b82f6"}),(0,m.jsx)(u.p,{}),(0,m.jsxs)(r.G7,{className:"header",children:[(0,m.jsxs)(r.G7,{className:"header-info",children:[(0,m.jsx)(r.xv,{className:"title",children:"\u4eca\u65e5\u63a5\u9001"}),(0,m.jsx)(r.xv,{className:"date",children:e})]}),(0,m.jsx)(r.G7,{className:"header-btns",children:(0,m.jsx)(r.G7,{className:"scan-btn",onClick:ee,children:(0,m.jsx)(r.xv,{children:"\ud83d\udcf7 \u626b\u7801"})})})]}),(0,m.jsxs)(r.G7,{className:"stats-bar",children:[(0,m.jsxs)(r.G7,{className:"stat-item",children:[(0,m.jsx)(r.xv,{className:"number blue",children:re.dropoff}),(0,m.jsx)(r.xv,{className:"label",children:"\u5df2\u9001\u5165"})]}),(0,m.jsxs)(r.G7,{className:"stat-item",children:[(0,m.jsx)(r.xv,{className:"number green",children:re.pickup}),(0,m.jsx)(r.xv,{className:"label",children:"\u5df2\u63a5\u8d70"})]}),(0,m.jsxs)(r.G7,{className:"stat-item",children:[(0,m.jsx)(r.xv,{className:"number gray",children:ae.length}),(0,m.jsx)(r.xv,{className:"label",children:"\u603b\u4eba\u6570"})]})]}),(0,m.jsx)(r.pf,{className:"class-tabs",scrollX:!0,children:ne.map(function(e){return(0,m.jsx)(r.G7,{className:"class-tab ".concat(v===e?"active":""),onClick:function(){return G(e)},children:(0,m.jsx)(r.xv,{children:e})},e)})}),(0,m.jsxs)(r.pf,{className:"student-list",scrollY:!0,children:[Object.entries(ce).map(function(e){var s=(0,t.Z)(e,2),n=s[0],a=s[1];return(0,m.jsxs)(r.G7,{className:"class-group",children:[(0,m.jsxs)(r.G7,{className:"class-header",children:[(0,m.jsx)(r.xv,{className:"class-name",children:n}),(0,m.jsxs)(r.xv,{className:"count",children:[a.length,"\u4eba"]})]}),a.map(function(e){var s=te(e.id),n=s.some(function(e){return"dropoff"===e.type}),a=s.some(function(e){return"pickup"===e.type});return(0,m.jsxs)(r.G7,{className:"student-card",children:[(0,m.jsxs)(r.G7,{className:"student-info",children:[(0,m.jsx)(r.xv,{className:"name",children:e.name}),(0,m.jsxs)(r.G7,{className:"status-tags",children:[(0,m.jsxs)(r.xv,{className:"tag ".concat(n?"active blue":""),children:["\u9001\u5165 ",n?"\u2713":"-"]}),(0,m.jsxs)(r.xv,{className:"tag ".concat(a?"active green":""),children:["\u63a5\u8d70 ",a?"\u2713":"-"]})]})]}),(0,m.jsxs)(r.G7,{className:"action-btns",children:[(0,m.jsx)(r.G7,{className:"action-btn dropoff",onClick:function(){return $(e,"dropoff")},children:(0,m.jsx)(r.xv,{children:"+ \u9001\u5165"})}),(0,m.jsx)(r.G7,{className:"action-btn pickup",onClick:function(){return $(e,"pickup")},children:(0,m.jsx)(r.xv,{children:"+ \u63a5\u8d70"})}),(0,m.jsx)(r.G7,{className:"action-btn qr",onClick:function(){return se(e)},children:(0,m.jsx)(r.xv,{children:"\ud83d\udcf1"})})]}),s.length>0&&(0,m.jsx)(r.G7,{className:"today-records",children:s.map(function(e){return(0,m.jsxs)(r.G7,{className:"record-item",children:[(0,m.jsx)(r.xv,{className:"type ".concat(e.type),children:"dropoff"===e.type?"\u9001\u5165":"\u63a5\u8d70"}),(0,m.jsx)(r.xv,{className:"time",children:e.time}),(0,m.jsxs)(r.xv,{className:"picker",children:[e.pickerName,"\uff08",e.pickerRelation,"\uff09"]})]},e.id)})})]},e.id)})]},n)}),0===ae.length&&(0,m.jsxs)(r.G7,{className:"empty-state",children:[(0,m.jsx)(r.xv,{className:"icon",children:"\ud83d\ude97"}),(0,m.jsx)(r.xv,{className:"text",children:"\u6682\u65e0\u5b66\u751f\u6570\u636e"})]})]}),g&&(0,m.jsxs)(r.G7,{className:"record-modal",children:[(0,m.jsx)(r.G7,{className:"modal-overlay",onClick:W}),(0,m.jsxs)(r.G7,{className:"modal-content",children:[(0,m.jsxs)(r.G7,{className:"modal-header",children:[(0,m.jsx)(r.xv,{className:"modal-title",children:"dropoff"===A?"\u9001\u5165\u767b\u8bb0":"\u63a5\u8d70\u767b\u8bb0"}),(0,m.jsx)(r.xv,{className:"student-name",children:null===w||void 0===w?void 0:w.name})]}),(0,m.jsxs)(r.G7,{className:"modal-body",children:[(0,m.jsxs)(r.G7,{className:"form-item",children:[(0,m.jsx)(r.xv,{className:"label",children:"\u63a5\u9001\u4eba\u59d3\u540d *"}),(0,m.jsx)(r.II,{className:"input",placeholder:"\u8bf7\u8f93\u5165\u59d3\u540d",value:J,onInput:function(e){return M(e.detail.value)}})]}),(0,m.jsxs)(r.G7,{className:"form-item",children:[(0,m.jsx)(r.xv,{className:"label",children:"\u4e0e\u5e7c\u513f\u5173\u7cfb *"}),(0,m.jsx)(r.G7,{className:"relation-options",children:["\u7236\u4eb2","\u6bcd\u4eb2","\u7237\u7237","\u5976\u5976","\u5916\u516c","\u5916\u5a46","\u5176\u4ed6"].map(function(e){return(0,m.jsx)(r.G7,{className:"option ".concat(q===e?"active":""),onClick:function(){return B(e)},children:(0,m.jsx)(r.xv,{children:e})},e)})})]}),(0,m.jsxs)(r.G7,{className:"form-item",children:[(0,m.jsx)(r.xv,{className:"label",children:"\u8054\u7cfb\u7535\u8bdd"}),(0,m.jsx)(r.II,{className:"input",type:"number",placeholder:"\u8bf7\u8f93\u5165\u7535\u8bdd\uff08\u9009\u586b\uff09",value:X,onInput:function(e){return Y(e.detail.value)}})]}),(0,m.jsxs)(r.G7,{className:"form-item",children:[(0,m.jsx)(r.xv,{className:"label",children:"\u5907\u6ce8"}),(0,m.jsx)(r.II,{className:"input",placeholder:"\u5907\u6ce8\u4fe1\u606f\uff08\u9009\u586b\uff09",value:K,onInput:function(e){return L(e.detail.value)}})]})]}),(0,m.jsxs)(r.G7,{className:"modal-footer",children:[(0,m.jsx)(r.G7,{className:"btn cancel",onClick:W,children:(0,m.jsx)(r.xv,{children:"\u53d6\u6d88"})}),(0,m.jsx)(r.G7,{className:"btn confirm",onClick:V,children:(0,m.jsxs)(r.xv,{children:["\u786e\u8ba4","dropoff"===A?"\u9001\u5165":"\u63a5\u8d70"]})})]})]})]})]})}var h={navigationBarTitleText:"\u63a5\u9001\u7ba1\u7406",navigationStyle:"custom",enableShareAppMessage:!0,enableShareTimeline:!0};x.enableShareTimeline=!0,x.enableShareAppMessage=!0;Page((0,a.createPageConfig)(x,"pages/students/pickup",{root:{cn:[]}},h||{}))}},function(e){var s=function(s){return e(e.s=s)};e.O(0,[107,216,592],function(){return s(2522)});e.O()}]);