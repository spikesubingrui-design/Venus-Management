"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[917],{9437:function(e,a,s){var t=s(2180),c=s(1002),n=s(3433),l=s(9439),r=s(7294),i=s(1515),d=s(2954),o=s.n(d),m=s(4751),h=s(4818),x=s(5893);function u(e){var a=[];if(e.attendanceRate>=95?a.push({type:"success",title:"\u51fa\u52e4\u7387\u4f18\u79c0",content:"\u56ed\u6240\u51fa\u52e4\u7387\u8fbe\u5230".concat(e.attendanceRate,"%\uff0c\u4fdd\u6301\u826f\u597d\uff01\u5efa\u8bae\u7ee7\u7eed\u4fdd\u6301\u5bb6\u56ed\u6c9f\u901a\uff0c\u5b9a\u671f\u53d1\u9001\u5065\u5eb7\u63d0\u9192\u3002")}):e.attendanceRate>=85?a.push({type:"info",title:"\u51fa\u52e4\u7387\u826f\u597d",content:"\u51fa\u52e4\u7387".concat(e.attendanceRate,"%\uff0c\u5904\u4e8e\u6b63\u5e38\u6c34\u5e73\u3002\u5efa\u8bae\u5173\u6ce8\u8bf7\u5047\u539f\u56e0\uff0c\u52a0\u5f3a\u6668\u68c0\u548c\u5065\u5eb7\u7ba1\u7406\u3002")}):a.push({type:"warning",title:"\u51fa\u52e4\u7387\u504f\u4f4e",content:"\u51fa\u52e4\u7387\u4ec5".concat(e.attendanceRate,"%\uff0c\u9700\u8981\u91cd\u70b9\u5173\u6ce8\u3002\u5efa\u8bae\uff1a1)\u5206\u6790\u8bf7\u5047\u539f\u56e0\u5206\u5e03\uff1b2)\u52a0\u5f3a\u5bb6\u56ed\u6c9f\u901a\uff1b3)\u5173\u6ce8\u73ed\u7ea7\u5dee\u5f02\u3002")}),e.sickRate>10){var s=Object.entries(e.sickReasons).sort(function(e,a){return a[1]-e[1]}).slice(0,3).map(function(e){var a=(0,l.Z)(e,1),s=a[0];return s}).join("\u3001");a.push({type:"warning",title:"\u75c5\u5047\u7387\u504f\u9ad8",content:"\u75c5\u5047\u7387".concat(e.sickRate.toFixed(1),"%\uff0c\u4e3b\u8981\u539f\u56e0\uff1a").concat(s||"\u672a\u8bb0\u5f55","\u3002\u5efa\u8bae\uff1a1)\u52a0\u5f3a\u901a\u98ce\u6d88\u6bd2\uff1b2)\u505a\u597d\u6668\u5348\u68c0\uff1b3)\u63d0\u9192\u5bb6\u957f\u5173\u6ce8\u513f\u7ae5\u5065\u5eb7\u3002")})}if(e.highTempRate>5&&a.push({type:"danger",title:"\u4f53\u6e29\u5f02\u5e38\u9884\u8b66",content:"\u4f53\u6e29\u5f02\u5e38\u7387".concat(e.highTempRate.toFixed(1),"%\uff0c\u9700\u8981\u9ad8\u5ea6\u8b66\u60d5\u3002\u5efa\u8bae\uff1a1)\u52a0\u5f3a\u4f53\u6e29\u76d1\u6d4b\u9891\u6b21\uff1b2)\u505a\u597d\u53d1\u70ed\u513f\u7ae5\u9694\u79bb\uff1b3)\u53ca\u65f6\u901a\u77e5\u5bb6\u957f\u5c31\u533b\u3002")}),e.consecutiveAbsent.length>0&&a.push({type:"danger",title:"\u8fde\u7eed\u7f3a\u52e4\u9884\u8b66",content:"".concat(e.consecutiveAbsent.slice(0,3).join("\u3001"),"\u7b49").concat(e.consecutiveAbsent.length,"\u540d\u5e7c\u513f\u8fde\u7eed\u7f3a\u52e4\u8d85\u8fc73\u5929\u3002\u5efa\u8bae\u4e3b\u52a8\u8054\u7cfb\u5bb6\u957f\u4e86\u89e3\u60c5\u51b5\uff0c\u505a\u597d\u5173\u6000\u8ddf\u8fdb\u3002")}),e.lowAttendanceClasses.length>0){var t=e.lowAttendanceClasses.map(function(e){return"".concat(e.name,"(").concat(e.rate,"%)")}).join("\u3001");a.push({type:"warning",title:"\u73ed\u7ea7\u51fa\u52e4\u5dee\u5f02",content:"\u4ee5\u4e0b\u73ed\u7ea7\u51fa\u52e4\u7387\u8f83\u4f4e\uff1a".concat(t,"\u3002\u5efa\u8bae\u5173\u6ce8\u8fd9\u4e9b\u73ed\u7ea7\u7684\u5065\u5eb7\u72b6\u51b5\uff0c\u5fc5\u8981\u65f6\u8fdb\u884c\u73ed\u7ea7\u6d88\u6bd2\u3002")})}return e.mealGoodRate<60&&a.push({type:"info",title:"\u7528\u9910\u60c5\u51b5\u5173\u6ce8",content:"\u7528\u9910\u5168\u5403\u7387".concat(e.mealGoodRate.toFixed(1),"%\u3002\u5efa\u8bae\uff1a1)\u4e86\u89e3\u5e7c\u513f\u6311\u98df\u60c5\u51b5\uff1b2)\u8c03\u6574\u83dc\u54c1\u53e3\u5473\uff1b3)\u52a0\u5f3a\u8425\u517b\u77e5\u8bc6\u5ba3\u4f20\u3002")}),e.napGoodRate<60&&a.push({type:"info",title:"\u5348\u7761\u8d28\u91cf\u5173\u6ce8",content:"\u5348\u7761\u826f\u597d\u7387".concat(e.napGoodRate.toFixed(1),"%\u3002\u5efa\u8bae\uff1a1)\u4fdd\u6301\u5348\u7761\u73af\u5883\u5b89\u9759\uff1b2)\u9002\u5f53\u8c03\u6574\u5348\u7761\u65f6\u95f4\uff1b3)\u5173\u6ce8\u7761\u7720\u56f0\u96be\u5e7c\u513f\u3002")}),e.happyRate<70&&a.push({type:"info",title:"\u60c5\u7eea\u72b6\u6001\u5173\u6ce8",content:"\u5e7c\u513f\u5f00\u5fc3\u7387".concat(e.happyRate.toFixed(1),"%\u3002\u5efa\u8bae\uff1a1)\u589e\u52a0\u8da3\u5473\u6d3b\u52a8\uff1b2)\u5173\u6ce8\u60c5\u7eea\u4f4e\u843d\u5e7c\u513f\uff1b3)\u52a0\u5f3a\u6b63\u5411\u6fc0\u52b1\u3002")}),e.lateRate>5&&a.push({type:"info",title:"\u8fdf\u5230\u60c5\u51b5\u63d0\u9192",content:"\u8fdf\u5230\u7387".concat(e.lateRate.toFixed(1),"%\u3002\u5efa\u8bae\u5411\u5bb6\u957f\u5f3a\u8c03\u51c6\u65f6\u5165\u56ed\u7684\u91cd\u8981\u6027\uff0c\u786e\u4fdd\u5e7c\u513f\u4e0d\u9519\u8fc7\u65e9\u64cd\u548c\u65e9\u9910\u3002")}),1===a.length&&"success"===a[0].type&&a.push({type:"success",title:"\u56ed\u6240\u8fd0\u8425\u826f\u597d",content:"\u5404\u9879\u6307\u6807\u6b63\u5e38\uff0c\u8bf7\u7ee7\u7eed\u4fdd\u6301\u3002\u5efa\u8bae\u5b9a\u671f\u590d\u76d8\u6570\u636e\uff0c\u6301\u7eed\u4f18\u5316\u7ba1\u7406\u6d41\u7a0b\u3002"}),a}function j(){(0,m.Z)({title:"\u91d1\u661f\u5e7c\u513f\u56ed - \u6570\u636e\u7edf\u8ba1",path:"/pages/students/stats"});var e=(0,r.useState)([]),a=(0,l.Z)(e,2),s=a[0],t=a[1],d=(0,r.useState)([]),j=(0,l.Z)(d,2),v=j[0],p=j[1],N=(0,r.useState)("\u5168\u90e8"),b=(0,l.Z)(N,2),G=b[0],f=b[1],g=(0,r.useState)("today"),R=(0,l.Z)(g,2),k=R[0],y=R[1],S=(0,r.useState)("overview"),w=(0,l.Z)(S,2),T=w[0],Z=w[1],A=(0,r.useState)({}),C=(0,l.Z)(A,2),F=C[0],M=C[1],O=(0,r.useState)({}),_=(0,l.Z)(O,2),E=_[0],D=_[1];(0,r.useEffect)(function(){z(),P(),J()},[k]);var z=function(){var e=o().getStorageSync("kt_students")||[];t(Array.isArray(e)?e:[])},P=function(){var e=o().getStorageSync("kt_teachers")||[],a=o().getStorageSync("kt_staff")||[],s=o().getStorageSync("kt_authorized_phones")||[];if(a.length>0){var t=new Set(e.map(function(e){return e.phone||e.id})),l=a.filter(function(e){var a=e.phone||e.id;return a&&!t.has(a)});if(l.length>0){var r=l.map(function(e){return{id:e.id,name:e.name,role:e.position||e.role||"",phone:e.phone||"",class:e.class||"",assignedClass:Array.isArray(e.assignedClasses)?e.assignedClasses[0]||e.class||"":e.class||"",campus:e.campus||"",status:e.status||"active"}});e=[].concat((0,n.Z)(e),(0,n.Z)(r)),console.log("[Stats] \u4ece kt_staff \u8865\u5145: +".concat(l.length))}}if(s.length>0){var i=new Set(e.map(function(e){return e.phone||e.id})),d=s.filter(function(e){var a="string"===typeof e?e:e.phone,s="object"===(0,c.Z)(e)&&e.role||"";return a&&"PARENT"!==s&&!i.has(a)});if(d.length>0){var m=d.map(function(e){var a="string"===typeof e?e:e.phone,s="object"===(0,c.Z)(e)&&e.name||a;return{id:"staff_".concat(a,"_").concat(Date.now()),name:s,phone:a,role:"object"===(0,c.Z)(e)&&(e.position||e.role)||"",class:"object"===(0,c.Z)(e)&&e.assignedClass||"",campus:"object"===(0,c.Z)(e)&&e.campus||"",status:"active"}});e=[].concat((0,n.Z)(e),(0,n.Z)(m)),console.log("[Stats] \u4ece kt_authorized_phones \u8865\u5145: +".concat(d.length))}}var h=new Set,x=e.filter(function(e){var a=e.phone||e.id||e.name;return!(!a||h.has(a))&&(h.add(a),!0)});p(Array.isArray(x)?x:[])},J=function(){for(var e=new Date,a="today"===k?1:"week"===k?7:30,s={},t={},c=0;c<a;c++){var n=new Date(e);n.setDate(n.getDate()-c);var l=n.toISOString().split("T")[0],r=o().getStorageSync("kt_attendance_".concat(l))||{},i=o().getStorageSync("kt_health_".concat(l))||{};s[l]=r,t[l]=i}M(s),D(t)},B=function(){return"today"===k?"\u4eca\u65e5":"week"===k?"\u8fd17\u5929":"\u8fd130\u5929"},I=(0,r.useMemo)(function(){var e=new Set(s.map(function(e){return e.class||"\u672a\u5206\u73ed"}));return["\u5168\u90e8"].concat((0,n.Z)(Array.from(e).sort(function(e,a){return e.localeCompare(a,"zh-CN")})))},[s]),X=(0,r.useMemo)(function(){return new Set(s.map(function(e){return e.class||"\u672a\u5206\u73ed"})).size},[s]),Y=(0,r.useMemo)(function(){if(0===v.length)return"0:0";var e=(s.length/v.length).toFixed(1);return"1:".concat(e)},[s,v]),q=(0,r.useMemo)(function(){return"\u5168\u90e8"===G?s:s.filter(function(e){return(e.class||"\u672a\u5206\u73ed")===G})},[s,G]),H=(0,r.useMemo)(function(){var e=Object.keys(F),a=0,s=0,t=0,c=0,n=0,r=0,i={},d={},o=[],m={};e.forEach(function(e){var l=F[e],h=0,x=0;q.forEach(function(e){var o=l[e.id];if(o)switch(r++,x++,o.status){case"present":a++,h++,m[e.id]=0;break;case"late":s++,h++,m[e.id]=0;break;case"absent":t++,m[e.id]=(m[e.id]||0)+1;break;case"sick":if(c++,m[e.id]=(m[e.id]||0)+1,o.notes){var u=o.notes.split("\uff1a")[0]||o.notes;i[u]=(i[u]||0)+1}break;case"leave":if(n++,m[e.id]=(m[e.id]||0)+1,o.notes){var j=o.notes.split("\uff1a")[0]||o.notes;d[j]=(d[j]||0)+1}break}}),x>0&&o.push({date:e.slice(5),rate:Math.round(h/x*100)})});var h=Object.entries(m).filter(function(e){var a=(0,l.Z)(e,2),s=(a[0],a[1]);return s>=3}).map(function(e){var a=(0,l.Z)(e,1),s=a[0],t=q.find(function(e){return e.id===s});return(null===t||void 0===t?void 0:t.name)||s}),x=e.length*q.length,u=x>0?Math.round((a+s)/x*100):0;return{dates:e.length,totalStudents:q.length,totalRecords:r,present:a,late:s,absent:t,sick:c,leave:n,attendanceRate:u,sickRate:x>0?c/x*100:0,leaveRate:x>0?n/x*100:0,absentRate:x>0?t/x*100:0,lateRate:x>0?s/x*100:0,sickReasons:i,leaveReasons:d,dailyRates:o.reverse(),consecutiveAbsent:h}},[F,q]),K=(0,r.useMemo)(function(){var e=Object.keys(E),a=0,s=0,t={all:0,half:0,little:0},c={good:0,normal:0,poor:0},n={happy:0,normal:0,upset:0},l=[];e.forEach(function(e){var r=E[e];q.forEach(function(i){var d=r[i.id];d&&(d.morningTemp&&(s++,d.morningTemp>=37.3&&(a++,l.push({name:i.name,temp:d.morningTemp,date:e.slice(5)}))),d.noonTemp&&(s++,d.noonTemp>=37.3&&(a++,l.push({name:i.name,temp:d.noonTemp,date:e.slice(5)}))),d.breakfastStatus&&t[d.breakfastStatus]++,d.lunchStatus&&t[d.lunchStatus]++,d.napStatus&&c[d.napStatus]++,d.moodStatus&&n[d.moodStatus]++)})});var r=t.all+t.half+t.little,i=c.good+c.normal+c.poor,d=n.happy+n.normal+n.upset;return{highTempCount:a,totalTempRecords:s,highTempRate:s>0?a/s*100:0,highTempStudents:l.slice(0,10),mealStats:t,mealGoodRate:r>0?t.all/r*100:0,napStats:c,napGoodRate:i>0?c.good/i*100:0,moodStats:n,happyRate:d>0?n.happy/d*100:0}},[E,q]),L=(0,r.useMemo)(function(){var e=Object.keys(F),a={};return e.forEach(function(e){var t=F[e];s.forEach(function(e){var s=e.class||"\u672a\u5206\u73ed";a[s]||(a[s]={present:0,total:0}),a[s].total++;var c=t[e.id];!c||"present"!==c.status&&"late"!==c.status||a[s].present++})}),Object.entries(a).map(function(e){var a=(0,l.Z)(e,2),s=a[0],t=a[1];return{className:s,rate:t.total>0?Math.round(t.present/t.total*100):0,present:t.present,total:t.total}}).sort(function(e,a){return a.rate-e.rate})},[F,s]),Q=(0,r.useMemo)(function(){return L.filter(function(e){return e.rate<85}).map(function(e){return{name:e.className,rate:e.rate}})},[L]),U=(0,r.useMemo)(function(){return u({attendanceRate:H.attendanceRate,sickRate:H.sickRate,leaveRate:H.leaveRate,absentRate:H.absentRate,lateRate:H.lateRate,highTempRate:K.highTempRate,mealGoodRate:K.mealGoodRate,napGoodRate:K.napGoodRate,happyRate:K.happyRate,sickReasons:H.sickReasons,consecutiveAbsent:H.consecutiveAbsent,lowAttendanceClasses:Q})},[H,K,Q]),V=function(){return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(i.G7,{className:"stats-card operation",children:[(0,x.jsx)(i.G7,{className:"card-header",children:(0,x.jsx)(i.xv,{className:"card-title",children:"\ud83c\udfeb \u56ed\u6240\u8fd0\u8425\u6982\u89c8"})}),(0,x.jsxs)(i.G7,{className:"operation-grid",children:[(0,x.jsxs)(i.G7,{className:"op-item",children:[(0,x.jsx)(i.xv,{className:"op-icon",children:"\ud83d\udc76"}),(0,x.jsx)(i.xv,{className:"op-value",children:s.length}),(0,x.jsx)(i.xv,{className:"op-label",children:"\u5728\u56ed\u5e7c\u513f"})]}),(0,x.jsxs)(i.G7,{className:"op-item",children:[(0,x.jsx)(i.xv,{className:"op-icon",children:"\ud83d\udc68\u200d\ud83c\udfeb"}),(0,x.jsx)(i.xv,{className:"op-value",children:v.length}),(0,x.jsx)(i.xv,{className:"op-label",children:"\u6559\u804c\u5458\u5de5"})]}),(0,x.jsxs)(i.G7,{className:"op-item",children:[(0,x.jsx)(i.xv,{className:"op-icon",children:"\ud83c\udfe0"}),(0,x.jsx)(i.xv,{className:"op-value",children:X}),(0,x.jsx)(i.xv,{className:"op-label",children:"\u73ed\u7ea7\u6570\u91cf"})]}),(0,x.jsxs)(i.G7,{className:"op-item",children:[(0,x.jsx)(i.xv,{className:"op-icon",children:"\u2696\ufe0f"}),(0,x.jsx)(i.xv,{className:"op-value",children:Y}),(0,x.jsx)(i.xv,{className:"op-label",children:"\u5e08\u751f\u6bd4"})]})]})]}),(0,x.jsxs)(i.G7,{className:"stats-card kpi",children:[(0,x.jsx)(i.G7,{className:"card-header",children:(0,x.jsxs)(i.xv,{className:"card-title",children:["\ud83d\udcca \u6838\u5fc3\u6307\u6807 (",B(),")"]})}),(0,x.jsxs)(i.G7,{className:"kpi-grid",children:[(0,x.jsxs)(i.G7,{className:"kpi-item ".concat(H.attendanceRate>=90?"good":H.attendanceRate>=80?"normal":"bad"),children:[(0,x.jsxs)(i.G7,{className:"kpi-main",children:[(0,x.jsxs)(i.xv,{className:"kpi-value",children:[H.attendanceRate,"%"]}),(0,x.jsx)(i.xv,{className:"kpi-label",children:"\u51fa\u52e4\u7387"})]}),(0,x.jsx)(i.xv,{className:"kpi-trend",children:H.attendanceRate>=90?"\u2705 \u4f18\u79c0":H.attendanceRate>=80?"\ud83d\udcca \u826f\u597d":"\u26a0\ufe0f \u5173\u6ce8"})]}),(0,x.jsxs)(i.G7,{className:"kpi-item ".concat(H.sickRate<=5?"good":H.sickRate<=10?"normal":"bad"),children:[(0,x.jsxs)(i.G7,{className:"kpi-main",children:[(0,x.jsxs)(i.xv,{className:"kpi-value",children:[H.sickRate.toFixed(1),"%"]}),(0,x.jsx)(i.xv,{className:"kpi-label",children:"\u75c5\u5047\u7387"})]}),(0,x.jsx)(i.xv,{className:"kpi-trend",children:H.sickRate<=5?"\u2705 \u6b63\u5e38":H.sickRate<=10?"\ud83d\udcca \u5173\u6ce8":"\u26a0\ufe0f \u504f\u9ad8"})]}),(0,x.jsxs)(i.G7,{className:"kpi-item ".concat(K.highTempRate<=2?"good":K.highTempRate<=5?"normal":"bad"),children:[(0,x.jsxs)(i.G7,{className:"kpi-main",children:[(0,x.jsxs)(i.xv,{className:"kpi-value",children:[K.highTempRate.toFixed(1),"%"]}),(0,x.jsx)(i.xv,{className:"kpi-label",children:"\u4f53\u6e29\u5f02\u5e38\u7387"})]}),(0,x.jsx)(i.xv,{className:"kpi-trend",children:K.highTempRate<=2?"\u2705 \u6b63\u5e38":K.highTempRate<=5?"\ud83d\udcca \u5173\u6ce8":"\ud83d\udea8 \u8b66\u60d5"})]}),(0,x.jsxs)(i.G7,{className:"kpi-item ".concat(K.mealGoodRate>=70?"good":K.mealGoodRate>=50?"normal":"bad"),children:[(0,x.jsxs)(i.G7,{className:"kpi-main",children:[(0,x.jsxs)(i.xv,{className:"kpi-value",children:[K.mealGoodRate.toFixed(1),"%"]}),(0,x.jsx)(i.xv,{className:"kpi-label",children:"\u7528\u9910\u826f\u597d\u7387"})]}),(0,x.jsx)(i.xv,{className:"kpi-trend",children:K.mealGoodRate>=70?"\u2705 \u826f\u597d":K.mealGoodRate>=50?"\ud83d\udcca \u4e00\u822c":"\u26a0\ufe0f \u5173\u6ce8"})]})]})]}),L.length>0&&(0,x.jsxs)(i.G7,{className:"stats-card ranking",children:[(0,x.jsx)(i.G7,{className:"card-header",children:(0,x.jsx)(i.xv,{className:"card-title",children:"\ud83c\udfc6 \u73ed\u7ea7\u51fa\u52e4\u7387\u6392\u540d"})}),(0,x.jsx)(i.G7,{className:"rank-list",children:L.map(function(e,a){return(0,x.jsxs)(i.G7,{className:"rank-item",children:[(0,x.jsx)(i.G7,{className:"rank-badge ".concat(a<3?"top-".concat(a+1):""),children:(0,x.jsx)(i.xv,{children:a+1})}),(0,x.jsx)(i.xv,{className:"class-name",children:e.className}),(0,x.jsx)(i.G7,{className:"rate-bar",children:(0,x.jsx)(i.G7,{className:"bar-fill",style:{width:"".concat(e.rate,"%")}})}),(0,x.jsxs)(i.xv,{className:"rate-text ".concat(e.rate>=90?"green":e.rate>=80?"yellow":"red"),children:[e.rate,"%"]})]},e.className)})})]})]})},W=function(){return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(i.G7,{className:"stats-card attendance",children:[(0,x.jsxs)(i.G7,{className:"card-header",children:[(0,x.jsx)(i.xv,{className:"card-title",children:"\ud83d\udccb \u8003\u52e4\u7edf\u8ba1"}),(0,x.jsx)(i.xv,{className:"date-range",children:B()})]}),(0,x.jsxs)(i.G7,{className:"highlight-stat",children:[(0,x.jsxs)(i.xv,{className:"big-number",children:[H.attendanceRate,"%"]}),(0,x.jsx)(i.xv,{className:"stat-label",children:"\u603b\u51fa\u52e4\u7387"})]}),(0,x.jsxs)(i.G7,{className:"stat-grid",children:[(0,x.jsxs)(i.G7,{className:"stat-item",children:[(0,x.jsx)(i.xv,{className:"number green",children:H.present}),(0,x.jsx)(i.xv,{className:"label",children:"\u51fa\u52e4"})]}),(0,x.jsxs)(i.G7,{className:"stat-item",children:[(0,x.jsx)(i.xv,{className:"number yellow",children:H.late}),(0,x.jsx)(i.xv,{className:"label",children:"\u8fdf\u5230"})]}),(0,x.jsxs)(i.G7,{className:"stat-item",children:[(0,x.jsx)(i.xv,{className:"number red",children:H.absent}),(0,x.jsx)(i.xv,{className:"label",children:"\u7f3a\u52e4"})]}),(0,x.jsxs)(i.G7,{className:"stat-item",children:[(0,x.jsx)(i.xv,{className:"number orange",children:H.sick}),(0,x.jsx)(i.xv,{className:"label",children:"\u75c5\u5047"})]}),(0,x.jsxs)(i.G7,{className:"stat-item",children:[(0,x.jsx)(i.xv,{className:"number blue",children:H.leave}),(0,x.jsx)(i.xv,{className:"label",children:"\u4e8b\u5047"})]})]})]}),Object.keys(H.sickReasons).length>0&&(0,x.jsxs)(i.G7,{className:"stats-card reason-analysis",children:[(0,x.jsx)(i.G7,{className:"card-header",children:(0,x.jsx)(i.xv,{className:"card-title",children:"\ud83c\udfe5 \u75c5\u5047\u539f\u56e0\u5206\u6790"})}),(0,x.jsx)(i.G7,{className:"reason-list",children:Object.entries(H.sickReasons).sort(function(e,a){return a[1]-e[1]}).map(function(e){var a=(0,l.Z)(e,2),s=a[0],t=a[1],c=Object.values(H.sickReasons).reduce(function(e,a){return e+a},0),n=Math.round(t/c*100);return(0,x.jsxs)(i.G7,{className:"reason-item",children:[(0,x.jsx)(i.xv,{className:"reason-name",children:s}),(0,x.jsx)(i.G7,{className:"reason-bar",children:(0,x.jsx)(i.G7,{className:"bar-fill sick",style:{width:"".concat(n,"%")}})}),(0,x.jsxs)(i.xv,{className:"reason-count",children:[t,"\u6b21 (",n,"%)"]})]},s)})})]}),Object.keys(H.leaveReasons).length>0&&(0,x.jsxs)(i.G7,{className:"stats-card reason-analysis",children:[(0,x.jsx)(i.G7,{className:"card-header",children:(0,x.jsx)(i.xv,{className:"card-title",children:"\ud83d\udcdd \u4e8b\u5047\u539f\u56e0\u5206\u6790"})}),(0,x.jsx)(i.G7,{className:"reason-list",children:Object.entries(H.leaveReasons).sort(function(e,a){return a[1]-e[1]}).map(function(e){var a=(0,l.Z)(e,2),s=a[0],t=a[1],c=Object.values(H.leaveReasons).reduce(function(e,a){return e+a},0),n=Math.round(t/c*100);return(0,x.jsxs)(i.G7,{className:"reason-item",children:[(0,x.jsx)(i.xv,{className:"reason-name",children:s}),(0,x.jsx)(i.G7,{className:"reason-bar",children:(0,x.jsx)(i.G7,{className:"bar-fill leave",style:{width:"".concat(n,"%")}})}),(0,x.jsxs)(i.xv,{className:"reason-count",children:[t,"\u6b21 (",n,"%)"]})]},s)})})]}),H.consecutiveAbsent.length>0&&(0,x.jsxs)(i.G7,{className:"stats-card alert-card",children:[(0,x.jsx)(i.G7,{className:"card-header",children:(0,x.jsx)(i.xv,{className:"card-title",children:"\ud83d\udea8 \u8fde\u7eed\u7f3a\u52e4\u9884\u8b66"})}),(0,x.jsxs)(i.G7,{className:"alert-content",children:[(0,x.jsx)(i.G7,{className:"alert-icon-big",children:"\u26a0\ufe0f"}),(0,x.jsx)(i.xv,{className:"alert-desc",children:"\u4ee5\u4e0b\u5e7c\u513f\u8fde\u7eed\u7f3a\u52e4\u8d85\u8fc73\u5929\uff0c\u8bf7\u53ca\u65f6\u5173\u6ce8\uff1a"}),(0,x.jsx)(i.G7,{className:"alert-students",children:H.consecutiveAbsent.map(function(e){return(0,x.jsx)(i.G7,{className:"alert-student-tag",children:(0,x.jsx)(i.xv,{children:e})},e)})})]})]}),H.dailyRates.length>0&&(0,x.jsxs)(i.G7,{className:"stats-card trend",children:[(0,x.jsx)(i.G7,{className:"card-header",children:(0,x.jsx)(i.xv,{className:"card-title",children:"\ud83d\udcc8 \u51fa\u52e4\u8d8b\u52bf"})}),(0,x.jsx)(i.G7,{className:"trend-chart",children:H.dailyRates.slice(-7).map(function(e){return(0,x.jsxs)(i.G7,{className:"trend-bar",children:[(0,x.jsx)(i.G7,{className:"bar ".concat(e.rate>=90?"green":e.rate>=80?"yellow":"red"),style:{height:"".concat(e.rate,"%")},children:(0,x.jsxs)(i.xv,{className:"bar-value",children:[e.rate,"%"]})}),(0,x.jsx)(i.xv,{className:"bar-date",children:e.date})]},e.date)})})]})]})},$=function(){return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(i.G7,{className:"stats-card temp-monitor",children:[(0,x.jsx)(i.G7,{className:"card-header",children:(0,x.jsx)(i.xv,{className:"card-title",children:"\ud83c\udf21\ufe0f \u4f53\u6e29\u76d1\u63a7"})}),(0,x.jsxs)(i.G7,{className:"temp-summary",children:[(0,x.jsxs)(i.G7,{className:"temp-main",children:[(0,x.jsx)(i.xv,{className:"temp-value ".concat(K.highTempRate>5?"danger":K.highTempRate>2?"warning":"normal"),children:K.highTempCount}),(0,x.jsx)(i.xv,{className:"temp-label",children:"\u4f53\u6e29\u5f02\u5e38\u6b21\u6570"})]}),(0,x.jsxs)(i.G7,{className:"temp-info",children:[(0,x.jsxs)(i.xv,{className:"info-text",children:["\u68c0\u6d4b\u603b\u6570\uff1a",K.totalTempRecords,"\u6b21"]}),(0,x.jsxs)(i.xv,{className:"info-text",children:["\u5f02\u5e38\u7387\uff1a",K.highTempRate.toFixed(1),"%"]})]})]}),K.highTempStudents.length>0&&(0,x.jsxs)(i.G7,{className:"temp-list",children:[(0,x.jsx)(i.xv,{className:"list-title",children:"\u8fd1\u671f\u4f53\u6e29\u5f02\u5e38\u8bb0\u5f55\uff1a"}),K.highTempStudents.map(function(e,a){return(0,x.jsxs)(i.G7,{className:"temp-record",children:[(0,x.jsx)(i.xv,{className:"record-name",children:e.name}),(0,x.jsxs)(i.xv,{className:"record-temp",children:[e.temp,"\u2103"]}),(0,x.jsx)(i.xv,{className:"record-date",children:e.date})]},a)})]})]}),(0,x.jsxs)(i.G7,{className:"stats-card health",children:[(0,x.jsx)(i.G7,{className:"card-header",children:(0,x.jsx)(i.xv,{className:"card-title",children:"\ud83c\udf7d\ufe0f \u7528\u9910\u60c5\u51b5"})}),(0,x.jsx)(i.G7,{className:"meal-summary",children:(0,x.jsxs)(i.G7,{className:"meal-rate",children:[(0,x.jsxs)(i.xv,{className:"rate-value",children:[K.mealGoodRate.toFixed(1),"%"]}),(0,x.jsx)(i.xv,{className:"rate-label",children:"\u5168\u5403\u7387"})]})}),(0,x.jsx)(i.G7,{className:"health-section",children:(0,x.jsxs)(i.G7,{className:"bar-chart",children:[(0,x.jsxs)(i.G7,{className:"bar-row",children:[(0,x.jsx)(i.xv,{className:"bar-label",children:"\u5168\u5403"}),(0,x.jsx)(i.G7,{className:"bar-track",children:(0,x.jsx)(i.G7,{className:"bar-value green",style:{width:"".concat(K.mealStats.all/(K.mealStats.all+K.mealStats.half+K.mealStats.little||1)*100,"%")}})}),(0,x.jsx)(i.xv,{className:"bar-count",children:K.mealStats.all})]}),(0,x.jsxs)(i.G7,{className:"bar-row",children:[(0,x.jsx)(i.xv,{className:"bar-label",children:"\u4e00\u534a"}),(0,x.jsx)(i.G7,{className:"bar-track",children:(0,x.jsx)(i.G7,{className:"bar-value yellow",style:{width:"".concat(K.mealStats.half/(K.mealStats.all+K.mealStats.half+K.mealStats.little||1)*100,"%")}})}),(0,x.jsx)(i.xv,{className:"bar-count",children:K.mealStats.half})]}),(0,x.jsxs)(i.G7,{className:"bar-row",children:[(0,x.jsx)(i.xv,{className:"bar-label",children:"\u5c11\u91cf"}),(0,x.jsx)(i.G7,{className:"bar-track",children:(0,x.jsx)(i.G7,{className:"bar-value red",style:{width:"".concat(K.mealStats.little/(K.mealStats.all+K.mealStats.half+K.mealStats.little||1)*100,"%")}})}),(0,x.jsx)(i.xv,{className:"bar-count",children:K.mealStats.little})]})]})})]}),(0,x.jsxs)(i.G7,{className:"stats-card dual-section",children:[(0,x.jsxs)(i.G7,{className:"dual-item",children:[(0,x.jsx)(i.G7,{className:"card-header",children:(0,x.jsx)(i.xv,{className:"card-title",children:"\ud83d\ude34 \u5348\u7761\u8d28\u91cf"})}),(0,x.jsxs)(i.G7,{className:"pie-stats",children:[(0,x.jsxs)(i.G7,{className:"pie-item",children:[(0,x.jsx)(i.xv,{className:"pie-value green",children:K.napStats.good}),(0,x.jsx)(i.xv,{className:"pie-label",children:"\u597d"})]}),(0,x.jsxs)(i.G7,{className:"pie-item",children:[(0,x.jsx)(i.xv,{className:"pie-value yellow",children:K.napStats.normal}),(0,x.jsx)(i.xv,{className:"pie-label",children:"\u4e00\u822c"})]}),(0,x.jsxs)(i.G7,{className:"pie-item",children:[(0,x.jsx)(i.xv,{className:"pie-value red",children:K.napStats.poor}),(0,x.jsx)(i.xv,{className:"pie-label",children:"\u5dee"})]})]}),(0,x.jsxs)(i.G7,{className:"summary-line",children:[(0,x.jsx)(i.xv,{children:"\u826f\u597d\u7387\uff1a"}),(0,x.jsxs)(i.xv,{className:"highlight",children:[K.napGoodRate.toFixed(1),"%"]})]})]}),(0,x.jsxs)(i.G7,{className:"dual-item",children:[(0,x.jsx)(i.G7,{className:"card-header",children:(0,x.jsx)(i.xv,{className:"card-title",children:"\ud83d\ude0a \u60c5\u7eea\u72b6\u6001"})}),(0,x.jsxs)(i.G7,{className:"pie-stats",children:[(0,x.jsxs)(i.G7,{className:"pie-item",children:[(0,x.jsx)(i.xv,{className:"pie-value green",children:K.moodStats.happy}),(0,x.jsx)(i.xv,{className:"pie-label",children:"\u5f00\u5fc3"})]}),(0,x.jsxs)(i.G7,{className:"pie-item",children:[(0,x.jsx)(i.xv,{className:"pie-value yellow",children:K.moodStats.normal}),(0,x.jsx)(i.xv,{className:"pie-label",children:"\u4e00\u822c"})]}),(0,x.jsxs)(i.G7,{className:"pie-item",children:[(0,x.jsx)(i.xv,{className:"pie-value red",children:K.moodStats.upset}),(0,x.jsx)(i.xv,{className:"pie-label",children:"\u4e0d\u5f00\u5fc3"})]})]}),(0,x.jsxs)(i.G7,{className:"summary-line",children:[(0,x.jsx)(i.xv,{children:"\u5f00\u5fc3\u7387\uff1a"}),(0,x.jsxs)(i.xv,{className:"highlight",children:[K.happyRate.toFixed(1),"%"]})]})]})]})]})},ee=function(){return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(i.G7,{className:"advice-header",children:[(0,x.jsx)(i.xv,{className:"advice-title",children:"\ud83c\udfaf \u667a\u80fd\u5206\u6790\u62a5\u544a"}),(0,x.jsxs)(i.xv,{className:"advice-subtitle",children:["\u57fa\u4e8e",B(),"\u6570\u636e\u5206\u6790"]})]}),U.map(function(e,a){return(0,x.jsxs)(i.G7,{className:"advice-card ".concat(e.type),children:[(0,x.jsxs)(i.G7,{className:"advice-card-header",children:[(0,x.jsx)(i.xv,{className:"advice-icon",children:"success"===e.type?"\u2705":"warning"===e.type?"\u26a0\ufe0f":"danger"===e.type?"\ud83d\udea8":"\u2139\ufe0f"}),(0,x.jsx)(i.xv,{className:"advice-card-title",children:e.title})]}),(0,x.jsx)(i.xv,{className:"advice-content",children:e.content})]},a)}),(0,x.jsxs)(i.G7,{className:"stats-card overview",children:[(0,x.jsx)(i.G7,{className:"card-header",children:(0,x.jsx)(i.xv,{className:"card-title",children:"\ud83d\udccb \u6570\u636e\u6982\u89c8"})}),(0,x.jsxs)(i.G7,{className:"overview-grid",children:[(0,x.jsxs)(i.G7,{className:"overview-item",children:[(0,x.jsx)(i.xv,{className:"value",children:q.length}),(0,x.jsx)(i.xv,{className:"label",children:"\u5b66\u751f\u603b\u6570"})]}),(0,x.jsxs)(i.G7,{className:"overview-item",children:[(0,x.jsx)(i.xv,{className:"value",children:H.dates}),(0,x.jsx)(i.xv,{className:"label",children:"\u7edf\u8ba1\u5929\u6570"})]}),(0,x.jsxs)(i.G7,{className:"overview-item",children:[(0,x.jsx)(i.xv,{className:"value",children:H.totalRecords}),(0,x.jsx)(i.xv,{className:"label",children:"\u8003\u52e4\u8bb0\u5f55"})]}),(0,x.jsxs)(i.G7,{className:"overview-item",children:[(0,x.jsx)(i.xv,{className:"value",children:K.totalTempRecords}),(0,x.jsx)(i.xv,{className:"label",children:"\u4f53\u6e29\u8bb0\u5f55"})]})]})]})]})};return(0,x.jsxs)(i.G7,{className:"stats-page",children:[(0,x.jsx)(h.Z,{title:"\u6570\u636e\u7edf\u8ba1",backgroundColor:"#6366f1"}),(0,x.jsx)(h.p,{}),(0,x.jsx)(i.G7,{className:"header",children:(0,x.jsxs)(i.G7,{className:"header-top",children:[(0,x.jsx)(i.xv,{className:"title",children:"\ud83d\udcca \u56ed\u957f\u6570\u636e\u770b\u677f"}),(0,x.jsxs)(i.G7,{className:"range-tabs",children:[(0,x.jsx)(i.G7,{className:"tab ".concat("today"===k?"active":""),onClick:function(){return y("today")},children:(0,x.jsx)(i.xv,{children:"\u4eca\u65e5"})}),(0,x.jsx)(i.G7,{className:"tab ".concat("week"===k?"active":""),onClick:function(){return y("week")},children:(0,x.jsx)(i.xv,{children:"7\u5929"})}),(0,x.jsx)(i.G7,{className:"tab ".concat("month"===k?"active":""),onClick:function(){return y("month")},children:(0,x.jsx)(i.xv,{children:"30\u5929"})})]})]})}),(0,x.jsxs)(i.G7,{className:"tab-bar",children:[(0,x.jsxs)(i.G7,{className:"tab-item ".concat("overview"===T?"active":""),onClick:function(){return Z("overview")},children:[(0,x.jsx)(i.xv,{className:"tab-icon",children:"\ud83c\udfe0"}),(0,x.jsx)(i.xv,{className:"tab-text",children:"\u6982\u89c8"})]}),(0,x.jsxs)(i.G7,{className:"tab-item ".concat("attendance"===T?"active":""),onClick:function(){return Z("attendance")},children:[(0,x.jsx)(i.xv,{className:"tab-icon",children:"\ud83d\udccb"}),(0,x.jsx)(i.xv,{className:"tab-text",children:"\u8003\u52e4"})]}),(0,x.jsxs)(i.G7,{className:"tab-item ".concat("health"===T?"active":""),onClick:function(){return Z("health")},children:[(0,x.jsx)(i.xv,{className:"tab-icon",children:"\ud83d\udc8a"}),(0,x.jsx)(i.xv,{className:"tab-text",children:"\u5065\u5eb7"})]}),(0,x.jsxs)(i.G7,{className:"tab-item ".concat("advice"===T?"active":""),onClick:function(){return Z("advice")},children:[(0,x.jsx)(i.xv,{className:"tab-icon",children:"\ud83d\udca1"}),(0,x.jsx)(i.xv,{className:"tab-text",children:"\u5efa\u8bae"})]})]}),(0,x.jsx)(i.pf,{className:"class-tabs",scrollX:!0,children:I.map(function(e){return(0,x.jsx)(i.G7,{className:"class-tab ".concat(G===e?"active":""),onClick:function(){return f(e)},children:(0,x.jsx)(i.xv,{children:e})},e)})}),(0,x.jsxs)(i.pf,{className:"stats-content",scrollY:!0,children:["overview"===T&&V(),"attendance"===T&&W(),"health"===T&&$(),"advice"===T&&ee(),(0,x.jsx)(i.G7,{style:{height:"100rpx"}})]})]})}var v={navigationBarTitleText:"\u6570\u636e\u7edf\u8ba1",navigationStyle:"custom",enableShareAppMessage:!0,enableShareTimeline:!0};j.enableShareTimeline=!0,j.enableShareAppMessage=!0;Page((0,t.createPageConfig)(j,"pages/students/stats",{root:{cn:[]}},v||{}))}},function(e){var a=function(a){return e(e.s=a)};e.O(0,[107,216,592],function(){return a(9437)});e.O()}]);