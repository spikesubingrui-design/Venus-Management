"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[509],{449:function(e,s,n){var a=n(2180),l=n(1413),t=n(9439),c=n(7294),r=n(1515),i=n(2954),o=n.n(i),u=n(4751),d=n(4818),x=n(7724),m=n(1977),h=n(5893),j=function(e){return e.class||e.className||""},v=function(e){return e.parent_name||e.parentName||""},f=function(e){return e.parent_phone||e.parentPhone||""};function N(){var e,s;(0,u.Z)({title:"\u91d1\u661f\u5e7c\u513f\u56ed - \u5b66\u751f\u8be6\u60c5",path:"/pages/students/index"});var n=(0,i.useRouter)(),a=n.params.id,N=(0,c.useState)(null),p=(0,t.Z)(N,2),b=p[0],g=p[1],G=(0,c.useState)(!1),y=(0,t.Z)(G,2),Z=y[0],I=y[1],k=(0,c.useState)({}),S=(0,t.Z)(k,2),w=S[0],_=S[1],C=(0,c.useState)("info"),T=(0,t.Z)(C,2),D=T[0],M=T[1],P=(0,c.useState)([]),Y=(0,t.Z)(P,2),L=Y[0],O=Y[1],A=(0,c.useState)([]),B=(0,t.Z)(A,2),E=B[0],J=B[1],Q=(0,c.useState)(!0),H=(0,t.Z)(Q,2),K=H[0],R=H[1];(0,c.useEffect)(function(){var e,s=(0,x.ts)(),n="KITCHEN"===(null===s||void 0===s||null===(e=s.role)||void 0===e?void 0:e.toUpperCase());R(!n),U(),q(),z()},[a]);var U=function(){var e=o().getStorageSync("kt_students")||[],s=e.find(function(e){return e.id===a});s&&(g(s),_(s))},q=function(){for(var e=[],s=new Date,n=0;n<30;n++){var l=new Date(s);l.setDate(l.getDate()-n);var t=l.toISOString().split("T")[0],c=o().getStorageSync("kt_attendance_".concat(t))||{};c[a]&&e.push({date:t,status:c[a].status,notes:c[a].notes})}O(e)},z=function(){var e=o().getStorageSync("kt_payments")||[],s=e.filter(function(e){return e.studentId===a});J(s)},F=function(){var e;if(null!==(e=w.name)&&void 0!==e&&e.trim()){var s=(0,l.Z)((0,l.Z)({},w),{},{class:w.class,className:w.class,parent_name:w.parent_name,parentName:w.parent_name,parent_phone:w.parent_phone,parentPhone:w.parent_phone}),n=o().getStorageSync("kt_students")||[],t=n.map(function(e){return e.id===a?(0,l.Z)((0,l.Z)({},e),s):e});o().setStorageSync("kt_students",t),g(s),I(!1),o().showToast({title:"\u4fdd\u5b58\u6210\u529f",icon:"success"}),m.LC&&t.length>=10&&(0,m.Qu)("kt_students",t).catch(function(){})}else o().showToast({title:"\u59d3\u540d\u4e0d\u80fd\u4e3a\u7a7a",icon:"none"})},V=function(){o().showModal({title:"\u26a0\ufe0f \u786e\u8ba4\u5220\u9664",content:"\u786e\u5b9a\u8981\u5220\u9664\u5b66\u751f\u300c".concat(null===b||void 0===b?void 0:b.name,"\u300d\u5417\uff1f\u6b64\u64cd\u4f5c\u4e0d\u53ef\u64a4\u9500\u3002"),confirmColor:"#ef4444",success:function(e){e.confirm&&o().showModal({title:"\u518d\u6b21\u786e\u8ba4",content:"\u5220\u9664\u540e\u6570\u636e\u65e0\u6cd5\u6062\u590d\uff0c\u662f\u5426\u7ee7\u7eed\uff1f",confirmColor:"#ef4444",success:function(e){if(e.confirm){var s=o().getStorageSync("kt_students")||[],n=s.filter(function(e){return e.id!==a});o().setStorageSync("kt_students",n),m.LC&&n.length>=10&&(0,m.Qu)("kt_students",n).catch(function(){}),o().showToast({title:"\u5df2\u5220\u9664",icon:"success"}),setTimeout(function(){o().navigateBack()},1500)}}})}})},W=function(e){var s={present:"\u51fa\u52e4",absent:"\u7f3a\u52e4",sick:"\u75c5\u5047",leave:"\u4e8b\u5047"};return s[e]||e},X=function(e){var s={present:"#22c55e",absent:"#ef4444",sick:"#f59e0b",leave:"#3b82f6"};return s[e]||"#94a3b8"};return b?(0,h.jsxs)(r.G7,{className:"detail-page",children:[(0,h.jsx)(d.Z,{title:"\u5b66\u751f\u8be6\u60c5"}),(0,h.jsx)(d.p,{}),(0,h.jsxs)(r.G7,{className:"header-card",children:[(0,h.jsx)(r.G7,{className:"avatar",children:(0,h.jsx)(r.xv,{children:"\u5973"===b.gender?"\ud83d\udc67":"\ud83d\udc66"})}),(0,h.jsxs)(r.G7,{className:"basic-info",children:[(0,h.jsx)(r.xv,{className:"name",children:b.name}),(0,h.jsx)(r.xv,{className:"class",children:j(b)})]}),!Z&&K&&(0,h.jsxs)(r.G7,{className:"header-actions",children:[(0,h.jsx)(r.G7,{className:"edit-btn",onClick:function(){return I(!0)},children:(0,h.jsx)(r.xv,{children:"\u270f\ufe0f \u7f16\u8f91"})}),(0,h.jsx)(r.G7,{className:"more-btn",onClick:V,children:(0,h.jsx)(r.xv,{children:"\ud83d\uddd1\ufe0f"})})]})]}),(0,h.jsx)(r.G7,{className:"tabs",children:[{key:"info",label:"\ud83d\udccb \u57fa\u672c\u4fe1\u606f"},{key:"attendance",label:"\ud83d\udcc5 \u8003\u52e4\u8bb0\u5f55"},{key:"payment",label:"\ud83d\udcb0 \u7f34\u8d39\u8bb0\u5f55"}].map(function(e){return(0,h.jsx)(r.G7,{className:"tab ".concat(D===e.key?"active":""),onClick:function(){return M(e.key)},children:(0,h.jsx)(r.xv,{children:e.label})},e.key)})}),(0,h.jsxs)(r.pf,{className:"content",scrollY:!0,children:["info"===D&&(0,h.jsx)(r.G7,{className:"info-section",children:Z?(0,h.jsxs)(r.G7,{className:"edit-form",children:[(0,h.jsxs)(r.G7,{className:"form-group",children:[(0,h.jsx)(r.xv,{className:"group-title",children:"\ud83d\udc76 \u5b66\u751f\u4fe1\u606f"}),(0,h.jsxs)(r.G7,{className:"form-item",children:[(0,h.jsx)(r.xv,{className:"label",children:"\u59d3\u540d"}),(0,h.jsx)(r.II,{value:w.name,onInput:function(e){return _(function(s){return(0,l.Z)((0,l.Z)({},s),{},{name:e.detail.value})})}})]}),(0,h.jsxs)(r.G7,{className:"form-item",children:[(0,h.jsx)(r.xv,{className:"label",children:"\u6027\u522b"}),(0,h.jsx)(r.G7,{className:"gender-btns",children:["\u7537","\u5973"].map(function(e){return(0,h.jsx)(r.G7,{className:"gender-btn ".concat(w.gender===e?"active":""),onClick:function(){return _(function(s){return(0,l.Z)((0,l.Z)({},s),{},{gender:e})})},children:(0,h.jsx)(r.xv,{children:e})},e)})})]}),(0,h.jsxs)(r.G7,{className:"form-item",children:[(0,h.jsx)(r.xv,{className:"label",children:"\u73ed\u7ea7"}),(0,h.jsx)(r.II,{value:w.class,onInput:function(e){return _(function(s){return(0,l.Z)((0,l.Z)({},s),{},{class:e.detail.value})})}})]}),(0,h.jsxs)(r.G7,{className:"form-item",children:[(0,h.jsx)(r.xv,{className:"label",children:"\u51fa\u751f\u65e5\u671f"}),(0,h.jsx)(r.II,{type:"text",placeholder:"YYYY-MM-DD",value:w.birthDate,onInput:function(e){return _(function(s){return(0,l.Z)((0,l.Z)({},s),{},{birthDate:e.detail.value})})}})]}),(0,h.jsxs)(r.G7,{className:"form-item",children:[(0,h.jsx)(r.xv,{className:"label",children:"\u8eab\u9ad8(cm)"}),(0,h.jsx)(r.II,{type:"digit",value:null===(e=w.height)||void 0===e?void 0:e.toString(),onInput:function(e){return _(function(s){return(0,l.Z)((0,l.Z)({},s),{},{height:Number(e.detail.value)})})}})]}),(0,h.jsxs)(r.G7,{className:"form-item",children:[(0,h.jsx)(r.xv,{className:"label",children:"\u4f53\u91cd(kg)"}),(0,h.jsx)(r.II,{type:"digit",value:null===(s=w.weight)||void 0===s?void 0:s.toString(),onInput:function(e){return _(function(s){return(0,l.Z)((0,l.Z)({},s),{},{weight:Number(e.detail.value)})})}})]}),(0,h.jsxs)(r.G7,{className:"form-item",children:[(0,h.jsx)(r.xv,{className:"label",children:"\u8840\u578b"}),(0,h.jsx)(r.II,{value:w.bloodType,onInput:function(e){return _(function(s){return(0,l.Z)((0,l.Z)({},s),{},{bloodType:e.detail.value})})}})]}),(0,h.jsxs)(r.G7,{className:"form-item",children:[(0,h.jsx)(r.xv,{className:"label",children:"\u8fc7\u654f\u4fe1\u606f"}),(0,h.jsx)(r.II,{value:w.allergies,onInput:function(e){return _(function(s){return(0,l.Z)((0,l.Z)({},s),{},{allergies:e.detail.value})})}})]})]}),(0,h.jsxs)(r.G7,{className:"form-group",children:[(0,h.jsx)(r.xv,{className:"group-title",children:"\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67 \u5bb6\u957f\u4fe1\u606f"}),(0,h.jsxs)(r.G7,{className:"form-item",children:[(0,h.jsx)(r.xv,{className:"label",children:"\u5bb6\u957f\u59d3\u540d"}),(0,h.jsx)(r.II,{value:w.parent_name,onInput:function(e){return _(function(s){return(0,l.Z)((0,l.Z)({},s),{},{parent_name:e.detail.value})})}})]}),(0,h.jsxs)(r.G7,{className:"form-item",children:[(0,h.jsx)(r.xv,{className:"label",children:"\u4e0e\u5b69\u5b50\u5173\u7cfb"}),(0,h.jsx)(r.II,{value:w.parent_relation,onInput:function(e){return _(function(s){return(0,l.Z)((0,l.Z)({},s),{},{parent_relation:e.detail.value})})}})]}),(0,h.jsxs)(r.G7,{className:"form-item",children:[(0,h.jsx)(r.xv,{className:"label",children:"\u8054\u7cfb\u7535\u8bdd"}),(0,h.jsx)(r.II,{type:"number",value:w.parent_phone,onInput:function(e){return _(function(s){return(0,l.Z)((0,l.Z)({},s),{},{parent_phone:e.detail.value})})}})]}),(0,h.jsxs)(r.G7,{className:"form-item",children:[(0,h.jsx)(r.xv,{className:"label",children:"\u5bb6\u5ead\u5730\u5740"}),(0,h.jsx)(r.II,{value:w.address,onInput:function(e){return _(function(s){return(0,l.Z)((0,l.Z)({},s),{},{address:e.detail.value})})}})]})]}),(0,h.jsxs)(r.G7,{className:"action-btns",children:[(0,h.jsx)(r.G7,{className:"btn cancel",onClick:function(){I(!1),_(b)},children:(0,h.jsx)(r.xv,{children:"\u53d6\u6d88"})}),(0,h.jsx)(r.G7,{className:"btn save",onClick:F,children:(0,h.jsx)(r.xv,{children:"\u4fdd\u5b58"})})]})]}):(0,h.jsxs)(r.G7,{className:"info-display",children:[(0,h.jsxs)(r.G7,{className:"info-group",children:[(0,h.jsx)(r.xv,{className:"group-title",children:"\ud83d\udc76 \u5b66\u751f\u4fe1\u606f"}),(0,h.jsxs)(r.G7,{className:"info-row",children:[(0,h.jsx)(r.xv,{className:"label",children:"\u6027\u522b"}),(0,h.jsx)(r.xv,{className:"value",children:b.gender||"-"})]}),(0,h.jsxs)(r.G7,{className:"info-row",children:[(0,h.jsx)(r.xv,{className:"label",children:"\u73ed\u7ea7"}),(0,h.jsx)(r.xv,{className:"value",children:j(b)||"-"})]}),(0,h.jsxs)(r.G7,{className:"info-row",children:[(0,h.jsx)(r.xv,{className:"label",children:"\u51fa\u751f\u65e5\u671f"}),(0,h.jsx)(r.xv,{className:"value",children:b.birthDate||"-"})]}),(0,h.jsxs)(r.G7,{className:"info-row",children:[(0,h.jsx)(r.xv,{className:"label",children:"\u8eab\u9ad8"}),(0,h.jsx)(r.xv,{className:"value",children:b.height?"".concat(b.height,"cm"):"-"})]}),(0,h.jsxs)(r.G7,{className:"info-row",children:[(0,h.jsx)(r.xv,{className:"label",children:"\u4f53\u91cd"}),(0,h.jsx)(r.xv,{className:"value",children:b.weight?"".concat(b.weight,"kg"):"-"})]}),(0,h.jsxs)(r.G7,{className:"info-row",children:[(0,h.jsx)(r.xv,{className:"label",children:"\u8840\u578b"}),(0,h.jsx)(r.xv,{className:"value",children:b.bloodType||"-"})]}),(0,h.jsxs)(r.G7,{className:"info-row",children:[(0,h.jsx)(r.xv,{className:"label",children:"\u8fc7\u654f\u4fe1\u606f"}),(0,h.jsx)(r.xv,{className:"value",children:b.allergies||"\u65e0"})]})]}),(0,h.jsxs)(r.G7,{className:"info-group",children:[(0,h.jsx)(r.xv,{className:"group-title",children:"\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67 \u5bb6\u957f\u4fe1\u606f"}),(0,h.jsxs)(r.G7,{className:"info-row",children:[(0,h.jsx)(r.xv,{className:"label",children:"\u5bb6\u957f\u59d3\u540d"}),(0,h.jsx)(r.xv,{className:"value",children:v(b)||"-"})]}),(0,h.jsxs)(r.G7,{className:"info-row",children:[(0,h.jsx)(r.xv,{className:"label",children:"\u4e0e\u5b69\u5b50\u5173\u7cfb"}),(0,h.jsx)(r.xv,{className:"value",children:b.parent_relation||"-"})]}),(0,h.jsxs)(r.G7,{className:"info-row",children:[(0,h.jsx)(r.xv,{className:"label",children:"\u8054\u7cfb\u7535\u8bdd"}),(0,h.jsx)(r.xv,{className:"value clickable",onClick:function(){var e=f(b);e&&o().makePhoneCall({phoneNumber:e})},children:f(b)||"-"})]}),(0,h.jsxs)(r.G7,{className:"info-row",children:[(0,h.jsx)(r.xv,{className:"label",children:"\u5bb6\u5ead\u5730\u5740"}),(0,h.jsx)(r.xv,{className:"value",children:b.address||"-"})]})]})]})}),"attendance"===D&&(0,h.jsxs)(r.G7,{className:"attendance-section",children:[(0,h.jsxs)(r.G7,{className:"attendance-stats",children:[(0,h.jsxs)(r.G7,{className:"stat-item",children:[(0,h.jsx)(r.xv,{className:"number",children:L.filter(function(e){return"present"===e.status}).length}),(0,h.jsx)(r.xv,{className:"label",children:"\u51fa\u52e4"})]}),(0,h.jsxs)(r.G7,{className:"stat-item",children:[(0,h.jsx)(r.xv,{className:"number",style:{color:"#ef4444"},children:L.filter(function(e){return"absent"===e.status}).length}),(0,h.jsx)(r.xv,{className:"label",children:"\u7f3a\u52e4"})]}),(0,h.jsxs)(r.G7,{className:"stat-item",children:[(0,h.jsx)(r.xv,{className:"number",style:{color:"#f59e0b"},children:L.filter(function(e){return"sick"===e.status}).length}),(0,h.jsx)(r.xv,{className:"label",children:"\u75c5\u5047"})]}),(0,h.jsxs)(r.G7,{className:"stat-item",children:[(0,h.jsx)(r.xv,{className:"number",style:{color:"#3b82f6"},children:L.filter(function(e){return"leave"===e.status}).length}),(0,h.jsx)(r.xv,{className:"label",children:"\u4e8b\u5047"})]})]}),(0,h.jsx)(r.G7,{className:"record-list",children:L.length>0?L.map(function(e,s){return(0,h.jsxs)(r.G7,{className:"record-item",children:[(0,h.jsx)(r.xv,{className:"date",children:e.date}),(0,h.jsx)(r.xv,{className:"status",style:{color:X(e.status)},children:W(e.status)}),e.notes&&(0,h.jsx)(r.xv,{className:"notes",children:e.notes})]},s)}):(0,h.jsx)(r.G7,{className:"empty",children:(0,h.jsx)(r.xv,{children:"\u6682\u65e0\u8003\u52e4\u8bb0\u5f55"})})})]}),"payment"===D&&(0,h.jsx)(r.G7,{className:"payment-section",children:E.length>0?E.map(function(e,s){var n;return(0,h.jsxs)(r.G7,{className:"payment-item",children:[(0,h.jsxs)(r.G7,{className:"payment-header",children:[(0,h.jsxs)(r.xv,{className:"amount",children:["\xa5",e.amount.toLocaleString()]}),(0,h.jsx)(r.xv,{className:"status paid",children:"\u5df2\u7f34"})]}),(0,h.jsxs)(r.G7,{className:"payment-details",children:[(0,h.jsx)(r.xv,{className:"date",children:new Date(e.paymentDate).toLocaleDateString()}),(0,h.jsx)(r.xv,{className:"type",children:(null===(n=e.feeDetails)||void 0===n?void 0:n.map(function(e){return e.label}).join("\u3001"))||e.feeType})]}),e.notes&&(0,h.jsx)(r.xv,{className:"notes",children:e.notes})]},s)}):(0,h.jsx)(r.G7,{className:"empty",children:(0,h.jsx)(r.xv,{children:"\u6682\u65e0\u7f34\u8d39\u8bb0\u5f55"})})})]}),"attendance"===D&&(0,h.jsx)(r.G7,{className:"footer-btn",onClick:function(){return o().navigateTo({url:"/pages/students/attendance?id=".concat(a,"&name=").concat(b.name,"&class=").concat(j(b))})},children:(0,h.jsx)(r.xv,{children:"\ud83d\udcdd \u8bb0\u5f55\u4eca\u65e5\u8003\u52e4"})}),"payment"===D&&(0,h.jsx)(r.G7,{className:"footer-btn",onClick:function(){return o().navigateTo({url:"/pages/finance/payment"})},children:(0,h.jsx)(r.xv,{children:"\ud83d\udcb3 \u65b0\u5efa\u7f34\u8d39"})})]}):(0,h.jsx)(r.G7,{className:"loading",children:(0,h.jsx)(r.xv,{children:"\u52a0\u8f7d\u4e2d..."})})}var p={navigationBarTitleText:"\u5b66\u751f\u8be6\u60c5",navigationStyle:"custom",enableShareAppMessage:!0,enableShareTimeline:!0};N.enableShareTimeline=!0,N.enableShareAppMessage=!0;Page((0,a.createPageConfig)(N,"pages/students/detail",{root:{cn:[]}},p||{}))}},function(e){var s=function(s){return e(e.s=s)};e.O(0,[107,216,592],function(){return s(449)});e.O()}]);