"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[219],{3183:function(e,a,n){var s=n(2180),t=n(2688),c=n(5861),l=n(9439),r=n(7294),i=n(1515),o=n(2954),d=n.n(o),u=n(4751),m=n(5686),h=n(1977),x=n(4818),v=n(5893);function f(){(0,u.Z)({title:"\u91d1\u661f\u5e7c\u513f\u56ed - \u8d22\u52a1\u7ba1\u7406",path:"/pages/finance/index"});var e=(0,r.useState)([]),a=(0,l.Z)(e,2),n=a[0],s=a[1],f=(0,r.useState)("overview"),j=(0,l.Z)(f,2),N=j[0],p=j[1],y=(0,r.useState)((new Date).toISOString().slice(0,7)),g=(0,l.Z)(y,2),b=g[0],G=g[1],S=(0,r.useState)("\u5168\u90e8"),w=(0,l.Z)(S,2),k=w[0],M=w[1],C=(0,r.useState)(null),D=(0,l.Z)(C,2),L=D[0],Z=D[1],T=["\u5168\u90e8","\u6258\u73ed","\u5c0f\u4e00\u73ed","\u5c0f\u4e8c\u73ed","\u4e2d\u4e00\u73ed","\u4e2d\u4e8c\u73ed","\u5927\u4e00\u73ed","\u5927\u4e8c\u73ed"];(0,r.useEffect)(function(){_();var e=d().getStorageSync("kt_current_user");Z(e)},[]),(0,o.useDidShow)(function(){_()});var _=function(){var e=(0,c.Z)((0,t.Z)().m(function e(){var a,n;return(0,t.Z)().w(function(e){while(1)switch(e.n){case 0:if(a=d().getStorageSync("kt_payments")||[],s(a),!m.jv){e.n=2;break}return e.n=1,(0,m.LL)();case 1:n=e.v,n.success&&n.data&&s(n.data);case 2:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),A="SUPER_ADMIN"===(null===L||void 0===L?void 0:L.role)||"admin"===(null===L||void 0===L?void 0:L.role),O=n.filter(function(e){var a,n=null===(a=e.paymentDate)||void 0===a?void 0:a.startsWith(b),s="\u5168\u90e8"===k||e.studentClass===k;return n&&s}),P={totalAmount:O.reduce(function(e,a){return e+a.amount},0),totalCount:O.length,byMethod:{wechat:O.filter(function(e){return"wechat"===e.paymentMethod}).reduce(function(e,a){return e+a.amount},0),alipay:O.filter(function(e){return"alipay"===e.paymentMethod}).reduce(function(e,a){return e+a.amount},0),cash:O.filter(function(e){return"cash"===e.paymentMethod}).reduce(function(e,a){return e+a.amount},0),transfer:O.filter(function(e){return"transfer"===e.paymentMethod}).reduce(function(e,a){return e+a.amount},0)},byClass:T.slice(1).map(function(e){return{name:e,amount:n.filter(function(a){var n;return a.studentClass===e&&(null===(n=a.paymentDate)||void 0===n?void 0:n.startsWith(b))}).reduce(function(e,a){return e+a.amount},0)}})},W=function(e){var a=new Date(e);return"".concat(a.getMonth()+1,"/").concat(a.getDate()," ").concat(a.getHours(),":").concat(String(a.getMinutes()).padStart(2,"0"))},E=function(e){var a={wechat:"\u5fae\u4fe1",alipay:"\u652f\u4ed8\u5b9d",cash:"\u73b0\u91d1",transfer:"\u8f6c\u8d26"};return a[e]||e},I=function(e){var a={wechat:"\ud83d\udc9a",alipay:"\ud83d\udc99",cash:"\ud83d\udcb5",transfer:"\ud83c\udfe6"};return a[e]||"\ud83d\udcb0"},J=function(e){A?d().showModal({title:"\u786e\u8ba4\u5220\u9664",content:"\u5220\u9664\u540e\u65e0\u6cd5\u6062\u590d\uff0c\u786e\u8ba4\u5220\u9664\uff1f",success:function(a){if(a.confirm){var t=n.filter(function(a){return a.id!==e});d().setStorageSync("kt_payments",t),h.LC&&(0,h.Qu)("kt_payments",t).catch(function(){}),s(t),d().showToast({title:"\u5df2\u5220\u9664",icon:"success"})}}}):d().showToast({title:"\u65e0\u6743\u9650\u64cd\u4f5c",icon:"none"})};return(0,v.jsxs)(i.G7,{className:"finance-page",children:[(0,v.jsx)(x.Z,{title:"\u6536\u8d39\u7ba1\u7406"}),(0,v.jsx)(x.p,{}),(0,v.jsxs)(i.G7,{className:"info-banner",children:[(0,v.jsx)(i.xv,{className:"info-icon",children:"\ud83d\udca1"}),(0,v.jsxs)(i.xv,{className:"info-text",children:["\u5b8c\u6574\u8d22\u52a1\u7ba1\u7406\u8bf7\u5230\u7f51\u7ad9\u540e\u53f0\uff1a",(0,v.jsx)(i.xv,{className:"link",children:"venus-management.com"})]})]}),(0,v.jsxs)(i.G7,{className:"filter-bar",children:[(0,v.jsx)(i.cW,{mode:"date",fields:"month",value:b,onChange:function(e){return G(e.detail.value)},children:(0,v.jsx)(i.G7,{className:"filter-item",children:(0,v.jsxs)(i.xv,{className:"label",children:["\ud83d\udcc5 ",b]})})}),(0,v.jsx)(i.G7,{className:"filter-item",onClick:function(){var e=T.indexOf(k),a=(e+1)%T.length;M(T[a])},children:(0,v.jsxs)(i.xv,{className:"label",children:["\ud83c\udfeb ",k]})})]}),(0,v.jsx)(i.G7,{className:"tabs",children:[{key:"overview",label:"\u6982\u89c8"},{key:"list",label:"\u7f34\u8d39\u8bb0\u5f55"}].map(function(e){return(0,v.jsx)(i.G7,{className:"tab ".concat(N===e.key?"active":""),onClick:function(){return p(e.key)},children:(0,v.jsx)(i.xv,{children:e.label})},e.key)})}),(0,v.jsxs)(i.pf,{className:"content",scrollY:!0,children:["overview"===N&&(0,v.jsxs)(i.G7,{className:"overview",children:[(0,v.jsxs)(i.G7,{className:"total-card",children:[(0,v.jsx)(i.xv,{className:"label",children:"\u672c\u6708\u6536\u8d39\u603b\u989d"}),(0,v.jsxs)(i.xv,{className:"amount",children:["\xa5",P.totalAmount.toLocaleString()]}),(0,v.jsxs)(i.xv,{className:"count",children:[P.totalCount,"\u7b14\u4ea4\u6613"]})]}),(0,v.jsxs)(i.G7,{className:"method-cards",children:[(0,v.jsxs)(i.G7,{className:"method-card wechat",children:[(0,v.jsx)(i.xv,{className:"icon",children:"\ud83d\udc9a"}),(0,v.jsx)(i.xv,{className:"label",children:"\u5fae\u4fe1"}),(0,v.jsxs)(i.xv,{className:"amount",children:["\xa5",P.byMethod.wechat.toLocaleString()]})]}),(0,v.jsxs)(i.G7,{className:"method-card alipay",children:[(0,v.jsx)(i.xv,{className:"icon",children:"\ud83d\udc99"}),(0,v.jsx)(i.xv,{className:"label",children:"\u652f\u4ed8\u5b9d"}),(0,v.jsxs)(i.xv,{className:"amount",children:["\xa5",P.byMethod.alipay.toLocaleString()]})]}),(0,v.jsxs)(i.G7,{className:"method-card cash",children:[(0,v.jsx)(i.xv,{className:"icon",children:"\ud83d\udcb5"}),(0,v.jsx)(i.xv,{className:"label",children:"\u73b0\u91d1"}),(0,v.jsxs)(i.xv,{className:"amount",children:["\xa5",P.byMethod.cash.toLocaleString()]})]}),(0,v.jsxs)(i.G7,{className:"method-card transfer",children:[(0,v.jsx)(i.xv,{className:"icon",children:"\ud83c\udfe6"}),(0,v.jsx)(i.xv,{className:"label",children:"\u8f6c\u8d26"}),(0,v.jsxs)(i.xv,{className:"amount",children:["\xa5",P.byMethod.transfer.toLocaleString()]})]})]}),(0,v.jsxs)(i.G7,{className:"section",children:[(0,v.jsx)(i.xv,{className:"section-title",children:"\u6700\u8fd1\u4ea4\u6613"}),O.slice(0,5).map(function(e){return(0,v.jsxs)(i.G7,{className:"payment-row",children:[(0,v.jsxs)(i.G7,{className:"info",children:[(0,v.jsx)(i.xv,{className:"name",children:e.studentName}),(0,v.jsxs)(i.xv,{className:"meta",children:[e.studentClass," \xb7 ",W(e.paymentDate)]})]}),(0,v.jsxs)(i.xv,{className:"amount",children:["\xa5",e.amount.toLocaleString()]})]},e.id)}),0===O.length&&(0,v.jsx)(i.G7,{className:"empty",children:(0,v.jsx)(i.xv,{children:"\u6682\u65e0\u4ea4\u6613\u8bb0\u5f55"})})]})]}),"list"===N&&(0,v.jsxs)(i.G7,{className:"list-view",children:[O.map(function(e){var a;return(0,v.jsxs)(i.G7,{className:"payment-card",children:[(0,v.jsxs)(i.G7,{className:"card-header",children:[(0,v.jsxs)(i.G7,{className:"student",children:[(0,v.jsx)(i.xv,{className:"name",children:e.studentName}),(0,v.jsx)(i.xv,{className:"class",children:e.studentClass})]}),(0,v.jsxs)(i.xv,{className:"amount",children:["\xa5",e.amount.toLocaleString()]})]}),(0,v.jsxs)(i.G7,{className:"card-body",children:[(0,v.jsxs)(i.G7,{className:"info-row",children:[(0,v.jsx)(i.xv,{className:"label",children:"\u652f\u4ed8\u65b9\u5f0f"}),(0,v.jsxs)(i.xv,{className:"value",children:[I(e.paymentMethod)," ",E(e.paymentMethod)]})]}),(0,v.jsxs)(i.G7,{className:"info-row",children:[(0,v.jsx)(i.xv,{className:"label",children:"\u7f34\u8d39\u9879\u76ee"}),(0,v.jsx)(i.xv,{className:"value",children:(null===(a=e.feeDetails)||void 0===a?void 0:a.map(function(e){return e.label}).join("\u3001"))||"-"})]}),(0,v.jsxs)(i.G7,{className:"info-row",children:[(0,v.jsx)(i.xv,{className:"label",children:"\u7f34\u8d39\u65f6\u95f4"}),(0,v.jsx)(i.xv,{className:"value",children:new Date(e.paymentDate).toLocaleString()})]})]}),A&&(0,v.jsx)(i.G7,{className:"card-footer",children:(0,v.jsx)(i.G7,{className:"delete-btn",onClick:function(){return J(e.id)},children:(0,v.jsx)(i.xv,{children:"\ud83d\uddd1\ufe0f \u5220\u9664"})})})]},e.id)}),0===O.length&&(0,v.jsxs)(i.G7,{className:"empty-large",children:[(0,v.jsx)(i.xv,{className:"icon",children:"\ud83d\udced"}),(0,v.jsx)(i.xv,{className:"text",children:"\u6682\u65e0\u7f34\u8d39\u8bb0\u5f55"})]})]}),(0,v.jsx)(i.G7,{style:{height:"150rpx"}})]}),(0,v.jsx)(i.G7,{className:"fab",onClick:function(){return d().navigateTo({url:"/pages/finance/payment"})},children:(0,v.jsx)(i.xv,{children:"+ \u65b0\u5efa\u6536\u8d39"})})]})}var j={navigationBarTitleText:"\u6536\u8d39\u7ba1\u7406",navigationStyle:"custom",enableShareAppMessage:!0,enableShareTimeline:!0};f.enableShareTimeline=!0,f.enableShareAppMessage=!0;Page((0,s.createPageConfig)(f,"pages/finance/index",{root:{cn:[]}},j||{}))}},function(e){var a=function(a){return e(e.s=a)};e.O(0,[107,216,592],function(){return a(3183)});e.O()}]);