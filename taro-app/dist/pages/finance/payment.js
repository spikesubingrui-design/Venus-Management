"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[466],{6136:function(e,n,c){var t=c(2180),s=c(1413),a=c(9439),l=c(7294),i=c(1515),r=c(2954),o=c.n(r),u=c(4751),d=c(5686),m=c(1977),h=c(857),x=c(4818),f=c(5893);function p(){(0,u.Z)({title:"\u91d1\u661f\u5e7c\u513f\u56ed - \u7f34\u8d39\u7ba1\u7406",path:"/pages/finance/payment"});var e=(0,l.useState)([]),n=(0,a.Z)(e,2),c=n[0],t=n[1],r=(0,l.useState)(null),p=(0,a.Z)(r,2),k=p[0],j=p[1],y=(0,l.useState)(-1),N=(0,a.Z)(y,2),v=(N[0],N[1],(0,l.useState)("")),b=(0,a.Z)(v,2),g=b[0],S=b[1],G=(0,l.useState)([{key:"tuition",label:"\u4fdd\u6559\u8d39",price:1200,checked:!0},{key:"meal",label:"\u4f19\u98df\u8d39",price:330,checked:!0},{key:"itemFee",label:"\u6742\u9879\u8d39",price:700,checked:!1},{key:"schoolBag",label:"\u4e66\u5305",price:120,checked:!1},{key:"uniform",label:"\u6821\u670d",price:280,checked:!1},{key:"beddingOuter",label:"\u5e8a\u54c1\u5916\u76ae",price:268,checked:!1},{key:"beddingInner",label:"\u5e8a\u54c1\u5185\u82af",price:160,checked:!1}]),w=(0,a.Z)(G,2),Z=w[0],C=w[1],T=(0,l.useState)("monthly"),I=(0,a.Z)(T,2),D=I[0],O=I[1],_=(0,l.useState)("wechat"),L=(0,a.Z)(_,2),M=L[0],q=L[1],A=(0,l.useState)(""),B=(0,a.Z)(A,2),P=B[0],E=B[1];(0,l.useEffect)(function(){J()},[]);var J=function(){var e=o().getStorageSync("kt_students")||[];t(e)},z=c.filter(function(e){return e.name.includes(g)||e.class.includes(g)}),F=function(e){C(function(n){return n.map(function(n){return n.key===e?(0,s.Z)((0,s.Z)({},n),{},{checked:!n.checked}):n})})},Q=function(){var e=0,n=Z.filter(function(e){return e.checked});return n.forEach(function(n){if("tuition"===n.key||"meal"===n.key){var c="monthly"===D?1:"semester"===D?6:12;e+=n.price*c}else e+=n.price}),e},Y=function(){if(k){var e=Z.filter(function(e){return e.checked});if(0!==e.length){var n=Q();o().showModal({title:"\u786e\u8ba4\u7f34\u8d39",content:"\u5b66\u751f\uff1a".concat(k.name,"\n\u91d1\u989d\uff1a\xa5").concat(n.toLocaleString(),"\n\u786e\u8ba4\u63d0\u4ea4\uff1f"),success:function(c){if(c.confirm){var t={id:"pay_".concat(Date.now()),studentId:k.id,studentName:k.name,studentClass:k.class,amount:n,feeType:e.map(function(e){return e.key}).join(","),feeDetails:e.map(function(e){return{key:e.key,label:e.label,price:e.price}}),periodType:D,paymentMethod:M,status:"paid",paymentDate:(new Date).toISOString(),createdAt:(new Date).toISOString(),notes:P},s=o().getStorageSync("kt_payments")||[];s.unshift(t),o().setStorageSync("kt_payments",s),m.LC&&(0,m.Qu)("kt_payments",s).catch(function(){}),d.jv&&(0,d.uploadPayment)(t).then(function(e){e.success||console.log("\u540c\u6b65\u5230\u4e91\u7aef\u5931\u8d25:",e.error)}),(0,h.NZ)({studentName:k.name,feeType:e.map(function(e){return e.label}).join("\u3001"),amount:n,dueDate:(new Date).toLocaleDateString("zh-CN")}),o().showToast({title:"\u7f34\u8d39\u6210\u529f",icon:"success"}),setTimeout(function(){o().navigateBack()},1500)}}})}else o().showToast({title:"\u8bf7\u9009\u62e9\u7f34\u8d39\u9879\u76ee",icon:"none"})}else o().showToast({title:"\u8bf7\u9009\u62e9\u5b66\u751f",icon:"none"})},H=function(e){"monthly"===e?(C(function(e){return e.map(function(e){return(0,s.Z)((0,s.Z)({},e),{},{checked:"tuition"===e.key||"meal"===e.key})})}),O("monthly")):(C(function(e){return e.map(function(e){return(0,s.Z)((0,s.Z)({},e),{},{checked:!0})})}),O("monthly"))},K=Q();return(0,f.jsxs)(i.G7,{className:"payment-page",children:[(0,f.jsx)(x.Z,{title:"\u65b0\u5efa\u6536\u8d39"}),(0,f.jsx)(x.p,{}),(0,f.jsxs)(i.G7,{className:"section",children:[(0,f.jsx)(i.xv,{className:"section-title",children:"\u9009\u62e9\u5b66\u751f"}),(0,f.jsx)(i.G7,{className:"search-box",children:(0,f.jsx)(i.II,{placeholder:"\u641c\u7d22\u5b66\u751f\u59d3\u540d\u6216\u73ed\u7ea7",value:g,onInput:function(e){return S(e.detail.value)}})}),g&&z.length>0&&(0,f.jsx)(i.pf,{className:"student-dropdown",scrollY:!0,children:z.slice(0,5).map(function(e){return(0,f.jsxs)(i.G7,{className:"dropdown-item",onClick:function(){j(e),S("")},children:[(0,f.jsx)(i.xv,{children:e.name}),(0,f.jsx)(i.xv,{className:"class",children:e.class})]},e.id)})}),k&&(0,f.jsxs)(i.G7,{className:"selected-student",children:[(0,f.jsx)(i.xv,{className:"name",children:k.name}),(0,f.jsx)(i.xv,{className:"class",children:k.class}),(0,f.jsx)(i.xv,{className:"remove",onClick:function(){return j(null)},children:"\xd7"})]})]}),(0,f.jsxs)(i.G7,{className:"section",children:[(0,f.jsx)(i.xv,{className:"section-title",children:"\u5feb\u6377\u9009\u62e9"}),(0,f.jsxs)(i.G7,{className:"quick-btns",children:[(0,f.jsxs)(i.G7,{className:"quick-btn",onClick:function(){return H("monthly")},children:[(0,f.jsx)(i.xv,{children:"\ud83d\udcc5 \u6708\u7f34\u5957\u9910"}),(0,f.jsx)(i.xv,{className:"desc",children:"\u4fdd\u6559\u8d39+\u4f19\u98df\u8d39"})]}),(0,f.jsxs)(i.G7,{className:"quick-btn new",onClick:function(){return H("newStudent")},children:[(0,f.jsx)(i.xv,{children:"\ud83c\udf92 \u65b0\u751f\u5165\u56ed"}),(0,f.jsx)(i.xv,{className:"desc",children:"\u5168\u90e8\u8d39\u7528"})]})]})]}),(0,f.jsxs)(i.G7,{className:"section",children:[(0,f.jsx)(i.xv,{className:"section-title",children:"\u8d39\u7528\u9879\u76ee"}),(0,f.jsx)(i.G7,{className:"fee-list",children:Z.map(function(e){return(0,f.jsxs)(i.G7,{className:"fee-item ".concat(e.checked?"checked":""),onClick:function(){return F(e.key)},children:[(0,f.jsx)(i.G7,{className:"checkbox",children:e.checked?"\u2713":""}),(0,f.jsx)(i.xv,{className:"label",children:e.label}),(0,f.jsxs)(i.xv,{className:"price",children:["\xa5",e.price]})]},e.key)})})]}),(0,f.jsxs)(i.G7,{className:"section",children:[(0,f.jsx)(i.xv,{className:"section-title",children:"\u7f34\u8d39\u5468\u671f\uff08\u4fdd\u6559\u8d39/\u4f19\u98df\u8d39\uff09"}),(0,f.jsx)(i.G7,{className:"period-options",children:["monthly","semester","yearly"].map(function(e){return(0,f.jsx)(i.G7,{className:"period-btn ".concat(D===e?"active":""),onClick:function(){return O(e)},children:(0,f.jsx)(i.xv,{children:"monthly"===e?"\u6309\u6708":"semester"===e?"\u534a\u5e74":"\u4e00\u5e74"})},e)})})]}),(0,f.jsxs)(i.G7,{className:"section",children:[(0,f.jsx)(i.xv,{className:"section-title",children:"\u652f\u4ed8\u65b9\u5f0f"}),(0,f.jsx)(i.G7,{className:"payment-methods",children:[{key:"wechat",label:"\u5fae\u4fe1",icon:"\ud83d\udc9a"},{key:"alipay",label:"\u652f\u4ed8\u5b9d",icon:"\ud83d\udc99"},{key:"cash",label:"\u73b0\u91d1",icon:"\ud83d\udcb5"},{key:"transfer",label:"\u8f6c\u8d26",icon:"\ud83c\udfe6"}].map(function(e){return(0,f.jsxs)(i.G7,{className:"method-btn ".concat(M===e.key?"active":""),onClick:function(){return q(e.key)},children:[(0,f.jsx)(i.xv,{className:"icon",children:e.icon}),(0,f.jsx)(i.xv,{children:e.label})]},e.key)})})]}),(0,f.jsxs)(i.G7,{className:"section",children:[(0,f.jsx)(i.xv,{className:"section-title",children:"\u5907\u6ce8"}),(0,f.jsx)(i.II,{className:"notes-input",placeholder:"\u53ef\u9009\u586b\u5199\u5907\u6ce8\u4fe1\u606f",value:P,onInput:function(e){return E(e.detail.value)}})]}),(0,f.jsxs)(i.G7,{className:"footer",children:[(0,f.jsxs)(i.G7,{className:"total",children:[(0,f.jsx)(i.xv,{className:"label",children:"\u5e94\u4ed8\u91d1\u989d"}),(0,f.jsxs)(i.xv,{className:"amount",children:["\xa5",K.toLocaleString()]})]}),(0,f.jsx)(i.G7,{className:"submit-btn",onClick:Y,children:(0,f.jsx)(i.xv,{children:"\u786e\u8ba4\u6536\u6b3e"})})]})]})}var k={navigationBarTitleText:"\u65b0\u5efa\u6536\u8d39",navigationStyle:"custom",enableShareAppMessage:!0,enableShareTimeline:!0};p.enableShareTimeline=!0,p.enableShareAppMessage=!0;Page((0,t.createPageConfig)(p,"pages/finance/payment",{root:{cn:[]}},k||{}))}},function(e){var n=function(n){return e(e.s=n)};e.O(0,[107,216,592],function(){return n(6136)});e.O()}]);