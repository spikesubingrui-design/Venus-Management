"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[3],{8716:function(e,s,n){var a=n(2180),r=n(3433),t=n(1002),c=n(1413),i=n(2688),o=n(5861),l=n(9439),u=n(7294),d=n(1515),h=n(2954),m=n.n(h),p=n(4751),v=n(1977),f=!0,g={functionUrl:"https://venus-gfectwrqon.cn-beijing.fcapp.run"},x=new Map;function j(e){return k.apply(this,arguments)}function k(){return k=(0,o.Z)((0,i.Z)().m(function e(s){var n,a,r,t,c,o,l,u,d,h,p;return(0,i.Z)().w(function(e){while(1)switch(e.p=e.n){case 0:if(s&&/^1[3-9]\d{9}$/.test(s)){e.n=1;break}return e.a(2,{success:!1,message:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u624b\u673a\u53f7\u7801"});case 1:if(n=x.get(s),!(n&&Date.now()-n.sentAt<6e4)){e.n=2;break}return a=Math.ceil((6e4-(Date.now()-n.sentAt))/1e3),e.a(2,{success:!1,message:"\u8bf7".concat(a,"\u79d2\u540e\u518d\u8bd5")});case 2:if(r=Math.floor(1e5+9e5*Math.random()).toString(),t=Date.now(),c=t+3e5,!f||!g.functionUrl){e.n=13;break}return e.p=3,console.log("[SMS] \u8c03\u7528\u4e91\u51fd\u6570\u53d1\u9001\u77ed\u4fe1..."),e.n=4,m().request({url:g.functionUrl,method:"POST",header:{"Content-Type":"application/json"},data:{action:"send",phone:s},timeout:15e3});case 4:if(o=e.v,console.log("[SMS] \u4e91\u51fd\u6570\u54cd\u5e94:",o),console.log("[SMS] \u54cd\u5e94\u72b6\u6001\u7801:",o.statusCode),console.log("[SMS] \u54cd\u5e94\u6570\u636e:",o.data),200!==o.statusCode){e.n=7;break}if(l="string"===typeof o.data?JSON.parse(o.data):o.data,!l||!l.success){e.n=5;break}return x.set(s,{code:"",expiresAt:l.expiresAt||c,sentAt:t,verifyToken:l.verifyToken||""}),e.a(2,{success:!0,message:l.message||"\u9a8c\u8bc1\u7801\u5df2\u53d1\u9001\u5230\u60a8\u7684\u624b\u673a"});case 5:return e.a(2,{success:!1,message:l&&l.message||"\u53d1\u9001\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5"});case 6:e.n=10;break;case 7:if(429!==o.statusCode){e.n=8;break}return e.a(2,{success:!1,message:"\u53d1\u9001\u592a\u9891\u7e41\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5"});case 8:if(400!==o.statusCode){e.n=9;break}return u="string"===typeof o.data?JSON.parse(o.data):o.data,e.a(2,{success:!1,message:u&&u.message||"\u8bf7\u6c42\u53c2\u6570\u9519\u8bef"});case 9:return console.error("[SMS] \u4e91\u51fd\u6570\u9519\u8bef:",o),e.a(2,{success:!1,message:"\u670d\u52a1\u9519\u8bef(".concat(o.statusCode,")")});case 10:e.n=13;break;case 11:if(e.p=11,p=e.v,console.error("[SMS] \u8bf7\u6c42\u5931\u8d25:",p),!(null!==(d=p.errMsg)&&void 0!==d&&d.includes("timeout")||null!==(h=p.errMsg)&&void 0!==h&&h.includes("fail"))){e.n=12;break}return console.log("[SMS] \u7f51\u7edc\u9519\u8bef\uff0c\u56de\u9000\u5230\u5f00\u53d1\u6a21\u5f0f"),x.set(s,{code:r,expiresAt:c,sentAt:t}),e.a(2,{success:!0,message:"\u7f51\u7edc\u5f02\u5e38\uff0c\u4f7f\u7528\u5f00\u53d1\u6a21\u5f0f",code:r});case 12:return e.a(2,{success:!1,message:"\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5"});case 13:return x.set(s,{code:r,expiresAt:c,sentAt:t}),console.log("[SMS \u5f00\u53d1\u6a21\u5f0f] ".concat(s," => ").concat(r)),e.a(2,{success:!0,message:"\u9a8c\u8bc1\u7801\u5df2\u751f\u6210\uff08\u5f00\u53d1\u6a21\u5f0f\uff09",code:r})}},e,null,[[3,11]])})),k.apply(this,arguments)}function b(e,s){return N.apply(this,arguments)}function N(){return N=(0,o.Z)((0,i.Z)().m(function e(s,n){var a,r,t,c,o,l,u,d;return(0,i.Z)().w(function(e){while(1)switch(e.p=e.n){case 0:if(s&&n){e.n=1;break}return e.a(2,{success:!1,message:"\u8bf7\u8f93\u5165\u624b\u673a\u53f7\u548c\u9a8c\u8bc1\u7801"});case 1:if(/^\d{6}$/.test(n)){e.n=2;break}return e.a(2,{success:!1,message:"\u9a8c\u8bc1\u7801\u683c\u5f0f\u9519\u8bef"});case 2:if(!f||!g.functionUrl){e.n=8;break}return e.p=3,a=x.get(s),r={action:"verify",phone:s,code:n},null!==a&&void 0!==a&&a.verifyToken&&(r.verifyToken=a.verifyToken,r.expiresAt=a.expiresAt),e.n=4,m().request({url:g.functionUrl,method:"POST",header:{"Content-Type":"application/json"},data:r,timeout:1e4});case 4:if(t=e.v,200!==t.statusCode){e.n=5;break}return o="string"===typeof t.data?JSON.parse(t.data):t.data,null!==o&&void 0!==o&&o.success&&x.delete(s),e.a(2,{success:null!==(c=null===o||void 0===o?void 0:o.success)&&void 0!==c&&c,message:(null===o||void 0===o?void 0:o.message)||(null!==o&&void 0!==o&&o.success?"\u9a8c\u8bc1\u6210\u529f":"\u9a8c\u8bc1\u5931\u8d25")});case 5:return l="string"===typeof t.data?JSON.parse(t.data):t.data,e.a(2,{success:!1,message:(null===l||void 0===l?void 0:l.message)||"\u9a8c\u8bc1\u5931\u8d25"});case 6:e.n=8;break;case 7:e.p=7,d=e.v,console.error("[SMS] \u9a8c\u8bc1\u8bf7\u6c42\u5931\u8d25:",d);case 8:if(u=x.get(s),u){e.n=9;break}return e.a(2,{success:!1,message:"\u8bf7\u5148\u83b7\u53d6\u9a8c\u8bc1\u7801"});case 9:if(!(Date.now()>u.expiresAt)){e.n=10;break}return x.delete(s),e.a(2,{success:!1,message:"\u9a8c\u8bc1\u7801\u5df2\u8fc7\u671f\uff0c\u8bf7\u91cd\u65b0\u83b7\u53d6"});case 10:if(!u.code||u.code===n){e.n=11;break}return e.a(2,{success:!1,message:"\u9a8c\u8bc1\u7801\u9519\u8bef"});case 11:return x.delete(s),e.a(2,{success:!0,message:"\u9a8c\u8bc1\u6210\u529f"})}},e,null,[[3,7]])})),N.apply(this,arguments)}function S(){return f&&!!g.functionUrl}var w="https://venus-gfectwrqon.cn-beijing.fcapp.run",Z=function(){var e=(0,o.Z)((0,i.Z)().m(function e(s){var n,a,r,t,c;return(0,i.Z)().w(function(e){while(1)switch(e.p=e.n){case 0:return e.p=0,e.n=1,m().request({url:w,method:"POST",data:{action:"getPhoneNumber",code:s},header:{"Content-Type":"application/json"},timeout:1e4});case 1:if(t=e.v,200!==t.statusCode||null===(n=t.data)||void 0===n||!n.success||null===(a=t.data)||void 0===a||!a.phone){e.n=2;break}return console.log("[WxPhone] \u624b\u673a\u53f7\u83b7\u53d6\u6210\u529f"),e.a(2,{success:!0,phone:t.data.phone});case 2:return e.a(2,{success:!1,error:(null===(r=t.data)||void 0===r?void 0:r.error)||"\u83b7\u53d6\u624b\u673a\u53f7\u5931\u8d25\uff0c\u8bf7\u4f7f\u7528\u9a8c\u8bc1\u7801\u767b\u5f55"});case 3:return e.p=3,c=e.v,console.error("[WxPhone] \u8bf7\u6c42\u5931\u8d25:",c),e.a(2,{success:!1,error:"\u7f51\u7edc\u8bf7\u6c42\u5931\u8d25\uff0c\u8bf7\u4f7f\u7528\u9a8c\u8bc1\u7801\u767b\u5f55"})}},e,null,[[0,3]])}));return function(s){return e.apply(this,arguments)}}(),y=n(4266),C=n(6949),_=n(5893),G=function(e){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";m().showToast({title:e||"\u64cd\u4f5c\u5b8c\u6210",icon:s})};function T(){var e=(0,u.useState)("login"),s=(0,l.Z)(e,2),n=s[0],a=s[1],h=(0,u.useState)("password"),f=(0,l.Z)(h,2),g=f[0],x=f[1],k=(0,u.useState)(""),N=(0,l.Z)(k,2),w=N[0],T=N[1],A=(0,u.useState)(""),I=(0,l.Z)(A,2),M=I[0],L=I[1],E=(0,u.useState)(""),P=(0,l.Z)(E,2),O=(P[0],P[1],(0,u.useState)("")),D=(0,l.Z)(O,2),R=D[0],U=D[1],H=(0,u.useState)(!1),J=(0,l.Z)(H,2),q=J[0],z=J[1],F=(0,u.useState)(!1),K=(0,l.Z)(F,2),W=K[0],$=K[1],B=(0,u.useState)("TEACHER"),Y=(0,l.Z)(B,2),Q=(Y[0],Y[1],(0,u.useState)("\u603b\u56ed")),V=(0,l.Z)(Q,2),X=(V[0],V[1],(0,u.useState)("")),ee=(0,l.Z)(X,2),se=ee[0],ne=ee[1],ae=(0,u.useState)(0),re=(0,l.Z)(ae,2),te=re[0],ce=re[1],ie=(0,u.useState)(""),oe=(0,l.Z)(ie,2),le=oe[0],ue=oe[1],de=(0,u.useState)(!1),he=(0,l.Z)(de,2),me=he[0],pe=he[1],ve=(0,u.useState)(null),fe=(0,l.Z)(ve,2),ge=fe[0],xe=fe[1];(0,p.Z)({title:"\u91d1\u661f\u5e7c\u513f\u56ed - \u667a\u6167\u6821\u56ed\u7ba1\u7406",path:"/pages/login/index"}),(0,u.useEffect)(function(){var e=m().getStorageSync("kt_current_user");e&&(0,y.t)("/pages/index/index")},[]),(0,u.useEffect)(function(){if(te>0){var e=setTimeout(function(){return ce(te-1)},1e3);return function(){return clearTimeout(e)}}},[te]);var je=function(e){for(var s=0,n=0;n<e.length;n++){var a=e.charCodeAt(n);s=(s<<5)-s+a,s&=s}return"hash_"+Math.abs(s).toString(16)},ke=function(){var e=(0,o.Z)((0,i.Z)().m(function e(){var s,n;return(0,i.Z)().w(function(e){while(1)switch(e.p=e.n){case 0:if(v.LC){e.n=1;break}return e.a(2);case 1:return m().showLoading({title:"\u540c\u6b65\u6570\u636e\u4e2d..."}),e.p=2,e.n=3,(0,v.K)();case 3:s=e.v,m().hideLoading(),s.success&&(console.log("[Login] \u540c\u6b65\u5b8c\u6210: ".concat(s.students,"\u5b66\u751f, ").concat(s.staff,"\u6559\u804c\u5de5")),m().setStorageSync("kt_last_sync_time",(new Date).toISOString())),e.n=5;break;case 4:e.p=4,n=e.v,m().hideLoading(),console.error("[Login] \u540c\u6b65\u5931\u8d25:",n);case 5:return e.a(2)}},e,null,[[2,4]])}));return function(){return e.apply(this,arguments)}}(),be=function(){var e=(0,o.Z)((0,i.Z)().m(function e(s){var n,a,r;return(0,i.Z)().w(function(e){while(1)switch(e.n){case 0:return e.n=1,ke();case 1:n=m().getStorageSync("kt_staff")||[],a=n.find(function(e){return e.phone===s.phone}),r=(0,c.Z)((0,c.Z)({},s),{},{name:(null===a||void 0===a?void 0:a.name)||s.name,role:(null===a||void 0===a?void 0:a.role)||s.role,assignedClasses:(null===a||void 0===a?void 0:a.assignedClasses)||s.assignedClasses||[]}),console.log("[Login] \u7528\u6237\u4fe1\u606f:",r),m().setStorageSync("kt_current_user",r),G("\u767b\u5f55\u6210\u529f","success"),setTimeout(function(){(0,y.t)("/pages/index/index")},1e3);case 2:return e.a(2)}},e)}));return function(s){return e.apply(this,arguments)}}(),Ne=function(){var e=(0,o.Z)((0,i.Z)().m(function e(){var s,n;return(0,i.Z)().w(function(e){while(1)switch(e.p=e.n){case 0:if(w.trim()&&11===w.length){e.n=1;break}return G("\u8bf7\u8f93\u5165\u6709\u6548\u624b\u673a\u53f7"),e.a(2);case 1:if(!(te>0)){e.n=2;break}return e.a(2);case 2:return m().showLoading({title:"\u53d1\u9001\u4e2d..."}),e.p=3,e.n=4,j(w);case 4:s=e.v,m().hideLoading(),s&&s.success?(ce(60),s.code?(ue(s.code),m().showModal({title:"\u5f00\u53d1\u6a21\u5f0f",content:"\u9a8c\u8bc1\u7801: ".concat(s.code,"\n\n\uff08\u6b63\u5f0f\u73af\u5883\u4f1a\u53d1\u9001\u77ed\u4fe1\uff09"),showCancel:!1})):G(s.message||"\u9a8c\u8bc1\u7801\u5df2\u53d1\u9001","success")):G((null===s||void 0===s?void 0:s.message)||"\u53d1\u9001\u5931\u8d25"),e.n=6;break;case 5:e.p=5,n=e.v,m().hideLoading(),console.error("[SMS] \u53d1\u9001\u5f02\u5e38:",n),G("\u53d1\u9001\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5");case 6:return e.a(2)}},e,null,[[3,5]])}));return function(){return e.apply(this,arguments)}}(),Se=function(){var e=(0,o.Z)((0,i.Z)().m(function e(){var s,n,a;return(0,i.Z)().w(function(e){while(1)switch(e.n){case 0:if(w.trim()){e.n=1;break}return G("\u8bf7\u8f93\u5165\u624b\u673a\u53f7"),e.a(2);case 1:if(M.trim()){e.n=2;break}return G("\u8bf7\u8f93\u5165\u5bc6\u7801"),e.a(2);case 2:if(z(!0),"18513001100"!==w){e.n=6;break}if("su123789"!==M){e.n=4;break}return e.n=3,be({id:"super_admin",phone:"18513001100",name:"\u7cfb\u7edf\u7ba1\u7406\u5458",role:"SUPER_ADMIN",campus:"\u91d1\u661f\u5e7c\u513f\u56ed"});case 3:e.n=5;break;case 4:G("\u5bc6\u7801\u9519\u8bef");case 5:return z(!1),e.a(2);case 6:if("admin"!==w){e.n=10;break}if("admin123"!==M){e.n=8;break}return e.n=7,be({id:"test_admin",phone:"admin",name:"\u6d4b\u8bd5\u7ba1\u7406\u5458",role:"SUPER_ADMIN",campus:"\u91d1\u661f\u5e7c\u513f\u56ed"});case 7:e.n=9;break;case 8:G("\u5bc6\u7801\u9519\u8bef");case 9:return z(!1),e.a(2);case 10:if("teacher"!==w){e.n=14;break}if("teacher123"!==M){e.n=12;break}return e.n=11,be({id:"test_teacher",phone:"teacher",name:"\u5f20\u8001\u5e08",role:"TEACHER",campus:"\u91d1\u661f\u5e7c\u513f\u56ed",assignedClasses:["\u82b1\u5f00\u5c0f\u4e8c"]});case 11:e.n=13;break;case 12:G("\u5bc6\u7801\u9519\u8bef");case 13:return z(!1),e.a(2);case 14:if("teacher2"!==w){e.n=18;break}if("teacher123"!==M){e.n=16;break}return e.n=15,be({id:"test_teacher2",phone:"teacher2",name:"\u674e\u8001\u5e08",role:"TEACHER",campus:"\u91d1\u661f\u5e7c\u513f\u56ed",assignedClasses:[]});case 15:e.n=17;break;case 16:G("\u5bc6\u7801\u9519\u8bef");case 17:return z(!1),e.a(2);case 18:if("cook"!==w&&"chef"!==w){e.n=22;break}if("cook123"!==M){e.n=20;break}return e.n=19,be({id:"test_cook",phone:"cook",name:"\u738b\u53a8\u5e08",role:"KITCHEN",campus:"\u91d1\u661f\u5e7c\u513f\u56ed"});case 19:e.n=21;break;case 20:G("\u5bc6\u7801\u9519\u8bef");case 21:return z(!1),e.a(2);case 22:if(s=m().getStorageSync("kt_all_users")||[],n=s.find(function(e){return e.phone===w}),n){e.n=23;break}return G("\u7528\u6237\u4e0d\u5b58\u5728\uff0c\u8bf7\u5148\u6ce8\u518c"),z(!1),e.a(2);case 23:if(a=je(M),n.passwordHash===a){e.n=24;break}return G("\u5bc6\u7801\u9519\u8bef"),z(!1),e.a(2);case 24:return e.n=25,be(n);case 25:z(!1);case 26:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),we=function(){var e=(0,o.Z)((0,i.Z)().m(function e(){var s,n,c,o,l,u,d,h,p,v;return(0,i.Z)().w(function(e){while(1)switch(e.p=e.n){case 0:if(w.trim()&&11===w.length){e.n=1;break}return G("\u8bf7\u8f93\u5165\u6709\u6548\u624b\u673a\u53f7"),e.a(2);case 1:if(se.trim()){e.n=2;break}return G("\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801"),e.a(2);case 2:return z(!0),e.p=3,e.n=4,b(w,se);case 4:if(s=e.v,s&&s.success){e.n=5;break}return G((null===s||void 0===s?void 0:s.message)||"\u9a8c\u8bc1\u5931\u8d25"),z(!1),e.a(2);case 5:if(n=m().getStorageSync("kt_staff")||[],c=n.find(function(e){return e.phone===w}),o=m().getStorageSync("kt_all_users")||[],l=o.find(function(e){return e.phone===w}),l){e.n=7;break}if(u=m().getStorageSync("kt_user_passwords")||{},u[w]){e.n=6;break}return G("\u8bf7\u5148\u6ce8\u518c\u5e76\u8bbe\u7f6e\u5bc6\u7801"),a("register"),z(!1),e.a(2);case 6:d=m().getStorageSync("kt_authorized_phones")||[],h=d.find(function(e){return"object"===(0,t.Z)(e)?e.phone===w:e===w}),p=(null===c||void 0===c?void 0:c.assignedClasses)||[],"object"===(0,t.Z)(h)&&null!==h&&void 0!==h&&h.assignedClass&&!p.includes(h.assignedClass)&&(p=[].concat((0,r.Z)(p),[h.assignedClass])),l={id:"user_".concat(w),phone:w,name:(null===c||void 0===c?void 0:c.name)||("object"===(0,t.Z)(h)?null===h||void 0===h?void 0:h.name:"")||"\u7528\u6237".concat(w.slice(-4)),role:(null===c||void 0===c?void 0:c.role)||("object"===(0,t.Z)(h)?null===h||void 0===h?void 0:h.role:"")||"TEACHER",campus:(null===c||void 0===c?void 0:c.campus)||("object"===(0,t.Z)(h)?null===h||void 0===h?void 0:h.campus:"")||"\u5341\u4e03\u5e7c",assignedClasses:p},o.push(l),m().setStorageSync("kt_all_users",o);case 7:return e.n=8,be(l);case 8:e.n=10;break;case 9:e.p=9,v=e.v,console.error("[SMS] \u9a8c\u8bc1\u5f02\u5e38:",v),G("\u9a8c\u8bc1\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5");case 10:z(!1);case 11:return e.a(2)}},e,null,[[3,9]])}));return function(){return e.apply(this,arguments)}}(),Ze=function(){var e=(0,o.Z)((0,i.Z)().m(function e(){return(0,i.Z)().w(function(e){while(1)switch(e.n){case 0:if("password"!==g){e.n=2;break}return e.n=1,Se();case 1:e.n=3;break;case 2:return e.n=3,we();case 3:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),ye=function(){var e=(0,o.Z)((0,i.Z)().m(function e(){var s,n,o,l,u,d,h,p,f,g,x,j,k,N,S;return(0,i.Z)().w(function(e){while(1)switch(e.p=e.n){case 0:if(w.trim()&&11===w.length){e.n=1;break}return G("\u8bf7\u8f93\u5165\u6709\u6548\u624b\u673a\u53f7"),e.a(2);case 1:if(se.trim()){e.n=2;break}return G("\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801"),e.a(2);case 2:if(M.trim()&&!(M.length<6)){e.n=3;break}return G("\u8bf7\u8bbe\u7f6e\u81f3\u5c116\u4f4d\u5bc6\u7801"),e.a(2);case 3:if(M===R){e.n=4;break}return G("\u4e24\u6b21\u5bc6\u7801\u8f93\u5165\u4e0d\u4e00\u81f4"),e.a(2);case 4:return z(!0),e.p=5,e.n=6,b(w,se);case 6:if(s=e.v,s&&s.success){e.n=7;break}return G((null===s||void 0===s?void 0:s.message)||"\u9a8c\u8bc1\u7801\u9519\u8bef"),z(!1),e.a(2);case 7:if(n=m().getStorageSync("kt_all_users")||[],o=n.find(function(e){return e.phone===w}),l=m().getStorageSync("kt_user_passwords")||{},u=!!l[w],!o||!u){e.n=8;break}return G("\u8be5\u624b\u673a\u53f7\u5df2\u6ce8\u518c\uff0c\u8bf7\u76f4\u63a5\u767b\u5f55"),a("login"),z(!1),e.a(2);case 8:if(d=m().getStorageSync("kt_staff")||[],h=d.find(function(e){return e.phone===w}),p=m().getStorageSync("kt_authorized_phones")||[],f=p.find(function(e){return"object"===(0,t.Z)(e)?e.phone===w:e===w}),h){e.n=9;break}if(g=p.map(function(e){return"string"===typeof e?e:e.phone}),!(g.length>0)||g.includes(w)){e.n=9;break}return G("\u672a\u5728\u6559\u804c\u5de5\u540d\u5355\u4e2d\uff0c\u8bf7\u8054\u7cfb\u56ed\u957f\u6dfb\u52a0"),z(!1),e.a(2);case 9:return x=(null===h||void 0===h?void 0:h.assignedClasses)||[],"object"===(0,t.Z)(f)&&null!==f&&void 0!==f&&f.assignedClass&&!x.includes(f.assignedClass)&&(x=[].concat((0,r.Z)(x),[f.assignedClass])),o?(j=(0,c.Z)((0,c.Z)({},o),{},{name:(null===h||void 0===h?void 0:h.name)||("object"===(0,t.Z)(f)?null===f||void 0===f?void 0:f.name:"")||o.name,role:(null===h||void 0===h?void 0:h.role)||("object"===(0,t.Z)(f)?null===f||void 0===f?void 0:f.role:"")||o.role,campus:(null===h||void 0===h?void 0:h.campus)||("object"===(0,t.Z)(f)?null===f||void 0===f?void 0:f.campus:"")||o.campus||"\u5341\u4e03\u5e7c",assignedClasses:x.length>0?x:o.assignedClasses||[]}),k=n.findIndex(function(e){return e.phone===w}),-1!==k&&(n[k]=j),m().setStorageSync("kt_all_users",n)):(j={id:"user_".concat(w),phone:w,name:(null===h||void 0===h?void 0:h.name)||("object"===(0,t.Z)(f)?null===f||void 0===f?void 0:f.name:"")||"\u7528\u6237".concat(w.slice(-4)),role:(null===h||void 0===h?void 0:h.role)||("object"===(0,t.Z)(f)?null===f||void 0===f?void 0:f.role:"")||"TEACHER",campus:(null===h||void 0===h?void 0:h.campus)||("object"===(0,t.Z)(f)?null===f||void 0===f?void 0:f.campus:"")||"\u5341\u4e03\u5e7c",assignedClasses:x,createdAt:(new Date).toISOString()},n.push(j),m().setStorageSync("kt_all_users",n)),N=btoa(encodeURIComponent(M+"_venus_salt_"+w)),l[w]=N,m().setStorageSync("kt_user_passwords",l),v.LC&&(0,v.sr)().then(function(e){e.success&&console.log("[Login] \u7528\u6237\u6570\u636e\u5df2\u540c\u6b65\u5230\u4e91\u7aef")}),G("\u6ce8\u518c\u6210\u529f","success"),e.n=10,be(j);case 10:e.n=12;break;case 11:e.p=11,S=e.v,console.error("[Register] \u6ce8\u518c\u5f02\u5e38:",S),G("\u6ce8\u518c\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5");case 12:z(!1);case 13:return e.a(2)}},e,null,[[5,11]])}));return function(){return e.apply(this,arguments)}}(),Ce=function(){var e=(0,o.Z)((0,i.Z)().m(function e(s){var n,a,r,t,c,o,l,u,d,h,p,f;return(0,i.Z)().w(function(e){while(1)switch(e.p=e.n){case 0:if(n=s.detail,a=n.code,r=n.errMsg,a){e.n=2;break}if(!(null!==r&&void 0!==r&&r.includes("deny")||null!==r&&void 0!==r&&r.includes("cancel"))){e.n=1;break}return e.a(2);case 1:return G("\u6388\u6743\u5931\u8d25\uff0c\u8bf7\u4f7f\u7528\u9a8c\u8bc1\u7801\u767b\u5f55"),e.a(2);case 2:if(me){e.n=3;break}return G("\u8bf7\u5148\u540c\u610f\u7528\u6237\u534f\u8bae\u548c\u9690\u79c1\u653f\u7b56"),e.a(2);case 3:return z(!0),m().showLoading({title:"\u767b\u5f55\u4e2d..."}),e.p=4,e.n=5,Z(a);case 5:if(t=e.v,t.success&&t.phone){e.n=6;break}return m().hideLoading(),G(t.error||"\u83b7\u53d6\u624b\u673a\u53f7\u5931\u8d25"),z(!1),e.a(2);case 6:if(c=t.phone,o=m().getStorageSync("kt_staff")||[],l=o.find(function(e){return e.phone===c}),u=m().getStorageSync("kt_all_users")||[],d=u.find(function(e){return e.phone===c}),d){e.n=8;break}if(h=m().getStorageSync("kt_authorized_phones")||[],p=h.map(function(e){return"string"===typeof e?e:e.phone}),l||!(p.length>0)||p.includes(c)){e.n=7;break}return m().hideLoading(),G("\u624b\u673a\u53f7\u672a\u6388\u6743\uff0c\u8bf7\u8054\u7cfb\u56ed\u957f"),z(!1),e.a(2);case 7:d={id:"user_".concat(c),phone:c,name:(null===l||void 0===l?void 0:l.name)||"\u7528\u6237".concat(c.slice(-4)),role:(null===l||void 0===l?void 0:l.role)||"TEACHER",campus:"\u5341\u4e03\u5e7c",assignedClasses:(null===l||void 0===l?void 0:l.assignedClasses)||[],createdAt:(new Date).toISOString()},u.push(d),m().setStorageSync("kt_all_users",u),v.LC&&(0,v.sr)().catch(function(){});case 8:return m().hideLoading(),e.n=9,be(d);case 9:e.n=11;break;case 10:e.p=10,f=e.v,m().hideLoading(),console.error("[WxPhone] \u5f02\u5e38:",f),G("\u767b\u5f55\u5931\u8d25\uff0c\u8bf7\u4f7f\u7528\u9a8c\u8bc1\u7801\u767b\u5f55");case 11:z(!1);case 12:return e.a(2)}},e,null,[[4,10]])}));return function(s){return e.apply(this,arguments)}}();return(0,_.jsxs)(d.G7,{className:"login-page",children:[(0,_.jsx)(d.G7,{className:"access-notice",children:(0,_.jsx)(d.xv,{className:"notice-text",children:"\u672c\u7cfb\u7edf\u4ec5\u9650\u5947\u5fb7\u91d1\u661f\u5e7c\u513f\u56ed\u6388\u6743\u4eba\u5458\u4f7f\u7528"})}),(0,_.jsxs)(d.G7,{className:"form-card",children:[(0,_.jsxs)(d.G7,{className:"header-bg",children:[(0,_.jsx)(d.G7,{className:"logo",children:(0,_.jsx)(d.Ee,{className:"logo-image",src:C,mode:"aspectFit"})}),(0,_.jsx)(d.xv,{className:"subtitle",children:"\u81ea\u7136 \xb7 \u517b\u80b2 \xb7 \u6210\u957f"})]}),(0,_.jsxs)(d.G7,{className:"mode-tabs",children:[(0,_.jsx)(d.G7,{className:"tab ".concat("login"===n?"active":""),onClick:function(){return a("login")},children:(0,_.jsx)(d.xv,{children:"\u767b\u5f55"})}),(0,_.jsx)(d.G7,{className:"tab ".concat("register"===n?"active":""),onClick:function(){return a("register")},children:(0,_.jsx)(d.xv,{children:"\u6ce8\u518c"})})]}),"login"===n&&(0,_.jsxs)(d.G7,{className:"login-type-tabs",children:[(0,_.jsx)(d.G7,{className:"type-tab ".concat("password"===g?"active":""),onClick:function(){return x("password")},children:(0,_.jsx)(d.xv,{children:"\u5bc6\u7801\u767b\u5f55"})}),(0,_.jsx)(d.G7,{className:"type-tab ".concat("sms"===g?"active":""),onClick:function(){return x("sms")},children:(0,_.jsx)(d.xv,{children:"\u9a8c\u8bc1\u7801\u767b\u5f55"})})]}),(0,_.jsxs)(d.G7,{className:"form",children:[(0,_.jsxs)(d.G7,{className:"form-item",children:[(0,_.jsx)(d.xv,{className:"label",children:"\u624b\u673a\u53f7"}),(0,_.jsx)(d.II,{className:"input",type:"login"===n&&"password"===g?"text":"number",placeholder:"login"===n&&"password"===g?"\u8bf7\u8f93\u5165\u624b\u673a\u53f7":"\u8bf7\u8f93\u516511\u4f4d\u624b\u673a\u53f7",value:w,onInput:function(e){return T(e.detail.value)},maxlength:"login"===n&&"password"===g?20:11})]}),"login"===n&&"password"===g&&(0,_.jsxs)(d.G7,{className:"form-item",children:[(0,_.jsx)(d.xv,{className:"label",children:"\u5bc6\u7801"}),(0,_.jsxs)(d.G7,{className:"password-wrap",children:[(0,_.jsx)(d.II,{className:"input",password:!W,placeholder:"\u8bf7\u8f93\u5165\u5bc6\u7801",value:M,onInput:function(e){return L(e.detail.value)}}),(0,_.jsx)(d.xv,{className:"toggle-eye",onClick:function(){return $(!W)},children:W?"\ud83d\ude48":"\ud83d\udc41\ufe0f"})]})]}),("register"===n||"login"===n&&"sms"===g)&&(0,_.jsxs)(d.G7,{className:"form-item",children:[(0,_.jsx)(d.xv,{className:"label",children:"\u9a8c\u8bc1\u7801"}),(0,_.jsxs)(d.G7,{className:"sms-wrap",children:[(0,_.jsx)(d.II,{className:"input sms-input",type:"number",placeholder:"\u8bf7\u8f93\u51656\u4f4d\u9a8c\u8bc1\u7801",value:se,onInput:function(e){return ne(e.detail.value)},maxlength:6}),(0,_.jsx)(d.G7,{className:"send-btn ".concat(te>0?"disabled":""),onClick:Ne,children:(0,_.jsx)(d.xv,{children:te>0?"".concat(te,"s"):"\u83b7\u53d6\u9a8c\u8bc1\u7801"})})]}),le&&!S()&&(0,_.jsxs)(d.xv,{className:"dev-code-hint",children:["\u5f00\u53d1\u6a21\u5f0f\u9a8c\u8bc1\u7801: ",le]})]}),"register"===n&&(0,_.jsxs)(_.Fragment,{children:[(0,_.jsxs)(d.G7,{className:"form-item",children:[(0,_.jsx)(d.xv,{className:"label",children:"\u8bbe\u7f6e\u5bc6\u7801"}),(0,_.jsxs)(d.G7,{className:"password-wrap",children:[(0,_.jsx)(d.II,{className:"input",password:!W,placeholder:"\u8bf7\u8bbe\u7f6e6-20\u4f4d\u5bc6\u7801",value:M,onInput:function(e){return L(e.detail.value)},maxlength:20}),(0,_.jsx)(d.xv,{className:"toggle-eye",onClick:function(){return $(!W)},children:W?"\ud83d\ude48":"\ud83d\udc41\ufe0f"})]})]}),(0,_.jsxs)(d.G7,{className:"form-item",children:[(0,_.jsx)(d.xv,{className:"label",children:"\u786e\u8ba4\u5bc6\u7801"}),(0,_.jsx)(d.II,{className:"input",password:!0,placeholder:"\u8bf7\u518d\u6b21\u8f93\u5165\u5bc6\u7801",value:R,onInput:function(e){return U(e.detail.value)},maxlength:20})]})]}),(0,_.jsxs)(d.G7,{className:"agreement-row",onClick:function(){return pe(!me)},children:[(0,_.jsx)(d.G7,{className:"agree-check ".concat(me?"checked":""),children:me&&(0,_.jsx)(d.xv,{className:"check-mark",children:"\u2713"})}),(0,_.jsx)(d.xv,{className:"agree-text",children:"\u5df2\u9605\u8bfb\u5e76\u540c\u610f"}),(0,_.jsx)(d.xv,{className:"agree-link",onClick:function(e){e.stopPropagation(),xe("service")},children:"\u300a\u7528\u6237\u670d\u52a1\u534f\u8bae\u300b"}),(0,_.jsx)(d.xv,{className:"agree-text",children:"\u548c"}),(0,_.jsx)(d.xv,{className:"agree-link",onClick:function(e){e.stopPropagation(),xe("privacy")},children:"\u300a\u9690\u79c1\u653f\u7b56\u300b"})]}),(0,_.jsx)(d.G7,{className:"submit-btn ".concat(q?"loading":""," ").concat(me?"":"btn-disabled"),onClick:function(){me?"login"===n?Ze():ye():G("\u8bf7\u5148\u540c\u610f\u7528\u6237\u534f\u8bae\u548c\u9690\u79c1\u653f\u7b56")},children:(0,_.jsx)(d.xv,{children:q?"\u5904\u7406\u4e2d...":"login"===n?"\u767b\u5f55":"\u5feb\u6377\u6ce8\u518c"})}),(0,_.jsxs)(d.G7,{className:"wx-divider",children:[(0,_.jsx)(d.G7,{className:"line"}),(0,_.jsx)(d.xv,{className:"or-text",children:"\u6216"}),(0,_.jsx)(d.G7,{className:"line"})]}),(0,_.jsxs)(d.zx,{className:"wx-phone-btn",openType:"getPhoneNumber",onGetPhoneNumber:Ce,children:[(0,_.jsx)(d.xv,{className:"wx-icon",children:"\ud83d\udcf1"}),(0,_.jsx)(d.xv,{children:"\u5fae\u4fe1\u624b\u673a\u53f7\u5feb\u6377\u767b\u5f55"})]}),"register"===n&&(0,_.jsxs)(d.G7,{className:"tips",children:[(0,_.jsx)(d.xv,{className:"tip",children:"\u8f93\u5165\u6559\u804c\u5de5\u540d\u5355\u4e2d\u7684\u624b\u673a\u53f7\u5373\u53ef\u5feb\u6377\u6ce8\u518c"}),(0,_.jsx)(d.xv,{className:"tip",children:"\u59d3\u540d\u3001\u89d2\u8272\u3001\u73ed\u7ea7\u5c06\u81ea\u52a8\u4ece\u540d\u5355\u83b7\u53d6"})]})]})]}),(0,_.jsx)(d.G7,{className:"footer",children:(0,_.jsx)(d.xv,{children:"KIDDA EDUCATION CLOUD PLATFORM"})}),ge&&(0,_.jsx)(d.G7,{className:"agreement-overlay",onClick:function(){return xe(null)},children:(0,_.jsxs)(d.G7,{className:"agreement-modal",onClick:function(e){return e.stopPropagation()},children:[(0,_.jsxs)(d.G7,{className:"agreement-header",children:[(0,_.jsx)(d.xv,{className:"agreement-title",children:"service"===ge?"\u7528\u6237\u670d\u52a1\u534f\u8bae":"\u9690\u79c1\u653f\u7b56"}),(0,_.jsx)(d.xv,{className:"agreement-close",onClick:function(){return xe(null)},children:"\u2715"})]}),(0,_.jsx)(d.pf,{scrollY:!0,className:"agreement-body",children:"service"===ge?(0,_.jsxs)(d.G7,{className:"agreement-content",children:[(0,_.jsx)(d.xv,{className:"p",children:"\u66f4\u65b0\u65e5\u671f\uff1a2026\u5e742\u67081\u65e5"}),(0,_.jsx)(d.xv,{className:"p",children:'\u6b22\u8fce\u4f7f\u7528\u5947\u5fb7\u91d1\u661f\u5e7c\u513f\u56ed\u667a\u6167\u6821\u56ed\u7ba1\u7406\u7cfb\u7edf\uff08\u4ee5\u4e0b\u7b80\u79f0"\u672c\u7cfb\u7edf"\uff09\u3002\u672c\u7cfb\u7edf\u7531\u6fee\u9633\u5e02\u5947\u5fb7\u56fd\u9645\u6559\u80b2\u6709\u9650\u516c\u53f8\u8fd0\u8425\uff0c\u4ec5\u4f9b\u5947\u5fb7\u91d1\u661f\u5e7c\u513f\u56ed\u6559\u804c\u5de5\u53ca\u5b66\u751f\u5bb6\u957f\u4f7f\u7528\u3002'}),(0,_.jsx)(d.xv,{className:"h",children:"\u4e00\u3001\u670d\u52a1\u8bf4\u660e"}),(0,_.jsx)(d.xv,{className:"p",children:"\u672c\u7cfb\u7edf\u63d0\u4f9b\u5b66\u751f\u8003\u52e4\u7ba1\u7406\u3001\u5065\u5eb7\u8bb0\u5f55\u3001\u6210\u957f\u6863\u6848\u3001\u98df\u8c31\u7ba1\u7406\u7b49\u5e7c\u513f\u56ed\u65e5\u5e38\u7ba1\u7406\u529f\u80fd\u3002\u4f7f\u7528\u672c\u7cfb\u7edf\u9700\u51ed\u6388\u6743\u624b\u673a\u53f7\u6ce8\u518c\u767b\u5f55\u3002"}),(0,_.jsx)(d.xv,{className:"h",children:"\u4e8c\u3001\u7528\u6237\u6ce8\u518c"}),(0,_.jsx)(d.xv,{className:"p",children:"\u7528\u6237\u9700\u63d0\u4f9b\u771f\u5b9e\u624b\u673a\u53f7\u7801\u8fdb\u884c\u6ce8\u518c\u9a8c\u8bc1\u3002\u624b\u673a\u53f7\u7801\u4ec5\u7528\u4e8e\u8eab\u4efd\u9a8c\u8bc1\u548c\u7cfb\u7edf\u767b\u5f55\uff0c\u4e0d\u4f1a\u7528\u4e8e\u5176\u4ed6\u5546\u4e1a\u7528\u9014\u3002"}),(0,_.jsx)(d.xv,{className:"h",children:"\u4e09\u3001\u7528\u6237\u4e49\u52a1"}),(0,_.jsx)(d.xv,{className:"p",children:"\u7528\u6237\u5e94\u59a5\u5584\u4fdd\u7ba1\u8d26\u53f7\u4fe1\u606f\uff0c\u4e0d\u5f97\u5c06\u8d26\u53f7\u63d0\u4f9b\u7ed9\u65e0\u5173\u4eba\u5458\u4f7f\u7528\u3002\u7528\u6237\u5f55\u5165\u7684\u5b66\u751f\u4fe1\u606f\u5e94\u771f\u5b9e\u51c6\u786e\u3002"}),(0,_.jsx)(d.xv,{className:"h",children:"\u56db\u3001\u6570\u636e\u5b89\u5168"}),(0,_.jsx)(d.xv,{className:"p",children:"\u672c\u7cfb\u7edf\u91c7\u7528\u963f\u91cc\u4e91\u670d\u52a1\u5668\u5b58\u50a8\u6570\u636e\uff0c\u5b9e\u884c\u4e25\u683c\u7684\u6570\u636e\u8bbf\u95ee\u6743\u9650\u63a7\u5236\uff0c\u786e\u4fdd\u6570\u636e\u5b89\u5168\u3002"}),(0,_.jsx)(d.xv,{className:"h",children:"\u4e94\u3001\u514d\u8d23\u58f0\u660e"}),(0,_.jsx)(d.xv,{className:"p",children:"\u56e0\u4e0d\u53ef\u6297\u529b\u3001\u7cfb\u7edf\u7ef4\u62a4\u7b49\u539f\u56e0\u5bfc\u81f4\u670d\u52a1\u4e2d\u65ad\uff0c\u672c\u7cfb\u7edf\u4e0d\u627f\u62c5\u76f8\u5173\u8d23\u4efb\u3002"}),(0,_.jsx)(d.xv,{className:"h",children:"\u516d\u3001\u8054\u7cfb\u65b9\u5f0f"}),(0,_.jsx)(d.xv,{className:"p",children:"\u5982\u6709\u95ee\u9898\u8bf7\u8054\u7cfb\u56ed\u533a\u7ba1\u7406\u5458\u3002"})]}):(0,_.jsxs)(d.G7,{className:"agreement-content",children:[(0,_.jsx)(d.xv,{className:"p",children:"\u66f4\u65b0\u65e5\u671f\uff1a2026\u5e742\u67081\u65e5"}),(0,_.jsx)(d.xv,{className:"p",children:'\u6fee\u9633\u5e02\u5947\u5fb7\u56fd\u9645\u6559\u80b2\u6709\u9650\u516c\u53f8\uff08\u4ee5\u4e0b\u7b80\u79f0"\u6211\u4eec"\uff09\u975e\u5e38\u91cd\u89c6\u7528\u6237\u9690\u79c1\u4fdd\u62a4\u3002\u672c\u9690\u79c1\u653f\u7b56\u8bf4\u660e\u6211\u4eec\u5982\u4f55\u6536\u96c6\u3001\u4f7f\u7528\u548c\u4fdd\u62a4\u60a8\u7684\u4e2a\u4eba\u4fe1\u606f\u3002'}),(0,_.jsx)(d.xv,{className:"h",children:"\u4e00\u3001\u4fe1\u606f\u6536\u96c6"}),(0,_.jsx)(d.xv,{className:"p",children:"\u6211\u4eec\u6536\u96c6\u7684\u4fe1\u606f\u5305\u62ec\uff1a\u624b\u673a\u53f7\u7801\uff08\u7528\u4e8e\u6ce8\u518c\u767b\u5f55\u548c\u8eab\u4efd\u9a8c\u8bc1\uff09\u3001\u59d3\u540d\u548c\u804c\u52a1\u4fe1\u606f\uff08\u7528\u4e8e\u7cfb\u7edf\u89d2\u8272\u5206\u914d\uff09\u3002"}),(0,_.jsx)(d.xv,{className:"h",children:"\u4e8c\u3001\u4fe1\u606f\u4f7f\u7528"}),(0,_.jsx)(d.xv,{className:"p",children:"\u60a8\u7684\u624b\u673a\u53f7\u4ec5\u7528\u4e8e\uff1a\u8d26\u53f7\u6ce8\u518c\u4e0e\u767b\u5f55\u9a8c\u8bc1\u3001\u53d1\u9001\u9a8c\u8bc1\u7801\u77ed\u4fe1\u3002\u6211\u4eec\u4e0d\u4f1a\u5c06\u60a8\u7684\u624b\u673a\u53f7\u7528\u4e8e\u8425\u9500\u63a8\u5e7f\u6216\u63d0\u4f9b\u7ed9\u7b2c\u4e09\u65b9\u3002"}),(0,_.jsx)(d.xv,{className:"h",children:"\u4e09\u3001\u4fe1\u606f\u5b58\u50a8"}),(0,_.jsx)(d.xv,{className:"p",children:"\u60a8\u7684\u4e2a\u4eba\u4fe1\u606f\u5b58\u50a8\u4e8e\u963f\u91cc\u4e91\u670d\u52a1\u5668\uff0c\u91c7\u7528\u52a0\u5bc6\u4f20\u8f93\u548c\u8bbf\u95ee\u63a7\u5236\u63aa\u65bd\u4fdd\u969c\u6570\u636e\u5b89\u5168\u3002\u6570\u636e\u4fdd\u5b58\u671f\u9650\u4e3a\u7528\u6237\u4f7f\u7528\u7cfb\u7edf\u671f\u95f4\u3002"}),(0,_.jsx)(d.xv,{className:"h",children:"\u56db\u3001\u4fe1\u606f\u5171\u4eab"}),(0,_.jsx)(d.xv,{className:"p",children:"\u6211\u4eec\u4e0d\u4f1a\u5c06\u60a8\u7684\u4e2a\u4eba\u4fe1\u606f\u51fa\u552e\u3001\u51fa\u79df\u6216\u5171\u4eab\u7ed9\u4efb\u4f55\u7b2c\u4e09\u65b9\uff0c\u6cd5\u5f8b\u6cd5\u89c4\u8981\u6c42\u9664\u5916\u3002"}),(0,_.jsx)(d.xv,{className:"h",children:"\u4e94\u3001\u7528\u6237\u6743\u5229"}),(0,_.jsx)(d.xv,{className:"p",children:"\u60a8\u6709\u6743\u67e5\u770b\u3001\u4fee\u6539\u3001\u5220\u9664\u60a8\u7684\u4e2a\u4eba\u4fe1\u606f\u3002\u5982\u9700\u5220\u9664\u8d26\u53f7\uff0c\u8bf7\u8054\u7cfb\u56ed\u533a\u7ba1\u7406\u5458\u3002"}),(0,_.jsx)(d.xv,{className:"h",children:"\u516d\u3001\u672a\u6210\u5e74\u4eba\u4fdd\u62a4"}),(0,_.jsx)(d.xv,{className:"p",children:"\u672c\u7cfb\u7edf\u8bb0\u5f55\u7684\u5b66\u751f\u4fe1\u606f\u4ec5\u4f9b\u6559\u5b66\u7ba1\u7406\u4f7f\u7528\uff0c\u4e25\u683c\u9650\u5236\u8bbf\u95ee\u6743\u9650\uff0c\u786e\u4fdd\u672a\u6210\u5e74\u4eba\u4fe1\u606f\u5b89\u5168\u3002"}),(0,_.jsx)(d.xv,{className:"h",children:"\u4e03\u3001\u8054\u7cfb\u6211\u4eec"}),(0,_.jsx)(d.xv,{className:"p",children:"\u5982\u5bf9\u9690\u79c1\u653f\u7b56\u6709\u7591\u95ee\uff0c\u8bf7\u8054\u7cfb\u56ed\u533a\u7ba1\u7406\u5458\u3002"})]})}),(0,_.jsx)(d.G7,{className:"agreement-footer",onClick:function(){pe(!0),xe(null)},children:(0,_.jsx)(d.xv,{children:"\u6211\u5df2\u9605\u8bfb\u5e76\u540c\u610f"})})]})})]})}var A={navigationBarTitleText:"\u767b\u5f55",enableShareAppMessage:!0,enableShareTimeline:!0};T.enableShareTimeline=!0,T.enableShareAppMessage=!0;Page((0,a.createPageConfig)(T,"pages/login/index",{root:{cn:[]}},A||{}))}},function(e){var s=function(s){return e(e.s=s)};e.O(0,[107,216,592],function(){return s(8716)});e.O()}]);