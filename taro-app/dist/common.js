(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[592],{4818:function(n,t,e){"use strict";e.d(t,{Z:function(){return i},p:function(){return l}});var r=e(9439),a=e(1515),c=e(2954),s=e.n(c),u=e(7294),o=e(5893);function i(n){var t=n.title,e=void 0===t?"":t,c=n.backgroundColor,i=void 0===c?"#1e293b":c,l=n.textColor,d=void 0===l?"#ffffff":l,f=n.showBack,p=void 0===f||f,h=n.onBack,S=(0,u.useState)(20),g=(0,r.Z)(S,2),y=g[0],v=g[1],_=(0,u.useState)(44),k=(0,r.Z)(_,2),w=k[0],m=k[1];(0,u.useEffect)(function(){var n=s().getSystemInfoSync();v(n.statusBarHeight||20);try{var t=s().getMenuButtonBoundingClientRect(),e=2*(t.top-n.statusBarHeight)+t.height;m(e)}catch(n){m(44)}},[]);var Z=function(){if(h)h();else{var n=s().getCurrentPages();n.length>1?s().navigateBack():s().switchTab({url:"/pages/index/index"})}},A=y+w;return(0,o.jsx)(a.G7,{className:"nav-bar",style:{backgroundColor:i,paddingTop:"".concat(y,"px"),height:"".concat(A,"px")},children:(0,o.jsxs)(a.G7,{className:"nav-bar-content",style:{height:"".concat(w,"px")},children:[p&&(0,o.jsxs)(a.G7,{className:"nav-back",onClick:Z,children:[(0,o.jsx)(a.xv,{className:"back-icon",style:{color:d},children:"\u2039"}),(0,o.jsx)(a.xv,{className:"back-text",style:{color:d},children:"\u8fd4\u56de"})]}),(0,o.jsx)(a.G7,{className:"nav-title",children:(0,o.jsx)(a.xv,{style:{color:d},children:e})}),(0,o.jsx)(a.G7,{className:"nav-right"})]})})}function l(){var n=(0,u.useState)(64),t=(0,r.Z)(n,2),e=t[0],c=t[1];return(0,u.useEffect)(function(){var n=s().getSystemInfoSync(),t=n.statusBarHeight||20;try{var e=s().getMenuButtonBoundingClientRect(),r=2*(e.top-n.statusBarHeight)+e.height;c(t+r+12)}catch(n){c(t+44+12)}},[]),(0,o.jsx)(a.G7,{style:{height:"".concat(e,"px")}})}},4751:function(n,t,e){"use strict";e.d(t,{Z:function(){return a}});var r=e(2954);function a(n){var t="\u91d1\u661f\u5e7c\u513f\u56ed - \u667a\u6167\u6821\u56ed\u7ba1\u7406",e="/pages/index/index";(0,r.useShareAppMessage)(function(){return{title:(null===n||void 0===n?void 0:n.title)||t,path:(null===n||void 0===n?void 0:n.path)||e,imageUrl:(null===n||void 0===n?void 0:n.imageUrl)||""}}),(0,r.useShareTimeline)(function(){return{title:(null===n||void 0===n?void 0:n.title)||t}})}},1977:function(n,t,e){"use strict";e.d(t,{Hv:function(){return D},I:function(){return d},K:function(){return L},LC:function(){return f},Qu:function(){return N},YJ:function(){return v},au:function(){return T},h8:function(){return m},jn:function(){return g},l4:function(){return A},qZ:function(){return k},sr:function(){return H},xF:function(){return b}});var r=e(2688),a=e(5861),c=e(2954),s=e.n(c),u=e(1354),o=e.n(u),i={region:"oss-cn-beijing",bucket:"venus-data",accessKeyId:"LTAI5t8bGTe6ZJAuKSQXi3Di",accessKeySecret:"eu2urgQIcJ6eK0s87UkZLEbgk1qacj",endpoint:"https://venus-data.oss-cn-beijing.aliyuncs.com"},l="jinxing-edu",d={ALL_USERS:"kt_all_users",AUTHORIZED_PHONES:"kt_authorized_phones",STUDENTS:"kt_students",STAFF:"kt_staff",HEALTH_RECORDS:"kt_health_records",ATTENDANCE_RECORDS:"kt_attendance_records",MEAL_PLANS:"kt_meal_plans",ANNOUNCEMENTS:"kt_announcements",PICKUP_RECORDS:"kt_pickup_records",DISEASE_RECORDS:"kt_disease_records",DISINFECTION_RECORDS:"kt_disinfection_records",EVALUATIONS:"kt_student_evaluations"},f=""!==i.bucket&&""!==i.endpoint&&""!==i.accessKeyId&&""!==i.accessKeySecret;function p(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",e=Math.floor(Date.now()/1e3)+3600,r="GET\n\n".concat(t,"\n").concat(e,"\n/").concat(i.bucket,"/").concat(n),a=o().HmacSHA1(r,i.accessKeySecret),c=encodeURIComponent(o().enc.Base64.stringify(a));return"".concat(i.endpoint,"/").concat(n,"?OSSAccessKeyId=").concat(i.accessKeyId,"&Expires=").concat(e,"&Signature=").concat(c)}function h(n){return S.apply(this,arguments)}function S(){return S=(0,a.Z)((0,r.Z)().m(function n(t){var e,a,c,u,o,l,d,f,h,S,g;return(0,r.Z)().w(function(n){while(1)switch(n.p=n.n){case 0:return e="".concat(i.endpoint,"/").concat(t),n.p=1,console.log("[AliyunOSS] \u5c1d\u8bd5\u516c\u5f00URL: ".concat(e)),n.n=2,s().request({url:e,method:"GET",timeout:1e4,responseType:"text"});case 2:if(a=n.v,200!==a.statusCode){n.n=3;break}return console.log("[AliyunOSS] \u2705 \u516c\u5f00URL\u6210\u529f"),c="string"===typeof a.data?JSON.parse(a.data):a.data,n.a(2,{statusCode:a.statusCode,data:c});case 3:n.n=5;break;case 4:n.p=4,h=n.v,console.log("[AliyunOSS] \u516c\u5f00URL\u5931\u8d25: ".concat(h.message,"\uff0c\u5c1d\u8bd5\u7b7e\u540dURL"));case 5:return u=p(t,"application/json"),n.p=6,console.log("[AliyunOSS] \u5c1d\u8bd5\u7b7e\u540dURL (\u5e26Content-Type)"),n.n=7,s().request({url:u,method:"GET",timeout:15e3,header:{"Content-Type":"application/json"}});case 7:return o=n.v,n.a(2,o);case 8:return n.p=8,S=n.v,console.log("[AliyunOSS] \u7b7e\u540dURL\u5931\u8d25: ".concat(S.message,"\uff0c\u5c1d\u8bd5\u4e0d\u5e26Content-Type")),l=p(t,""),n.p=9,console.log("[AliyunOSS] \u5c1d\u8bd5\u7b7e\u540dURL (\u65e0Content-Type)"),n.n=10,s().request({url:l,method:"GET",timeout:15e3,responseType:"text"});case 10:if(d=n.v,200!==d.statusCode){n.n=11;break}return f="string"===typeof d.data?JSON.parse(d.data):d.data,n.a(2,{statusCode:d.statusCode,data:f});case 11:return n.a(2,d);case 12:return n.p=12,g=n.v,console.log("[AliyunOSS] \u6240\u6709\u7b7e\u540d\u65b9\u5f0f\u90fd\u5931\u8d25: ".concat(g.message)),n.a(2,null)}},n,null,[[9,12],[6,8],[1,4]])})),S.apply(this,arguments)}function g(n){return y.apply(this,arguments)}function y(){return y=(0,a.Z)((0,r.Z)().m(function n(t){var e,a,c,s;return(0,r.Z)().w(function(n){while(1)switch(n.p=n.n){case 0:if(f){n.n=1;break}return n.a(2,{success:!1,error:"\u963f\u91cc\u4e91 OSS \u672a\u914d\u7f6e"});case 1:return n.p=1,e="".concat(l,"/").concat(t,".json"),console.log("[AliyunOSS] \u4e0b\u8f7d: ".concat(t,".json")),n.n=2,h(e);case 2:if(a=n.v,a){n.n=3;break}return console.error("[AliyunOSS] \u8bf7\u6c42\u5931\u8d25: ".concat(t)),n.a(2,{success:!1,error:"\u7f51\u7edc\u8bf7\u6c42\u5931\u8d25"});case 3:if(200!==a.statusCode){n.n=4;break}return c="string"===typeof a.data?JSON.parse(a.data):a.data,console.log("[AliyunOSS] \u4e0b\u8f7d\u6210\u529f: ".concat(t," (").concat(Array.isArray(c)?c.length:1,"\u6761)")),n.a(2,{success:!0,data:Array.isArray(c)?c:[c]});case 4:if(404!==a.statusCode){n.n=5;break}return console.log("[AliyunOSS] \u6587\u4ef6\u4e0d\u5b58\u5728: ".concat(t)),n.a(2,{success:!0,data:[]});case 5:if(403!==a.statusCode){n.n=6;break}return console.error("[AliyunOSS] \u6743\u9650\u9519\u8bef: ".concat(t)),n.a(2,{success:!1,error:"\u6743\u9650\u9519\u8bef(403)"});case 6:return console.error("[AliyunOSS] \u4e0b\u8f7d\u5931\u8d25: HTTP ".concat(a.statusCode)),n.a(2,{success:!1,error:"HTTP ".concat(a.statusCode)});case 7:n.n=9;break;case 8:return n.p=8,s=n.v,console.error("[AliyunOSS] \u8bf7\u6c42\u5f02\u5e38:",s.message||s),n.a(2,{success:!1,error:s.message||"\u4e0b\u8f7d\u5931\u8d25"});case 9:return n.a(2)}},n,null,[[1,8]])})),y.apply(this,arguments)}function v(){return _.apply(this,arguments)}function _(){return _=(0,a.Z)((0,r.Z)().m(function n(){var t,e;return(0,r.Z)().w(function(n){while(1)switch(n.n){case 0:return n.n=1,g("kt_students");case 1:return t=n.v,t.success&&t.data&&(t.data.length>0?(s().setStorageSync("kt_students",t.data),console.log("[AliyunOSS] \u2705 \u5b66\u751f\u6570\u636e\u5df2\u4fdd\u5b58: ".concat(t.data.length,"\u6761"))):(e=s().getStorageSync("kt_students")||[],e.length>0&&(console.warn("[AliyunOSS] \u26a0\ufe0f \u4e91\u7aef\u5b66\u751f\u6570\u636e\u4e3a\u7a7a\uff0c\u4fdd\u7559\u672c\u5730\u6570\u636e(".concat(e.length,"\u6761)")),t.data=e))),n.a(2,t)}},n)})),_.apply(this,arguments)}function k(){return w.apply(this,arguments)}function w(){return w=(0,a.Z)((0,r.Z)().m(function n(){var t,e;return(0,r.Z)().w(function(n){while(1)switch(n.n){case 0:return n.n=1,g("kt_staff");case 1:return t=n.v,t.success&&t.data&&(t.data.length>0?(s().setStorageSync("kt_staff",t.data),console.log("[AliyunOSS] \u2705 \u6559\u804c\u5de5\u6570\u636e\u5df2\u4fdd\u5b58: ".concat(t.data.length,"\u6761"))):(e=s().getStorageSync("kt_staff")||[],e.length>0&&(console.warn("[AliyunOSS] \u26a0\ufe0f \u4e91\u7aef\u6559\u804c\u5de5\u6570\u636e\u4e3a\u7a7a\uff0c\u4fdd\u7559\u672c\u5730\u6570\u636e(".concat(e.length,"\u6761)")),t.data=e))),n.a(2,t)}},n)})),w.apply(this,arguments)}function m(){return Z.apply(this,arguments)}function Z(){return Z=(0,a.Z)((0,r.Z)().m(function n(){var t;return(0,r.Z)().w(function(n){while(1)switch(n.n){case 0:return n.n=1,g("kt_health_records");case 1:return t=n.v,t.success&&t.data&&s().setStorageSync("kt_health_records",t.data),n.a(2,t)}},n)})),Z.apply(this,arguments)}function A(){return O.apply(this,arguments)}function O(){return O=(0,a.Z)((0,r.Z)().m(function n(){var t;return(0,r.Z)().w(function(n){while(1)switch(n.n){case 0:return n.n=1,g("kt_attendance_records");case 1:return t=n.v,t.success&&t.data&&s().setStorageSync("kt_attendance_records",t.data),n.a(2,t)}},n)})),O.apply(this,arguments)}function b(){return C.apply(this,arguments)}function C(){return C=(0,a.Z)((0,r.Z)().m(function n(){var t,e,a,c,u,o;return(0,r.Z)().w(function(n){while(1)switch(n.p=n.n){case 0:if(f){n.n=1;break}return n.a(2,{isHealthy:!1,error:"\u672a\u914d\u7f6e"});case 1:return t=Date.now(),n.p=2,e="".concat(l,"/kt_authorized_phones.json"),a="".concat(i.endpoint,"/").concat(e),console.log("[AliyunOSS] \u6d4b\u8bd5\u8fde\u63a5:",a),n.n=3,s().request({url:a,method:"GET",timeout:1e4,responseType:"text"});case 3:if(c=n.v,u=Date.now()-t,console.log("[AliyunOSS] \u8fde\u63a5\u6d4b\u8bd5\u7ed3\u679c: HTTP ".concat(c.statusCode,", \u5ef6\u8fdf ").concat(u,"ms")),200!==c.statusCode&&404!==c.statusCode&&403!==c.statusCode){n.n=4;break}return n.a(2,{isHealthy:!0,latency:u});case 4:return n.a(2,{isHealthy:!1,error:"HTTP ".concat(c.statusCode)});case 5:return n.p=5,o=n.v,console.error("[AliyunOSS] \u8fde\u63a5\u6d4b\u8bd5\u5931\u8d25:",o.message),n.a(2,{isHealthy:!1,error:o.message||"\u8fde\u63a5\u5931\u8d25"})}},n,null,[[2,5]])})),C.apply(this,arguments)}function T(){return{enabled:f,provider:"\u963f\u91cc\u4e91 OSS",region:i.region,bucket:i.bucket,lastSyncTime:s().getStorageSync("kt_last_sync_time")||null}}function I(n,t,e,r){var a="".concat(n,"\n\n").concat(t,"\n").concat(e,"\n/").concat(i.bucket,"/").concat(r),c=o().HmacSHA1(a,i.accessKeySecret);return o().enc.Base64.stringify(c)}var x=["kt_students","kt_staff","kt_authorized_phones","kt_all_users"],E={kt_students:10,kt_staff:20};function N(n,t){return U.apply(this,arguments)}function U(){return U=(0,a.Z)((0,r.Z)().m(function n(t,e){var a,c,u,o,d,p,h,S,g,y,v,_,k=arguments;return(0,r.Z)().w(function(n){while(1)switch(n.p=n.n){case 0:if(a=k.length>2&&void 0!==k[2]&&k[2],f){n.n=1;break}return n.a(2,{success:!1,error:"\u963f\u91cc\u4e91 OSS \u672a\u914d\u7f6e"});case 1:if(c=E[t]||0,a||!x.includes(t)){n.n=2;break}if(e&&!(e.length<c)){n.n=2;break}return u="\u26a0\ufe0f \u6570\u636e\u4fdd\u62a4: ".concat(t," \u6570\u636e\u4e3a\u7a7a\u6216\u4e0d\u8db3(").concat((null===e||void 0===e?void 0:e.length)||0,"\u6761)\uff0c\u62d2\u7edd\u4e0a\u4f20\u4ee5\u9632\u6b62\u8986\u76d6\u4e91\u7aef\u6570\u636e"),console.warn("[AliyunOSS] ".concat(u)),n.a(2,{success:!1,error:u});case 2:return n.p=2,o="".concat(l,"/").concat(t,".json"),d="".concat(i.endpoint,"/").concat(l,"/").concat(t,".json"),p=JSON.stringify(e,null,2),h="application/json",S=(new Date).toUTCString(),g=I("PUT",h,S,o),y="OSS ".concat(i.accessKeyId,":").concat(g),n.n=3,s().request({url:d,method:"PUT",header:{"Content-Type":h,Date:S,Authorization:y},data:p});case 3:if(v=n.v,!(v.statusCode>=200&&v.statusCode<300)){n.n=4;break}return console.log("[AliyunOSS] \u2705 \u4e0a\u4f20\u6210\u529f: ".concat(t," (").concat(e.length,"\u6761)")),n.a(2,{success:!0});case 4:return console.error("[AliyunOSS] \u274c \u4e0a\u4f20\u5931\u8d25: HTTP ".concat(v.statusCode),v.data),n.a(2,{success:!1,error:"HTTP ".concat(v.statusCode)});case 5:n.n=7;break;case 6:return n.p=6,_=n.v,console.error("[AliyunOSS] \u274c \u4e0a\u4f20\u5931\u8d25: ".concat(t),_),n.a(2,{success:!1,error:_.message||"\u4e0a\u4f20\u5931\u8d25"});case 7:return n.a(2)}},n,null,[[2,6]])})),U.apply(this,arguments)}function D(){return R.apply(this,arguments)}function R(){return R=(0,a.Z)((0,r.Z)().m(function n(){var t;return(0,r.Z)().w(function(n){while(1)switch(n.n){case 0:return t=s().getStorageSync("kt_authorized_phones")||[],n.n=1,N("kt_authorized_phones",t,!0);case 1:return n.a(2,n.v)}},n)})),R.apply(this,arguments)}function H(){return j.apply(this,arguments)}function j(){return j=(0,a.Z)((0,r.Z)().m(function n(){var t;return(0,r.Z)().w(function(n){while(1)switch(n.n){case 0:return t=s().getStorageSync("kt_all_users")||[],n.n=1,N("kt_all_users",t,!0);case 1:return n.a(2,n.v)}},n)})),j.apply(this,arguments)}function L(){return P.apply(this,arguments)}function P(){return P=(0,a.Z)((0,r.Z)().m(function n(){var t,e,a,c,u,o,i,l,p,h,S,y,v;return(0,r.Z)().w(function(n){while(1)switch(n.p=n.n){case 0:if(f){n.n=1;break}return n.a(2,{success:!1,students:0,staff:0,error:"\u963f\u91cc\u4e91 OSS \u672a\u914d\u7f6e"});case 1:return console.log("[AliyunOSS] \ud83d\ude80 \u4e0b\u8f7d\u6240\u6709\u6570\u636e..."),t=0,e=0,a=!1,c="",u=s().getStorageSync(d.STUDENTS)||[],o=s().getStorageSync(d.STAFF)||[],n.p=2,n.n=3,g("kt_students");case 3:return p=n.v,p.success&&p.data&&p.data.length>0?(s().setStorageSync(d.STUDENTS,p.data),t=p.data.length,console.log("[AliyunOSS] \u2705 \u5b66\u751f\u6570\u636e: ".concat(t," \u6761"))):p.success?0===(null===(i=p.data)||void 0===i?void 0:i.length)&&u.length>0&&(t=u.length,console.warn("[AliyunOSS] \u26a0\ufe0f \u4e91\u7aef\u5b66\u751f\u4e3a\u7a7a\uff0c\u4fdd\u7559\u672c\u5730\u6570\u636e(".concat(t,"\u6761)"))):(a=!0,c=p.error||"\u4e0b\u8f7d\u5b66\u751f\u6570\u636e\u5931\u8d25",t=u.length,console.warn("[AliyunOSS] \u26a0\ufe0f \u4e0b\u8f7d\u5b66\u751f\u5931\u8d25\uff0c\u4fdd\u7559\u672c\u5730\u6570\u636e(".concat(t,"\u6761)"))),n.n=4,g("kt_staff");case 4:return h=n.v,h.success&&h.data&&h.data.length>0?(s().setStorageSync(d.STAFF,h.data),e=h.data.length,console.log("[AliyunOSS] \u2705 \u6559\u804c\u5de5\u6570\u636e: ".concat(e," \u6761"))):h.success?0===(null===(l=h.data)||void 0===l?void 0:l.length)&&o.length>0&&(e=o.length,console.warn("[AliyunOSS] \u26a0\ufe0f \u4e91\u7aef\u6559\u804c\u5de5\u4e3a\u7a7a\uff0c\u4fdd\u7559\u672c\u5730\u6570\u636e(".concat(e,"\u6761)"))):(a=!0,c=h.error||"\u4e0b\u8f7d\u6559\u804c\u5de5\u6570\u636e\u5931\u8d25",e=o.length,console.warn("[AliyunOSS] \u26a0\ufe0f \u4e0b\u8f7d\u6559\u804c\u5de5\u5931\u8d25\uff0c\u4fdd\u7559\u672c\u5730\u6570\u636e(".concat(e,"\u6761)"))),n.n=5,g("kt_authorized_phones");case 5:return S=n.v,S.success&&S.data&&S.data.length>0&&(s().setStorageSync(d.AUTHORIZED_PHONES,S.data),console.log("[AliyunOSS] \u2705 \u6388\u6743\u624b\u673a: ".concat(S.data.length," \u6761"))),n.n=6,g("kt_all_users");case 6:return y=n.v,y.success&&y.data&&(s().setStorageSync(d.ALL_USERS,y.data),console.log("[AliyunOSS] \u2705 \u7528\u6237\u6570\u636e: ".concat(y.data.length," \u6761"))),s().setStorageSync("kt_last_sync_time",(new Date).toISOString()),n.a(2,{success:!a,students:t,staff:e,error:a?c:void 0});case 7:return n.p=7,v=n.v,n.a(2,{success:!1,students:0,staff:0,error:v.message})}},n,null,[[2,7]])})),P.apply(this,arguments)}},5686:function(n,t,e){"use strict";e.d(t,{F1:function(){return d},LL:function(){return p},Vu:function(){return O},X8:function(){return I},YZ:function(){return C},aI:function(){return S},jv:function(){return o.LC},li:function(){return y},n:function(){return w},rT:function(){return Z},sh:function(){return _},wL:function(){return i}});var r=e(2688),a=e(5861),c=e(1413),s=e(2954),u=e.n(s),o=e(1977);u().getStorageSync("kt_last_sync_time");function i(n){return l.apply(this,arguments)}function l(){return l=(0,a.Z)((0,r.Z)().m(function n(t){var e,a;return(0,r.Z)().w(function(n){while(1)switch(n.n){case 0:return n.n=1,(0,o.YJ)();case 1:if(e=n.v,!(e.success&&e.data&&t)){n.n=2;break}return a=e.data.filter(function(n){return n.campus===t}),n.a(2,{success:!0,data:a});case 2:return n.a(2,e)}},n)})),l.apply(this,arguments)}function d(n){return f.apply(this,arguments)}function f(){return f=(0,a.Z)((0,r.Z)().m(function n(t){var e,a;return(0,r.Z)().w(function(n){while(1)switch(n.n){case 0:return n.n=1,(0,o.qZ)();case 1:if(e=n.v,!(e.success&&e.data&&t)){n.n=2;break}return a=e.data.filter(function(n){return n.campus===t}),n.a(2,{success:!0,data:a});case 2:return n.a(2,e)}},n)})),f.apply(this,arguments)}function p(n){return h.apply(this,arguments)}function h(){return h=(0,a.Z)((0,r.Z)().m(function n(t){var e;return(0,r.Z)().w(function(n){while(1)switch(n.n){case 0:return e=u().getStorageSync("kt_payments")||[],n.a(2,{success:!0,data:e})}},n)})),h.apply(this,arguments)}function S(n,t){return g.apply(this,arguments)}function g(){return g=(0,a.Z)((0,r.Z)().m(function n(t,e){var a,c,s;return(0,r.Z)().w(function(n){while(1)switch(n.n){case 0:return n.n=1,(0,o.l4)();case 1:if(a=n.v,!a.success||!a.data){n.n=2;break}return c=a.data.filter(function(n){return n.date===t}),s={},c.forEach(function(n){e&&n.campus!==e||(s[n.studentId]=n)}),u().setStorageSync("kt_attendance_".concat(t),s),n.a(2,{success:!0,data:s});case 2:return n.a(2,{success:!1,error:a.error})}},n)})),g.apply(this,arguments)}function y(n,t){return v.apply(this,arguments)}function v(){return v=(0,a.Z)((0,r.Z)().m(function n(t,e){var a,c,s;return(0,r.Z)().w(function(n){while(1)switch(n.n){case 0:return n.n=1,(0,o.h8)();case 1:if(a=n.v,!a.success||!a.data){n.n=2;break}return c=a.data.filter(function(n){return n.date===t}),s={},c.forEach(function(n){e&&n.campus!==e||(s[n.studentId]=n)}),u().setStorageSync("kt_health_".concat(t),s),n.a(2,{success:!0,data:s});case 2:return n.a(2,{success:!1,error:a.error})}},n)})),v.apply(this,arguments)}function _(n){return k.apply(this,arguments)}function k(){return k=(0,a.Z)((0,r.Z)().m(function n(t){var e,a;return(0,r.Z)().w(function(n){while(1)switch(n.n){case 0:if(e=u().getStorageSync("kt_students")||[],a=e.findIndex(function(n){return n.id===t.id}),a>=0?e[a]=t:e.push(t),u().setStorageSync("kt_students",e),!(e.length>300)){n.n=1;break}return console.warn("[CloudSync] \u5b66\u751f\u6570\u636e\u91cf\u5f02\u5e38(".concat(e.length,")\uff0c\u53ea\u4fdd\u5b58\u672c\u5730")),n.a(2,{success:!0});case 1:return n.n=2,(0,o.Qu)("kt_students",e);case 2:return n.a(2,n.v)}},n)})),k.apply(this,arguments)}function w(n,t,e){return m.apply(this,arguments)}function m(){return m=(0,a.Z)((0,r.Z)().m(function n(t,e,a){var s,i,l,d;return(0,r.Z)().w(function(n){while(1)switch(n.n){case 0:return s="kt_attendance_".concat(t),i=u().getStorageSync(s)||{},i[e]=(0,c.Z)((0,c.Z)({},a),{},{date:t,studentId:e}),u().setStorageSync(s,i),l=u().getStorageSync("kt_attendance_records")||[],d=l.findIndex(function(n){return n.date===t&&n.studentId===e}),d>=0?l[d]=i[e]:l.push(i[e]),u().setStorageSync("kt_attendance_records",l),n.n=1,(0,o.Qu)("kt_attendance_records",l);case 1:return n.a(2,n.v)}},n)})),m.apply(this,arguments)}function Z(n,t,e){return A.apply(this,arguments)}function A(){return A=(0,a.Z)((0,r.Z)().m(function n(t,e,a){var s,i,l,d;return(0,r.Z)().w(function(n){while(1)switch(n.n){case 0:return s="kt_health_".concat(t),i=u().getStorageSync(s)||{},i[e]=(0,c.Z)((0,c.Z)({},a),{},{date:t,studentId:e}),u().setStorageSync(s,i),l=u().getStorageSync("kt_health_records")||[],d=l.findIndex(function(n){return n.date===t&&n.studentId===e}),d>=0?l[d]=i[e]:l.push(i[e]),u().setStorageSync("kt_health_records",l),n.n=1,(0,o.Qu)("kt_health_records",l);case 1:return n.a(2,n.v)}},n)})),A.apply(this,arguments)}function O(n){return b.apply(this,arguments)}function b(){return b=(0,a.Z)((0,r.Z)().m(function n(t){var e,a;return(0,r.Z)().w(function(n){while(1)switch(n.n){case 0:return e=u().getStorageSync("kt_student_evaluations")||[],a=e.findIndex(function(n){return n.id===t.id}),a>=0?e[a]=t:e.push(t),u().setStorageSync("kt_student_evaluations",e),n.n=1,(0,o.Qu)("kt_student_evaluations",e);case 1:return n.a(2,n.v)}},n)})),b.apply(this,arguments)}function C(n){return T.apply(this,arguments)}function T(){return T=(0,a.Z)((0,r.Z)().m(function n(t){var e,a;return(0,r.Z)().w(function(n){while(1)switch(n.n){case 0:return e=u().getStorageSync("kt_observations")||[],a=e.findIndex(function(n){return n.id===t.id}),a>=0?e[a]=t:e.unshift(t),u().setStorageSync("kt_observations",e),n.n=1,(0,o.Qu)("kt_observations",e);case 1:return n.a(2,n.v)}},n)})),T.apply(this,arguments)}function I(n){return x.apply(this,arguments)}function x(){return x=(0,a.Z)((0,r.Z)().m(function n(t){var e,a;return(0,r.Z)().w(function(n){while(1)switch(n.n){case 0:return e=u().getStorageSync("kt_observations")||[],a=e.filter(function(n){return n.id!==t}),u().setStorageSync("kt_observations",a),n.n=1,(0,o.Qu)("kt_observations",a,!0);case 1:return n.a(2,n.v)}},n)})),x.apply(this,arguments)}},857:function(n,t,e){"use strict";e.d(t,{GW:function(){return h},NZ:function(){return S},Sh:function(){return p},bI:function(){return f},wq:function(){return l}});var r=e(2688),a=e(1413),c=e(5861),s=e(2954),u=e.n(s),o=e(1977),i={attendance:"",menuUpdate:"",payment:""},l=function(){return Object.values(i).some(function(n){return n.length>0})},d=function(){var n=(0,c.Z)((0,r.Z)().m(function n(t){var e,c,s,o,l;return(0,r.Z)().w(function(n){while(1)switch(n.p=n.n){case 0:if(e=t.map(function(n){return i[n]}).filter(function(n){return n.length>0}),0!==e.length){n.n=1;break}return console.log("[\u901a\u77e5] \u672a\u914d\u7f6e\u6a21\u677fID\uff0c\u8df3\u8fc7\u8ba2\u9605"),n.a(2,{success:!1});case 1:return n.p=1,n.n=2,u().requestSubscribeMessage({tmplIds:e});case 2:return c=n.v,console.log("[\u901a\u77e5] \u8ba2\u9605\u7ed3\u679c:",c),s=u().getStorageSync("kt_subscriptions")||{},o=u().getStorageSync("kt_current_user"),o&&(s[o.phone]=(0,a.Z)((0,a.Z)((0,a.Z)({},s[o.phone]),c),{},{lastTime:(new Date).toISOString()}),u().setStorageSync("kt_subscriptions",s)),n.a(2,{success:!0,results:c});case 3:return n.p=3,l=n.v,console.log("[\u901a\u77e5] \u8ba2\u9605\u53d6\u6d88\u6216\u5931\u8d25:",l),n.a(2,{success:!1})}},n,null,[[1,3]])}));return function(t){return n.apply(this,arguments)}}(),f=function(){var n=(0,c.Z)((0,r.Z)().m(function n(){return(0,r.Z)().w(function(n){while(1)switch(n.n){case 0:return n.a(2,d(["attendance","menuUpdate","payment"]))}},n)}));return function(){return n.apply(this,arguments)}}(),p=function(){var n=(0,c.Z)((0,r.Z)().m(function n(t){var e;return(0,r.Z)().w(function(n){while(1)switch(n.n){case 0:if(i.attendance){n.n=1;break}return n.a(2);case 1:return e={id:"att_".concat(Date.now()),type:"attendance",templateId:i.attendance,toUserPhone:"",data:{thing1:{value:t.studentName},thing2:{value:t.className},thing3:{value:t.status},date4:{value:t.date},thing5:{value:t.remark||"\u8bf7\u53ca\u65f6\u5173\u6ce8"}},page:"/pages/students/attendance",createdAt:(new Date).toISOString(),sent:!1},n.n=2,y(e);case 2:console.log("[\u901a\u77e5] \u8003\u52e4\u5f02\u5e38\u5df2\u5165\u961f:",t.studentName,t.status);case 3:return n.a(2)}},n)}));return function(t){return n.apply(this,arguments)}}(),h=function(){var n=(0,c.Z)((0,r.Z)().m(function n(t){var e;return(0,r.Z)().w(function(n){while(1)switch(n.n){case 0:if(i.menuUpdate){n.n=1;break}return n.a(2);case 1:return e={id:"menu_".concat(Date.now()),type:"menuUpdate",templateId:i.menuUpdate,toUserPhone:"__all_staff__",data:{thing1:{value:"".concat(t.weekRange,"\u8425\u517b\u98df\u8c31\u5df2\u66f4\u65b0")},date2:{value:(new Date).toLocaleDateString("zh-CN")},thing3:{value:"\u7531".concat(t.updatedBy,"\u53d1\u5e03\uff0c\u8bf7\u67e5\u770b\u8be6\u60c5")}},page:"/pages/kitchen/index",createdAt:(new Date).toISOString(),sent:!1},n.n=2,y(e);case 2:console.log("[\u901a\u77e5] \u98df\u8c31\u66f4\u65b0\u5df2\u5165\u961f:",t.weekRange);case 3:return n.a(2)}},n)}));return function(t){return n.apply(this,arguments)}}(),S=function(){var n=(0,c.Z)((0,r.Z)().m(function n(t){var e;return(0,r.Z)().w(function(n){while(1)switch(n.n){case 0:if(i.payment){n.n=1;break}return n.a(2);case 1:return e={id:"pay_".concat(Date.now()),type:"payment",templateId:i.payment,toUserPhone:t.parentPhone||"",data:{thing1:{value:t.studentName},thing2:{value:t.feeType},amount3:{value:"".concat(t.amount,"\u5143")},date4:{value:t.dueDate},thing5:{value:"\u8bf7\u53ca\u65f6\u7f34\u7eb3\uff0c\u5982\u6709\u7591\u95ee\u8bf7\u8054\u7cfb\u56ed\u533a"}},page:"/pages/finance/index",createdAt:(new Date).toISOString(),sent:!1},n.n=2,y(e);case 2:console.log("[\u901a\u77e5] \u7f34\u8d39\u63d0\u9192\u5df2\u5165\u961f:",t.studentName,t.feeType);case 3:return n.a(2)}},n)}));return function(t){return n.apply(this,arguments)}}(),g="kt_notification_queue";function y(n){return v.apply(this,arguments)}function v(){return v=(0,c.Z)((0,r.Z)().m(function n(t){var e,a,c;return(0,r.Z)().w(function(n){while(1)switch(n.p=n.n){case 0:return n.p=0,e=u().getStorageSync(g)||[],e.push(t),a=e.slice(-100),u().setStorageSync(g,a),n.n=1,(0,o.Qu)(g,a);case 1:n.n=3;break;case 2:n.p=2,c=n.v,console.error("[\u901a\u77e5] \u5165\u961f\u5931\u8d25:",c);case 3:return n.a(2)}},n,null,[[0,2]])})),v.apply(this,arguments)}},7724:function(n,t,e){"use strict";e.d(t,{A:function(){return f},GJ:function(){return d},ZE:function(){return i},lk:function(){return h},ts:function(){return l},vX:function(){return p}});e(2688),e(5861);var r=e(1413),a=e(3433),c=e(1002),s=e(2954),u=e.n(s),o=(e(1977),["SUPER_ADMIN","ADMIN"]),i=["\u60a6\u82bd\u4e00\u73ed","\u82b1\u5f00\u5c0f\u4e00","\u82b1\u5f00\u5c0f\u4e8c","\u82b1\u5f00\u5c0f\u4e09","\u4e66\u7530\u4e2d\u4e00","\u4e66\u7530\u4e2d\u4e8c","\u661f\u8bed\u5927\u4e00","\u661f\u8bed\u5927\u4e8c"],l=function(){try{var n,t=u().getStorageSync("kt_current_user");if(!t)return null;var e=u().getStorageSync("kt_staff")||[],s=e.find(function(n){return n.phone===t.phone}),o=u().getStorageSync("kt_authorized_phones")||[],i=o.find(function(n){return"object"===(0,c.Z)(n)&&n.phone===t.phone}),l=[];null!==s&&void 0!==s&&null!==(n=s.assignedClasses)&&void 0!==n&&n.length&&(l=(0,a.Z)(s.assignedClasses)),null!==i&&void 0!==i&&i.assignedClass&&!l.includes(i.assignedClass)&&l.push(i.assignedClass),null!==s&&void 0!==s&&s.class&&!l.includes(s.class)&&l.push(s.class);var d=s||i;if(d){var f=t.assignedClasses||[],p=JSON.stringify(f.sort())!==JSON.stringify(l.sort())||t.role!==((null===s||void 0===s?void 0:s.role)||(null===i||void 0===i?void 0:i.role)||t.role)||t.name!==((null===s||void 0===s?void 0:s.name)||(null===i||void 0===i?void 0:i.name)||t.name);if(p){var h=(0,r.Z)((0,r.Z)({},t),{},{name:(null===s||void 0===s?void 0:s.name)||(null===i||void 0===i?void 0:i.name)||t.name,role:(null===s||void 0===s?void 0:s.role)||(null===i||void 0===i?void 0:i.role)||t.role,campus:(null===s||void 0===s?void 0:s.campus)||(null===i||void 0===i?void 0:i.campus)||t.campus,assignedClasses:l.length>0?l:f});return u().setStorageSync("kt_current_user",h),console.log("[Permission] \u7528\u6237\u6743\u9650\u5df2\u81ea\u52a8\u66f4\u65b0:",h.assignedClasses),h}}return t}catch(n){return null}},d=function(n){var t,e=n||l();if(!e)return!1;var r=null===(t=e.role)||void 0===t?void 0:t.toUpperCase();return o.includes(r)||"\u56ed\u957f"===r||"\u526f\u56ed\u957f"===r||"\u56ed\u957f"===e.role||"\u526f\u56ed\u957f"===e.role},f=function(n){var t=n||l();return t?d(t)?i:t.assignedClasses||[]:[]},p=function(n,t){var e,r=t||l();if(!r)return[];if(d(r))return n;if("KITCHEN"===(null===(e=r.role)||void 0===e?void 0:e.toUpperCase()))return n;var a=f(r);return 0===a.length?(console.warn("[Permission] \u8be5\u7528\u6237\u6ca1\u6709\u5206\u914d\u4efb\u4f55\u73ed\u7ea7"),[]):n.filter(function(n){var t=n.class||n.className||"";return a.includes(t)})},h=function(n){var t,e=n||l();if(!e)return"\u8bf7\u5148\u767b\u5f55";if(d(e))return"\u7ba1\u7406\u5458\uff1a\u53ef\u67e5\u770b\u6240\u6709\u73ed\u7ea7";if("KITCHEN"===(null===(t=e.role)||void 0===t?void 0:t.toUpperCase()))return"\u53a8\u623f\uff1a\u53ef\u67e5\u770b\u5168\u56ed\u7528\u9910\u6570\u636e";var r=f(e);return 0===r.length?"\u6682\u672a\u5206\u914d\u73ed\u7ea7\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458":"\u8d1f\u8d23\u73ed\u7ea7\uff1a".concat(r.join("\u3001"))}},4266:function(n,t,e){"use strict";e.d(t,{O:function(){return d},t:function(){return i}});var r=e(2688),a=e(9439),c=e(5861),s=e(2954),u=e.n(s),o=new Set(["/pages/index/index","/pages/students/index","/pages/growth/index","/pages/profile/index"]);function i(n){return l.apply(this,arguments)}function l(){return l=(0,c.Z)((0,r.Z)().m(function n(t){var e,c,s,i,l,d;return(0,r.Z)().w(function(n){while(1)switch(n.p=n.n){case 0:if(e=t.split("?"),c=(0,a.Z)(e,2),s=c[0],i=c[1],l=o.has(s),!l){n.n=5;break}return i&&(d={},i.split("&").forEach(function(n){var t=n.split("="),e=(0,a.Z)(t,2),r=e[0],c=e[1];r&&c&&(d[r]=decodeURIComponent(c))}),u().setStorageSync("_nav_params_"+s,d)),n.p=1,n.n=2,u().switchTab({url:s});case 2:return n.a(2);case 3:return n.p=3,n.v,n.n=4,u().navigateTo({url:t});case 4:return n.a(2);case 5:return n.n=6,u().navigateTo({url:t});case 6:return n.a(2)}},n,null,[[1,3]])})),l.apply(this,arguments)}function d(n){var t="_nav_params_"+n,e=u().getStorageSync(t);return e?(u().removeStorageSync(t),e):null}},6949:function(n,t,e){"use strict";n.exports=e.p+"assets/logo.png"},2480:function(){}}]);